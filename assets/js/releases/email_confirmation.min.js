"use strict";function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var e=_superPropBase(e,t);if(e)return(e=Object.getOwnPropertyDescriptor(e,t)).get?e.get.call(n):e.value})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var i=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,i?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _createForOfIteratorHelper(e,t){var n,i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw r}}}}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Events=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Class Events";_classCallCheck(this,t),this.class=e,this.events=[],this.listeners={}}return _createClass(t,[{key:"define",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.events.includes(e[t])||(this.events.push(e[t]),this.listeners[e[t]]=[]);else if(e instanceof String||"string"==typeof e){if(this.events.includes(e))return this;this.events.push(e),this.listeners[e]=[]}else console.log("[".concat(this.class,"] trying to define event from unknown type"));return this}},{key:"add_listener",value:function(e,t){var n=this;return(Array.isArray(e)?e:[e]).forEach(function(e){n.events.includes(e)?n.listeners[e].push(t):console.log("[".concat(n.class,"] trying to listen undefined event: ")+e)}),this}},{key:"remove_listener",value:function(e,t){return this.events[e]&&(this.events.splice(this.events.indexOf(e),1),delete this.listeners[e]),this}},{key:"trigger",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;if(this.listeners[e])for(var n=0;n<this.listeners[e].length;n++)this.listeners[e][n](t);else console.log("[".concat(this.class,"]: try to trigger event: ")+e);return this}},{key:"pipe",value:function(n){var e=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t=null!=t?t:this.events;return n.define(t),t.forEach(function(t){return e.add_listener(t,function(e){if(i.hasOwnProperty(t))return n.trigger(t,i[t](e));n.trigger(t,e)})}),this}},{key:"funnel",value:function(e,t,n){var i=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return this.events.includes(n)?console.log("[".concat(this.class,"]: try to funnel on undefined event: ")+_event):t.forEach(function(t){e.add_listener(t,function(e){if(r.hasOwnProperty(t))return i.trigger(n,r[t](e));i.trigger(n,e)})}),this}},{key:"map",value:function(e,n){var i=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e.forEach(function(t){i.add_listener(t[0],function(e){n.trigger(t[1],r.hasOwnProperty(t[0])?r[t[0]](e):e)})}),this}}]),t}(),Molecules=function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"Molecule with a name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}(),Atoms=(window.molecules=new Molecules,function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"A atom with name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}()),HTML=(window.atoms=new Atoms,function(){function e(){_classCallCheck(this,e),this.events=new Events}return _createClass(e,[{key:"auto_build",get:function(){return!0}},{key:"base_bld",value:function(){}},{key:"build",value:function(){this.base_bld()}},{key:"html",value:function(){}}],[{key:"parse_element",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"div";return e instanceof HTMLElement?e:t instanceof String||"string"==typeof t?((t=document.createElement(t)).innerHTML+=e,t):null}},{key:"from_DOM",value:function(e){}}]),e}()),Ajax=function(){function t(e){var n=this;_classCallCheck(this,t),this.options=e,this.xhr=new XMLHttpRequest,this.options.hasOwnProperty("loading")&&(this.xhr.onloadstart=this.options.loading),this.xhr.open(this.options.method,this.options.url),this.options.hasOwnProperty("type")&&null!==this.options.type&&"form-data"!==this.options.type&&this.xhr.setRequestHeader("Content-Type",this.options.type),this.options.hasOwnProperty("with_credentials")&&(this.xhr.withCredentials=this.options.with_credentials),this.promise=new Promise(function(e,t){n.xhr.onreadystatechange=function(){return 0===n.xhr.status&&2<n.xhr.readyState?t({code:"ABORTED"}):4===n.xhr.readyState?200===n.xhr.status?e(n.xhr.responseText):t({code:n.xhr.status}):void 0},n.options.hasOwnProperty("send")&&n.options.send&&n.send()})}return _createClass(t,[{key:"send",value:function(e){var t=null;return e?t=e:this.options.hasOwnProperty("data")&&(t="application/json"===this.options.type?JSON.stringify(this.options.data):this.options.data),this.xhr.send(t),this}},{key:"then",value:function(e){return this.promise=this.promise.then(e),this}},{key:"catch",value:function(e){return this.promise=this.promise.catch(e),this}},{key:"finally",value:function(e){return this.promise=this.promise.finally(e),this}},{key:"abort",value:function(){return this.xhr.abort(),this}}]),t}();function get_array_from_form_data(e){var t,n={},i=_createForOfIteratorHelper(e.entries());try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r[0]]=r[1]}}catch(e){i.e(e)}finally{i.f()}return n}function get_form_data_from_array(e){if(e instanceof FormData)return e;var t,n=new FormData;for(t in e)e.hasOwnProperty(t)&&n.append(t,e[t]);return n}window.env.events=new Events,window.app={managers:{},events:new Events,instance:null},FormData.prototype.to_object=function(){return get_array_from_form_data(this)},FormData.from_object=function(e){return get_form_data_from_array(e)},window.app.events=new Events,window.app.events.define(["vertical_resize","horizontal_resize"]);var currentHeight=window.innerHeight,currentWidth=window.innerWidth,TransitionedAction=(window.addEventListener("resize",function(e){currentHeight!==(currentHeight=window.innerHeight)&&window.app.events.trigger("vertical_resize",e),currentWidth!==(currentWidth=window.innerWidth)&&window.app.events.trigger("horizontal_resize",e)},!1),env.H_DATE_FORMAT="DD MMMM YYYY",env.H_DATE_TIME_FORMAT="DD MMMM YYYY à HH:mm:ss",env.DATE_TIME_FORMAT="DD / MM / YYYY à HH:mm:ss",env.DATE_FORMAT="DD / MM / YYYY",env.page_overlay_z_index=1005,function(){function i(e,t,n){_classCallCheck(this,i),this.events=new Events,this.events.define("action"),this.element=HTML.parse_element(e),this.cssEventType=t,this.class=n,this.listen()}return _createClass(i,[{key:"listen",value:function(){var t=this;this.element.addEventListener(this.cssEventType,function(e){e.target===t.element&&t.element.classList.contains(t.class)&&(e.stopPropagation(),t.events.trigger("action",t.element),t.element.classList.remove(t.class))},!1)}},{key:"transition",value:function(){this.element.classList.add(this.class)}}]),i}()),Molecule=function(){_inherits(i,HTML);var n=_createSuper(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,i),(e=n.call(this)).opts=Object.assign(i.dflt_opts,t),e}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"molecule"),this.opts.molecule_id&&this.container.setAttribute("data-molecule-id",this.opts.molecule_id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,n){return this.container.addEventListener(e,t,n)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"molecule")}},{key:"dflt_opts",get:function(){return{molecule_id:null}}}]),i}(),project=(window.app.managers.ajax={request:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=new Ajax(e);return n.then(function(e){var t=null;try{if("OK"===(t=JSON.parse(e)).status)return t.content}catch(e){}if("object"===_typeof(t))throw t;throw{code:"BAD_RESPONSE",content:{xhr:n.xhr}}}),n.catch(function(e){if("ABORTED"===e.code)throw e;var t=null;try{t=JSON.parse(n.xhr.responseText)}catch(e){}if(t&&t.status)throw{code:t.status,content:t};throw{code:"UNKNOWN",content:{err:e,xhr:n.xhr}}}),t&&t(n),n.send()}},moment.locale(env.LANG),window[window.env.APP_CSS_CLASS]={page_overlay_count:0,managers:{},events:new Events,errors:{}},window[window.env.APP_CSS_CLASS]);function parse_exploitation(e){var t,n;return e._exploitation_licence?(e=moment(e._exploitation_expiration),t="Licence d'exploitation ",n=(n=Math.ceil(moment().diff(e,"days",!0)))<0?(t+="expirée","expired"):0===n?(t+="expire aujourd'hui","warning"):n<30?(t+="expire dans ".concat(n," jour(s)"),"warning"):(t+="valide jusqu'à ".concat(e.format(env.H_DATE_FORMAT)),"valide"),{str:t,state:n}):{str:"Sans licence d'exploitation",state:"null"}}function common_mgr(e){var r="".concat(window.env.API_URL_BASE,"/api/").concat(env.USER.url_node,"/").concat(e.replace("_","-"));return{get:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:r+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})},range:function(e){var t=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:r+"/range",type:"application/json",data:{_factor:void 0===t?10:t,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(e){var t=e._str,n=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:r+"/search",type:"application/json",data:{_str:t,_factor:void 0===n?10:n,_page:void 0===i?1:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register:function(e){var t=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:r+"/register",type:"application/json",data:{_code:t,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update:function(e){var t=e._id,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:r+"/update",type:"application/json",data:{_id:t,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:r+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})}}}window.storage={},project.events.define(["logout"]);var Atom=function(){_inherits(i,HTML);var n=_createSuper(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,i),(e=n.call(this)).opts=t,e}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"atom"),this.opts.id&&this.container.setAttribute("data-atom-id",this.opts.id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,n){return this.container.addEventListener(e,t,n)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"atom")}}]),i}(),LoadingState=function(){function e(){_classCallCheck(this,e),this.events=new Events,this.events.define(["loaded","unloaded"]),this.count=0}return _createClass(e,[{key:"busy",get:function(){return 0<this.count}},{key:"load",value:function(){0==this.count++&&this.events.trigger("loaded")}},{key:"unload",value:function(){0==--this.count&&this.events.trigger("unloaded")}},{key:"unloaded",value:function(){return 0===this.count}}]),e}(),SlowlyRemovable=function(){_inherits(r,TransitionedAction);var i=_createSuper(r);function r(e,t){var n;return _classCallCheck(this,r),(n=i.call(this,e,t,"slowly-removable-remove")).events.define("removed"),n.events.add_listener("action",function(){n.element.remove(),n.events.trigger("removed",n.element)}),n}return _createClass(r,[{key:"remove",value:function(){this.element.classList.add("slowly-removable-remove")}}]),r}(),LoadingFrame=function(){_inherits(n,Molecule);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).build(),e}return _createClass(n,[{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("loading-frame")}}],[{key:"from_DOM",value:function(e){var t=new n;return t.container=HTML.parse_element(e),t.container.classList.add("ova",env.APP_CSS_CLASS,"loading-frame"),t.inner=t.container.querySelector(".inner"),t}}]),n}(),Button=(!function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return e.hasOwnProperty("method")||(e.method="POST"),e.hasOwnProperty("type")||(e.type="application/json"),window.app.managers.ajax.request(e,t)}project.managers.ajax={request:i,authenticated_request:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=(e.with_credentials=!0,localStorage.getItem("session_token"));return"application/json"!==e.type&&e.type?"form-data"===e.type&&(e.hasOwnProperty("data")||(e.data=new FormData),e.data.append("session_token",n)):(e.hasOwnProperty("data")||(e.data={}),e.data.session_token=n),i(e,t)}}}(),function(){_inherits(i,Atom);var n=_createSuper(i);function i(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return _classCallCheck(this,i),e=n.call(this),t&&e.build(),e}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.createElement("a"),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("button"),this.container.setAttribute("tabindex",0)}}],[{key:"from_DOM",value:function(n){return new(function(){_inherits(t,i);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,n)}}]),t}())}}]),i}()),LoadableAtom=function(){_inherits(t,Atom);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this)}return _createClass(t,[{key:"build",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.loading_state=new LoadingState,this.loading_state.events.pipe(this.events,["loaded","unloaded"],{loaded:function(){e.container.classList.add("loaded")},unloaded:function(){e.container.classList.remove("loaded")}})}}]),t}(),PageOverlay=function(){_inherits(i,HTML);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this)).id=e,t.z_index=0,t.build(),t}return _createClass(i,[{key:"build",value:function(){var e=this;this.container=document.createElement("div"),this.container.className="".concat(env.APP_CSS_CLASS," page-overlay ").concat(this.id),this.transitioned_hiding=new TransitionedAction(this.container,"transitionend","hide"),this.transitioned_hiding.events.add_listener("action",function(){e.container.classList.remove("active")}),this.remover=new SlowlyRemovable(this.container,"transitionend"),document.body.appendChild(this.container)}},{key:"show",value:function(){this.z_index=env.page_overlay_z_index+2*window.project.page_overlay_count+++1,this.container.style.zIndex=this.z_index,this.container.classList.add("active")}},{key:"hide",value:function(){--project.page_overlay_count,this.transitioned_hiding.transition()}},{key:"remove",value:function(){--project.page_overlay_count,this.remover.remove()}}]),i}(),App=function(){function e(){_classCallCheck(this,e),this.events=new Events,project.instance=this}return _createClass(e,[{key:"init",value:function(){var t=this;this.updateBodyHeight(),window.addEventListener("resize",function(e){t.updateBodyHeight(),t.updateVhProperty()},!1)}},{key:"run",value:function(){var t=this;window.addEventListener("DOMContentLoaded",function(e){t.init()},!1)}},{key:"updateBodyHeight",value:function(){document.body.style.height="".concat(window.innerHeight,"px"),document.documentElement.style.setProperty("--body-height","".concat(window.innerHeight,"px"))}},{key:"updateVhProperty",value:function(){document.documentElement.style.setProperty("--vh","".concat(window.innerHeight/100,"px"))}}]),e}(),Notification=function(){_inherits(r,Molecule);var i=_createSuper(r);function r(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,r),(t=i.call(this)).message=e,t.options=Object.assign(r.dflt_opts,n),t.timeout_id=null,t.build(),t}return _createClass(r,[{key:"build",value:function(){var t=this;_get(_getPrototypeOf(r.prototype),"build",this).call(this),this.container.classList.add("notification"),this.inner.innerHTML='<div class="header"><a class="closer">\x3c!--span class="icofont-close"></span--\x3e</a></div>',this.inner.innerHTML+='<div class="body"><div class="inner">'.concat(this.message,"</div></div>"),this.container.querySelector(".closer").addEventListener("click",function(e){t.destruct()},!1),this.container.querySelector(".closer").addEventListener("transitionend",function(e){e.stopPropagation()},!1),this.container.addEventListener("transitionend",function(e){t.container.classList.contains("destruct")&&t.container.remove()},!1),document.body.appendChild(this.container),this.styling()}},{key:"html",value:function(){return this.container}},{key:"notify",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.delay;this.container.classList.add("active"),this.options.auto_destruct&&(this.timeout_id=setTimeout(function(){e.destruct()},t))}},{key:"destruct",value:function(){this.container.classList.add("destruct"),this.timeout_id&&clearTimeout(this.timeout_id)}},{key:"styling",value:function(){var e=this.container.offsetWidth;this.container.style.left=window.innerWidth/2-e/2+"px"}}],[{key:"dflt_opts",get:function(){return{auto_destruct:!0,delay:5e3}}}]),r}(),url_base=(!function(){var e=LoadingFrame.prototype.base_bld;LoadingFrame.prototype.base_bld=function(){e.apply(this),this.container.classList.add(env.APP_CSS_CLASS),this.container.innerHTML='<img src="/assets/media/loading.svg" alt=""/>'}}(),"".concat(env.API_URL_BASE,"/api/users")),register=function(e){var t=e._last_name,n=e._first_name,i=e._birthday,r=e._email,e=e._password;return project.managers.ajax.request({url:"".concat(url_base,"/register"),method:"POST",type:"application/json",data:{_last_name:t,_first_name:n,_email:r,_birthday:i,_password:e}})},get=function(){return project.managers.ajax.authenticated_request({url:"".concat(url_base,"/get"),method:"POST",type:"application/json",data:{}})},update=function(e){var t=e._last_name,n=e._first_name,e=e._birthday;return project.managers.ajax.authenticated_request({url:"".concat(url_base,"/update"),method:"POST",type:"application/json",data:{_last_name:t,_first_name:n,_birthday:e}})},update_password=function(e){e=e._password;return project.managers.ajax.authenticated_request({url:"".concat(url_base,"/update-password"),method:"POST",type:"application/json",data:{_password:e}})},rsd_email_confirmation_mail=function(e){return project.managers.ajax.request({url:"".concat(url_base,"/resend-email-confirmation-mail"),method:"POST",type:"application/json",data:{lang:window.env.LANG,_identifier:e}})},account_confirm=function(e){return project.managers.ajax.request({url:"".concat(url_base,"/account/confirm"),method:"POST",type:"application/json",data:{token:e}})},PushButton=(project.managers.users={register:register,get:get,update:update,update_password:update_password,rsd_email_confirmation_mail:rsd_email_confirmation_mail,account_confirm:account_confirm},function(){_inherits(i,LoadableAtom);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this)).label=e,t.events.define(["pushed","released"]),t.build(),t}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("button","push-button"),this.inner.innerHTML=this.label,this.loading_layer=document.createElement("div"),this.loading_layer.className="layer loading",this.loading_layer.innerHTML='<img src="/assets/media/loading.gif" alt=""/>',this.container.appendChild(this.loading_layer)}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.addEventListener("click",function(e){t.loading_state.busy||t.push()},!1),this.loading_state.events.add_listener("unloaded",function(){return t.events.trigger("released")})}},{key:"push",value:function(){this.loading_state.load(),this.events.trigger("pushed")}},{key:"release",value:function(){this.loading_state.unload()}}],[{key:"from_DOM",value:function(n){return new(function(){_inherits(t,i);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){this.container=n,this.container.classList.add(window.env.APP_CSS_CLASS,"atom","button","push-button"),this.inner=this.container.children[0],this.inner.classList.add("inner"),this.loading_layer=this.container.children[1],this.loading_layer.classList.add("layer","loading")}}]),t}())}}]),i}()),Dpml=function(){_inherits(t,App);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this)}}]),t}(),EmailConfirmation=function(){_inherits(i,Dpml);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).token=window.env.token,e.payload=window.env.payload,e}return _createClass(i,[{key:"init",value:function(){var e,n=this;_get(_getPrototypeOf(i.prototype),"init",this).call(this),this.token?(this.indication=document.querySelector(".indication"),this.confirm().catch(function(e){if(e.status){if("USER_EMAIL_ALREADY_CONFIRMED_ERROR"===e.status)return void(n.indication.innerHTML='\n                            <p>Votre email est déjà confirmé.</p>\n                            <p>Veuillez cliquer sur le bouton ci-dessous pour vous connecter et bénéficier de nos services</p>\n                            <div class="action">\n                                <a href="/'.concat(window.env.LANG,'/user/login" class="').concat(window.env.APP_CSS_CLASS,' atom button filled primary">\n                                    <div class="inner">Se connecter</div>\n                                </a>\n                            </div>\n                        '));if("USER_NOT_FOUND_ERROR"===e.status)return void(n.indication.innerHTML='\n                            <p>Désolé nous n\'avons pas trouvé votre compte</p>\n                            <p>Veuillez cliquer sur le bouton ci-dessous pour créer votre compte</p>\n                            <div class="action">\n                                <a href="/'.concat(window.env.LANG,'/user/sign-up" class="').concat(window.env.APP_CSS_CLASS,' atom button filled primary">\n                                    <div class="inner">Créer un compte</div>\n                                </a>\n                            </div>\n                        '))}n.indication.classList.add("error"),n.indication.innerHTML='\n                    <p>Nous avons rencontré une erreur lors de la confirmation de votre adresse email</p>\n                    <p>Vous pouvez relancer l\'opération en cliquant sur le bouton ci-dessous</p>\n                    <div class="action"></div>\n                ';var t=new PushButton("Relancer");t.html().classList.add("filled","primary"),t.events.add_listener("pushed",function(){n.confirm().catch(function(e){new Notification("Erreur lors de l'opération").notify()}).finally(function(){return t.release()})}),n.indication.querySelector(".action").appendChild(t.html())})):payload&&(e=PushButton.from_DOM(document.querySelector(".push_button"))).events.add_listener("pushed",function(){project.managers.users.rsd_email_confirmation_mail(payload.identifier).then(function(){new Notification("Email de confirmation envoyé!").notify()}).catch(function(e){e.status?"USER_NOT_FOUND_ERROR"===e.status&&new Notification("Utilisateur non trouvé").notify():new Notification("Une erreur est survénue lors de l'opération").notify()}).finally(function(){return e.release()})})}},{key:"confirm",value:function(){var e=this;return project.managers.users.confirm_email(this.token).then(function(){e.indication.classList.remove("error"),e.indication.classList.add("success"),e.indication.innerHTML='\n                <h2>Bienvenue! à la DPML</h2>\n                <p>Votre email a été confirmé avec succès!</p>\n                <p>Veuillez cliquer sur le bouton ci-dessous pour vous connecter et bénéficier de nos services</p>\n                <div class="action">\n                    <a href="/'.concat(window.env.LANG,'/user/login" class="').concat(window.env.APP_CSS_CLASS,' atom button filled primary">\n                        <div class="inner">Se connecter</div>\n                    </a>\n                </div>\n            ')})}}]),i}(),email_confirmation=new EmailConfirmation;email_confirmation.run();