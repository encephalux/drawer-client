"use strict";function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var t=_superPropBase(t,e);if(t)return(t=Object.getOwnPropertyDescriptor(t,e)).get?t.get.call(n):t.value})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var n,r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return n&&(t=n),r=0,{s:e=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}function _unsupportedIterableToArray(t,e){var n;if(t)return"string"==typeof t?_arrayLikeToArray(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Molecules=function(){function t(){_classCallCheck(this,t),this.stack={}}return _createClass(t,[{key:"register",value:function(t,e){if(this.stack.hasOwnProperty(t))throw"Molecule with a name '"+t+"' was registered";this.stack[t]=e}},{key:"unregister",value:function(t){this.stack.hasOwnProperty(t)&&delete this.stack[t]}},{key:"replace",value:function(t,e){this.stack[t]=e}},{key:"class",value:function(t){if(this.stack.hasOwnProperty(t))return this.stack[t];throw"Unregistered molecule at '"+t+"'"}}]),t}(),Atoms=(window.molecules=new Molecules,function(){function t(){_classCallCheck(this,t),this.stack={}}return _createClass(t,[{key:"register",value:function(t,e){if(this.stack.hasOwnProperty(t))throw"A atom with name '"+t+"' was registered";this.stack[t]=e}},{key:"unregister",value:function(t){this.stack.hasOwnProperty(t)&&delete this.stack[t]}},{key:"replace",value:function(t,e){this.stack[t]=e}},{key:"class",value:function(t){if(this.stack.hasOwnProperty(t))return this.stack[t];throw"Unregistered molecule at '"+t+"'"}}]),t}()),Events=(window.atoms=new Atoms,function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Class Events";_classCallCheck(this,e),this.class=t,this.events=[],this.listeners={}}return _createClass(e,[{key:"define",value:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.events.includes(t[e])||(this.events.push(t[e]),this.listeners[t[e]]=[]);else if(t instanceof String||"string"==typeof t){if(this.events.includes(t))return this;this.events.push(t),this.listeners[t]=[]}else console.log("[".concat(this.class,"] trying to define event from unknown type"));return this}},{key:"add_listener",value:function(t,e){var n=this;return(Array.isArray(t)?t:[t]).forEach(function(t){n.events.includes(t)?n.listeners[t].push(e):console.log("[".concat(n.class,"] trying to listen undefined event: ")+t)}),this}},{key:"remove_listener",value:function(t,e){return this.events[t]&&(this.events.splice(this.events.indexOf(t),1),delete this.listeners[t]),this}},{key:"trigger",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;if(this.listeners[t])for(var n=0;n<this.listeners[t].length;n++)this.listeners[t][n](e);else console.log("[".concat(this.class,"]: try to trigger event: ")+t);return this}},{key:"pipe",value:function(n){var t=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=null!=e?e:this.events;return n.define(e),e.forEach(function(e){return t.add_listener(e,function(t){if(r.hasOwnProperty(e))return n.trigger(e,r[e](t));n.trigger(e,t)})}),this}},{key:"funnel",value:function(t,e,n){var r=this,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return this.events.includes(n)?console.log("[".concat(this.class,"]: try to funnel on undefined event: ")+_event):e.forEach(function(e){t.add_listener(e,function(t){if(i.hasOwnProperty(e))return r.trigger(n,i[e](t));r.trigger(n,t)})}),this}},{key:"map",value:function(t,n){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return t.forEach(function(e){r.add_listener(e[0],function(t){n.trigger(e[1],i.hasOwnProperty(e[0])?i[e[0]](t):t)})}),this}}]),e}()),Ajax=function(){function e(t){var n=this;_classCallCheck(this,e),this.options=t,this.xhr=new XMLHttpRequest,this.options.hasOwnProperty("loading")&&(this.xhr.onloadstart=this.options.loading),this.xhr.open(this.options.method,this.options.url),this.options.hasOwnProperty("type")&&null!==this.options.type&&"form-data"!==this.options.type&&this.xhr.setRequestHeader("Content-Type",this.options.type),this.options.hasOwnProperty("with_credentials")&&(this.xhr.withCredentials=this.options.with_credentials),this.promise=new Promise(function(t,e){n.xhr.onreadystatechange=function(){return 0===n.xhr.status&&2<n.xhr.readyState?e({code:"ABORTED"}):4===n.xhr.readyState?200===n.xhr.status?t(n.xhr.responseText):e({code:n.xhr.status}):void 0},n.options.hasOwnProperty("send")&&n.options.send&&n.send()})}return _createClass(e,[{key:"send",value:function(t){var e=null;return t?e=t:this.options.hasOwnProperty("data")&&(e="application/json"===this.options.type?JSON.stringify(this.options.data):this.options.data),this.xhr.send(e),this}},{key:"then",value:function(t){return this.promise=this.promise.then(t),this}},{key:"catch",value:function(t){return this.promise=this.promise.catch(t),this}},{key:"finally",value:function(t){return this.promise=this.promise.finally(t),this}},{key:"abort",value:function(){return this.xhr.abort(),this}}]),e}();function get_array_from_form_data(t){var e,n={},r=_createForOfIteratorHelper(t.entries());try{for(r.s();!(e=r.n()).done;){var i=e.value;n[i[0]]=i[1]}}catch(t){r.e(t)}finally{r.f()}return n}function get_form_data_from_array(t){if(t instanceof FormData)return t;var e,n=new FormData;for(e in t)t.hasOwnProperty(e)&&n.append(e,t[e]);return n}window.env.events=new Events,window.app={managers:{},events:new Events,instance:null},FormData.prototype.to_object=function(){return get_array_from_form_data(this)},FormData.from_object=function(t){return get_form_data_from_array(t)},window.app.events=new Events,window.app.events.define(["vertical_resize","horizontal_resize"]);var currentHeight=window.innerHeight,currentWidth=window.innerWidth,project=(window.addEventListener("resize",function(t){currentHeight!==(currentHeight=window.innerHeight)&&window.app.events.trigger("vertical_resize",t),currentWidth!==(currentWidth=window.innerWidth)&&window.app.events.trigger("horizontal_resize",t)},!1),env.H_DATE_FORMAT="DD MMMM YYYY",env.H_DATE_TIME_FORMAT="DD MMMM YYYY à HH:mm:ss",env.DATE_TIME_FORMAT="DD / MM / YYYY à HH:mm:ss",env.DATE_FORMAT="DD / MM / YYYY",env.page_overlay_z_index=1005,window.app.managers.ajax={request:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=new Ajax(t);return n.then(function(t){var e=null;try{if("OK"===(e=JSON.parse(t)).status)return e.content}catch(t){}if("object"===_typeof(e))throw e;throw{code:"BAD_RESPONSE",content:{xhr:n.xhr}}}),n.catch(function(t){if("ABORTED"===t.code)throw t;var e=null;try{e=JSON.parse(n.xhr.responseText)}catch(t){}if(e&&e.status)throw{code:e.status,content:e};throw{code:"UNKNOWN",content:{err:t,xhr:n.xhr}}}),e&&e(n),n.send()}},moment.locale(env.LANG),window[window.env.APP_CSS_CLASS]={page_overlay_count:0,managers:{},events:new Events,errors:{}},window[window.env.APP_CSS_CLASS]);function parse_exploitation(t){var e,n;return t._exploitation_licence?(t=moment(t._exploitation_expiration),e="Licence d'exploitation ",n=(n=Math.ceil(moment().diff(t,"days",!0)))<0?(e+="expirée","expired"):0===n?(e+="expire aujourd'hui","warning"):n<30?(e+="expire dans ".concat(n," jour(s)"),"warning"):(e+="valide jusqu'à ".concat(t.format(env.H_DATE_FORMAT)),"valide"),{str:e,state:n}):{str:"Sans licence d'exploitation",state:"null"}}function common_mgr(t){var i="".concat(window.env.API_URL_BASE,"/api/").concat(env.USER.url_node,"/").concat(t.replace("_","-"));return{get:function(t){t=t._id;return project.managers.ajax.authenticated_request({url:i+"/get",type:"application/json",data:{_id:t}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})},range:function(t){var e=t._factor,n=t._page,t=t.filter;return project.managers.ajax.authenticated_request({url:i+"/range",type:"application/json",data:{_factor:void 0===e?10:e,_page:void 0===n?1:n,filter:void 0===t?[]:t}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(t){var e=t._str,n=t._factor,r=t._page,t=t.filter;return project.managers.ajax.authenticated_request({url:i+"/search",type:"application/json",data:{_str:e,_factor:void 0===n?10:n,_page:void 0===r?1:r,filter:void 0===t?[]:t}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register:function(t){var e=t._code,t=t._name;return project.managers.ajax.authenticated_request({url:i+"/register",type:"application/json",data:{_code:e,_name:t}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update:function(t){var e=t._id,n=t._code,t=t._name;return project.managers.ajax.authenticated_request({url:i+"/update",type:"application/json",data:{_id:e,_code:n,_name:t}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove:function(t){t=t._id;return project.managers.ajax.authenticated_request({url:i+"/remove",type:"application/json",data:{_id:t}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})}}}window.storage={},project.events.define(["logout"]);var HTML=function(){function t(){_classCallCheck(this,t),this.events=new Events}return _createClass(t,[{key:"auto_build",get:function(){return!0}},{key:"base_bld",value:function(){}},{key:"build",value:function(){this.base_bld()}},{key:"html",value:function(){}}],[{key:"parse_element",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"div";return t instanceof HTMLElement?t:e instanceof String||"string"==typeof e?((e=document.createElement(e)).innerHTML+=t,e):null}},{key:"from_DOM",value:function(t){}}]),t}(),Molecule=(!function(){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return t.hasOwnProperty("method")||(t.method="POST"),t.hasOwnProperty("type")||(t.type="application/json"),window.app.managers.ajax.request(t,e)}project.managers.ajax={request:r,authenticated_request:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=(t.with_credentials=!0,localStorage.getItem("session_token"));return"application/json"!==t.type&&t.type?"form-data"===t.type&&(t.hasOwnProperty("data")||(t.data=new FormData),t.data.append("session_token",n)):(t.hasOwnProperty("data")||(t.data={}),t.data.session_token=n),r(t,e)}}}(),function(){_inherits(r,HTML);var n=_createSuper(r);function r(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(t=n.call(this)).opts=Object.assign(r.dflt_opts,e),t}return _createClass(r,[{key:"base_bld",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||t&&Array.from(t.children).find(function(t){return t.classList.contains("inner")});this.container=t||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"molecule"),this.opts.molecule_id&&this.container.setAttribute("data-molecule-id",this.opts.molecule_id),e?this.inner=e:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(t,e,n){return this.container.addEventListener(t,e,n)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(t){t.classList.add("ova",window.env.APP_CSS_CLASS,"molecule")}},{key:"dflt_opts",get:function(){return{molecule_id:null}}}]),r}()),url_base="".concat(env.API_URL_BASE,"/api/users"),register=function(t){var e=t._last_name,n=t._first_name,r=t._birthday,i=t._email,t=t._password;return project.managers.ajax.request({url:"".concat(url_base,"/register"),method:"POST",type:"application/json",data:{_last_name:e,_first_name:n,_email:i,_birthday:r,_password:t}})},get=function(){return project.managers.ajax.authenticated_request({url:"".concat(url_base,"/get"),method:"POST",type:"application/json",data:{}})},update=function(t){var e=t._last_name,n=t._first_name,t=t._birthday;return project.managers.ajax.authenticated_request({url:"".concat(url_base,"/update"),method:"POST",type:"application/json",data:{_last_name:e,_first_name:n,_birthday:t}})},update_password=function(t){t=t._password;return project.managers.ajax.authenticated_request({url:"".concat(url_base,"/update-password"),method:"POST",type:"application/json",data:{_password:t}})},rsd_email_confirmation_mail=function(t){return project.managers.ajax.request({url:"".concat(url_base,"/resend-email-confirmation-mail"),method:"POST",type:"application/json",data:{lang:window.env.LANG,_identifier:t}})},account_confirm=function(t){return project.managers.ajax.request({url:"".concat(url_base,"/account/confirm"),method:"POST",type:"application/json",data:{token:t}})},Notification=(project.managers.users={register:register,get:get,update:update,update_password:update_password,rsd_email_confirmation_mail:rsd_email_confirmation_mail,account_confirm:account_confirm},function(){_inherits(i,Molecule);var r=_createSuper(i);function i(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,i),(e=r.call(this)).message=t,e.options=Object.assign(i.dflt_opts,n),e.timeout_id=null,e.build(),e}return _createClass(i,[{key:"build",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.classList.add("notification"),this.inner.innerHTML='<div class="header"><a class="closer">\x3c!--span class="icofont-close"></span--\x3e</a></div>',this.inner.innerHTML+='<div class="body"><div class="inner">'.concat(this.message,"</div></div>"),this.container.querySelector(".closer").addEventListener("click",function(t){e.destruct()},!1),this.container.querySelector(".closer").addEventListener("transitionend",function(t){t.stopPropagation()},!1),this.container.addEventListener("transitionend",function(t){e.container.classList.contains("destruct")&&e.container.remove()},!1),document.body.appendChild(this.container),this.styling()}},{key:"html",value:function(){return this.container}},{key:"notify",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.delay;this.container.classList.add("active"),this.options.auto_destruct&&(this.timeout_id=setTimeout(function(){t.destruct()},e))}},{key:"destruct",value:function(){this.container.classList.add("destruct"),this.timeout_id&&clearTimeout(this.timeout_id)}},{key:"styling",value:function(){var t=this.container.offsetWidth;this.container.style.left=window.innerWidth/2-t/2+"px"}}],[{key:"dflt_opts",get:function(){return{auto_destruct:!0,delay:5e3}}}]),i}()),ToolbarItem=function(){_inherits(i,Molecule);var r=_createSuper(i);function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"toolbar-item",n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return _classCallCheck(this,i),(t=r.call(this)).id=e,n&&t.build(),t}return _createClass(i,[{key:"build",value:function(){_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.classList.add("toolbar-item",this.id)}},{key:"show",value:function(){this.container.classList.remove("hide")}},{key:"hide",value:function(){this.container.classList.add("hide")}}],[{key:"likefy",value:function(t){t.classList.add("toolbar-item")}}]),i}(),Toolbar=function(){_inherits(i,Molecule);var r=_createSuper(i);function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"toolbar",n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return _classCallCheck(this,i),(t=r.call(this)).id=e,t.items={},n&&t.build(),t}return _createClass(i,[{key:"build",value:function(){_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.classList.add("toolbar"),this.id&&this.container.classList.add(this.id)}},{key:"add_item",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return!this.items.hasOwnProperty(t)&&(this.items[t]=e,n?this.inner.insertBefore(e.html(),this.items[n].html()):this.inner.appendChild(e.html()),!0)}},{key:"remove_item",value:function(t){return!!this.items.hasOwnProperty(t)&&(this.items[t].remove(),delete this.items[t],!0)}},{key:"show_item",value:function(t){return!!this.items.hasOwnProperty(t)&&(this.items[t].show(),!0)}},{key:"hide_item",value:function(t){return!!this.items.hasOwnProperty(t)&&(this.items[t].hide(),!0)}},{key:"disable",value:function(){}}]),i}(),Dashboard=function(){_inherits(n,Dpml);var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this)).initialized=!1,project.events.define(["user_loaded"]),t}return _createClass(n,[{key:"init",value:function(){_get(_getPrototypeOf(n.prototype),"init",this).call(this),this.toolbar=new Toolbar("toolbar"),document.querySelector(".toolbar-slot").appendChild(this.toolbar.html()),project.events.add_listener("logout",function(){project.managers.users.logout().then(function(){localStorage.setItem("session_token",""),document.location="/".concat(env.LANG,"/user/login")}).catch(function(t){new Notification("Une erreur est survénue lors de la déconnexion de votre compte").notify()})})}},{key:"load_user",value:function(){var e=this;return project.managers.users.get().then(function(t){storage.user=t,e.initialized=!0,project.events.trigger("user_loaded",env.user)}).finally(function(){return e.loading_frame.hide()})}}]),n}(),fo=new Dashboard;(app.instance=fo).run();