"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var e=_superPropBase(e,t);if(e)return(e=Object.getOwnPropertyDescriptor(e,t)).get?e.get.call(n):e.value})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _createForOfIteratorHelper(e,t){var n,r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Events=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Class Events";_classCallCheck(this,t),this.class=e,this.events=[],this.listeners={}}return _createClass(t,[{key:"define",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.events.includes(e[t])||(this.events.push(e[t]),this.listeners[e[t]]=[]);else if(e instanceof String||"string"==typeof e){if(this.events.includes(e))return this;this.events.push(e),this.listeners[e]=[]}else console.log("[".concat(this.class,"] trying to define event from unknown type"));return this}},{key:"add_listener",value:function(e,t){var n=this;return(Array.isArray(e)?e:[e]).forEach(function(e){n.events.includes(e)?n.listeners[e].push(t):console.log("[".concat(n.class,"] trying to listen undefined event: ")+e)}),this}},{key:"remove_listener",value:function(e,t){return this.events[e]&&(this.events.splice(this.events.indexOf(e),1),delete this.listeners[e]),this}},{key:"trigger",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;if(this.listeners[e])for(var n=0;n<this.listeners[e].length;n++)this.listeners[e][n](t);else console.log("[".concat(this.class,"]: try to trigger event: ")+e);return this}},{key:"pipe",value:function(n){var e=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t=null!=t?t:this.events;return n.define(t),t.forEach(function(t){return e.add_listener(t,function(e){if(r.hasOwnProperty(t))return n.trigger(t,r[t](e));n.trigger(t,e)})}),this}},{key:"funnel",value:function(e,t,n){var r=this,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return this.events.includes(n)?console.log("[".concat(this.class,"]: try to funnel on undefined event: ")+_event):t.forEach(function(t){e.add_listener(t,function(e){if(i.hasOwnProperty(t))return r.trigger(n,i[t](e));r.trigger(n,e)})}),this}},{key:"map",value:function(e,n){var r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e.forEach(function(t){r.add_listener(t[0],function(e){n.trigger(t[1],i.hasOwnProperty(t[0])?i[t[0]](e):e)})}),this}}]),t}(),HTML=function(){function e(){_classCallCheck(this,e),this.events=new Events}return _createClass(e,[{key:"auto_build",get:function(){return!0}},{key:"base_bld",value:function(){}},{key:"build",value:function(){this.base_bld()}},{key:"html",value:function(){}}],[{key:"parse_element",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"div";return e instanceof HTMLElement?e:t instanceof String||"string"==typeof t?((t=document.createElement(t)).innerHTML+=e,t):null}},{key:"from_DOM",value:function(e){}}]),e}(),TransitionedAction=function(){function r(e,t,n){_classCallCheck(this,r),this.events=new Events,this.events.define("action"),this.element=HTML.parse_element(e),this.cssEventType=t,this.class=n,this.listen()}return _createClass(r,[{key:"listen",value:function(){var t=this;this.element.addEventListener(this.cssEventType,function(e){e.target===t.element&&t.element.classList.contains(t.class)&&(e.stopPropagation(),t.events.trigger("action",t.element),t.element.classList.remove(t.class))},!1)}},{key:"transition",value:function(){this.element.classList.add(this.class)}}]),r}(),Molecules=function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"Molecule with a name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}(),Atoms=(window.molecules=new Molecules,function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"A atom with name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}()),SlowlyRemovable=(window.atoms=new Atoms,function(){_inherits(i,TransitionedAction);var r=_createSuper(i);function i(e,t){var n;return _classCallCheck(this,i),(n=r.call(this,e,t,"slowly-removable-remove")).events.define("removed"),n.events.add_listener("action",function(){n.element.remove(),n.events.trigger("removed",n.element)}),n}return _createClass(i,[{key:"remove",value:function(){this.element.classList.add("slowly-removable-remove")}}]),i}());function get_array_from_form_data(e){var t,n={},r=_createForOfIteratorHelper(e.entries());try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i[0]]=i[1]}}catch(e){r.e(e)}finally{r.f()}return n}function get_form_data_from_array(e){if(e instanceof FormData)return e;var t,n=new FormData;for(t in e)e.hasOwnProperty(t)&&n.append(t,e[t]);return n}window.env.events=new Events,window.app={managers:{},events:new Events,instance:null},FormData.prototype.to_object=function(){return get_array_from_form_data(this)},FormData.from_object=function(e){return get_form_data_from_array(e)},window.app.events=new Events,window.app.events.define(["vertical_resize","horizontal_resize"]);var currentHeight=window.innerHeight,currentWidth=window.innerWidth,Molecule=(window.addEventListener("resize",function(e){currentHeight!==(currentHeight=window.innerHeight)&&window.app.events.trigger("vertical_resize",e),currentWidth!==(currentWidth=window.innerWidth)&&window.app.events.trigger("horizontal_resize",e)},!1),env.H_DATE_FORMAT="DD MMMM YYYY",env.H_DATE_TIME_FORMAT="DD MMMM YYYY à HH:mm:ss",env.DATE_TIME_FORMAT="DD / MM / YYYY à HH:mm:ss",env.DATE_FORMAT="DD / MM / YYYY",env.page_overlay_z_index=1005,function(){_inherits(r,HTML);var n=_createSuper(r);function r(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=n.call(this)).opts=Object.assign(r.dflt_opts,t),e}return _createClass(r,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"molecule"),this.opts.molecule_id&&this.container.setAttribute("data-molecule-id",this.opts.molecule_id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,n){return this.container.addEventListener(e,t,n)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"molecule")}},{key:"dflt_opts",get:function(){return{molecule_id:null}}}]),r}()),PageOverlay=function(){_inherits(r,HTML);var n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).id=e,t.z_index=0,t.build(),t}return _createClass(r,[{key:"build",value:function(){var e=this;this.container=document.createElement("div"),this.container.className="".concat(env.APP_CSS_CLASS," page-overlay ").concat(this.id),this.transitioned_hiding=new TransitionedAction(this.container,"transitionend","hide"),this.transitioned_hiding.events.add_listener("action",function(){e.container.classList.remove("active")}),this.remover=new SlowlyRemovable(this.container,"transitionend"),document.body.appendChild(this.container)}},{key:"show",value:function(){this.z_index=env.page_overlay_z_index+2*window.project.page_overlay_count+++1,this.container.style.zIndex=this.z_index,this.container.classList.add("active")}},{key:"hide",value:function(){--project.page_overlay_count,this.transitioned_hiding.transition()}},{key:"remove",value:function(){--project.page_overlay_count,this.remover.remove()}}]),r}(),App=function(){function e(){_classCallCheck(this,e),this.events=new Events,project.instance=this}return _createClass(e,[{key:"init",value:function(){var t=this;this.updateBodyHeight(),window.addEventListener("resize",function(e){t.updateBodyHeight(),t.updateVhProperty()},!1)}},{key:"run",value:function(){var t=this;window.addEventListener("DOMContentLoaded",function(e){t.init()},!1)}},{key:"updateBodyHeight",value:function(){document.body.style.height="".concat(window.innerHeight,"px"),document.documentElement.style.setProperty("--body-height","".concat(window.innerHeight,"px"))}},{key:"updateVhProperty",value:function(){document.documentElement.style.setProperty("--vh","".concat(window.innerHeight/100,"px"))}}]),e}(),project=(moment.locale(env.LANG),window[window.env.APP_CSS_CLASS]={page_overlay_count:0,managers:{},events:new Events,errors:{}},window[window.env.APP_CSS_CLASS]);function parse_exploitation(e){var t,n;return e._exploitation_licence?(e=moment(e._exploitation_expiration),t="Licence d'exploitation ",n=(n=Math.ceil(moment().diff(e,"days",!0)))<0?(t+="expirée","expired"):0===n?(t+="expire aujourd'hui","warning"):n<30?(t+="expire dans ".concat(n," jour(s)"),"warning"):(t+="valide jusqu'à ".concat(e.format(env.H_DATE_FORMAT)),"valide"),{str:t,state:n}):{str:"Sans licence d'exploitation",state:"null"}}function common_mgr(e){var i="".concat(window.env.API_URL_BASE,"/api/").concat(env.USER.url_node,"/").concat(e.replace("_","-"));return{get:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:i+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})},range:function(e){var t=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:i+"/range",type:"application/json",data:{_factor:void 0===t?10:t,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(e){var t=e._str,n=e._factor,r=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:i+"/search",type:"application/json",data:{_str:t,_factor:void 0===n?10:n,_page:void 0===r?1:r,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register:function(e){var t=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:i+"/register",type:"application/json",data:{_code:t,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update:function(e){var t=e._id,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:i+"/update",type:"application/json",data:{_id:t,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:i+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})}}}window.storage={},project.events.define(["logout"]);var MapMenuBar=function(){_inherits(r,Molecule);var n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).build(e),t}return _createClass(r,[{key:"build",value:function(e){_get(_getPrototypeOf(r.prototype),"build",this).call(this,e),console.log(this.inner),this.lflt=L.map(this.inner).setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.lflt),L.marker([51.5,-.09]).addTo(this.lflt)}}]),r}(),PharmaciesMap=function(){_inherits(r,Molecule);var n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).build(e),t}return _createClass(r,[{key:"build",value:function(e){_get(_getPrototypeOf(r.prototype),"build",this).call(this,e),console.log(this.inner),this.lflt=L.map(this.inner).setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.lflt),L.marker([51.5,-.09]).addTo(this.lflt)}}]),r}(),Dpml=function(){_inherits(t,App);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this)}}]),t}(),Map=function(){_inherits(t,Dpml);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this),new PharmaciesMap(document.querySelector(".pharmacies-map"))}}]),t}(),map=new Map;map.run();