"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var e=_superPropBase(e,t);if(e)return(e=Object.getOwnPropertyDescriptor(e,t)).get?e.get.call(n):e.value})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _createForOfIteratorHelper(e,t){var n,i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var i=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,i?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Events=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Class Events";_classCallCheck(this,t),this.class=e,this.events=[],this.listeners={}}return _createClass(t,[{key:"define",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.events.includes(e[t])||(this.events.push(e[t]),this.listeners[e[t]]=[]);else if(e instanceof String||"string"==typeof e){if(this.events.includes(e))return this;this.events.push(e),this.listeners[e]=[]}else console.log("[".concat(this.class,"] trying to define event from unknown type"));return this}},{key:"add_listener",value:function(e,t){var n=this;return(Array.isArray(e)?e:[e]).forEach(function(e){n.events.includes(e)?n.listeners[e].push(t):console.log("[".concat(n.class,"] trying to listen undefined event: ")+e)}),this}},{key:"remove_listener",value:function(e,t){return this.events[e]&&(this.events.splice(this.events.indexOf(e),1),delete this.listeners[e]),this}},{key:"trigger",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;if(this.listeners[e])for(var n=0;n<this.listeners[e].length;n++)this.listeners[e][n](t);else console.log("[".concat(this.class,"]: try to trigger event: ")+e);return this}},{key:"pipe",value:function(n){var e=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t=null!=t?t:this.events;return n.define(t),t.forEach(function(t){return e.add_listener(t,function(e){if(i.hasOwnProperty(t))return n.trigger(t,i[t](e));n.trigger(t,e)})}),this}},{key:"funnel",value:function(e,t,n){var i=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return this.events.includes(n)?console.log("[".concat(this.class,"]: try to funnel on undefined event: ")+_event):t.forEach(function(t){e.add_listener(t,function(e){if(r.hasOwnProperty(t))return i.trigger(n,r[t](e));i.trigger(n,e)})}),this}},{key:"map",value:function(e,n){var i=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e.forEach(function(t){i.add_listener(t[0],function(e){n.trigger(t[1],r.hasOwnProperty(t[0])?r[t[0]](e):e)})}),this}}]),t}(),HTML=function(){function e(){_classCallCheck(this,e),this.events=new Events}return _createClass(e,[{key:"auto_build",get:function(){return!0}},{key:"base_bld",value:function(){}},{key:"build",value:function(){this.base_bld()}},{key:"html",value:function(){}}],[{key:"parse_element",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"div";return e instanceof HTMLElement?e:t instanceof String||"string"==typeof t?((t=document.createElement(t)).innerHTML+=e,t):null}},{key:"from_DOM",value:function(e){}}]),e}(),Molecules=function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"Molecule with a name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}(),Atoms=(window.molecules=new Molecules,function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"A atom with name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}()),Molecule=(window.atoms=new Atoms,function(){_inherits(i,HTML);var n=_createSuper(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,i),(e=n.call(this)).opts=Object.assign(i.dflt_opts,t),e}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"molecule"),this.opts.molecule_id&&this.container.setAttribute("data-molecule-id",this.opts.molecule_id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,n){return this.container.addEventListener(e,t,n)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"molecule")}},{key:"dflt_opts",get:function(){return{molecule_id:null}}}]),i}()),Atom=function(){_inherits(i,HTML);var n=_createSuper(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,i),(e=n.call(this)).opts=t,e}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"atom"),this.opts.id&&this.container.setAttribute("data-atom-id",this.opts.id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,n){return this.container.addEventListener(e,t,n)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"atom")}}]),i}(),RegexCollection=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"patterns",get:function(){return{email:/^[a-z][a-z0-9._-]{2,254}@[a-z0-9._-]{2,}\.[a-z]{2,4}$/i,alphabetic:/^[a-z]+$/i,numeric:/^[0-9]+$/,decimal:/^[0-9]+\.[0-9]+$/,name:/^[a-zàáâãäåæçèéêëìíîïðñòóôõöøœšÞùúûüýÿß' -]*$/i,name_with_number:/^[a-z0-9àáâãäåæçèéêëìíîïðñòóôõöøœšÞùúûüýÿß' -]*$/i,filename:/^[a-z0-9 $._-]+$/i,identifier:/^[a-z][a-z0-9_.-]{2,32}$/,password:/^[a-zA-Z0-9@_$#&()%-]{6,32}$/,date:{fr:/^[0-9]{2}-[0-9]{2}-[0-9]{4}$/,en:/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/},hour:/^[0-9]{1,2}:[0-9]{1,2}$/,telephone:/^\+?[0-9]{6,15}$/}}}]),e}(),Ajax=function(){function t(e){var n=this;_classCallCheck(this,t),this.options=e,this.xhr=new XMLHttpRequest,this.options.hasOwnProperty("loading")&&(this.xhr.onloadstart=this.options.loading),this.xhr.open(this.options.method,this.options.url),this.options.hasOwnProperty("type")&&null!==this.options.type&&"form-data"!==this.options.type&&this.xhr.setRequestHeader("Content-Type",this.options.type),this.options.hasOwnProperty("with_credentials")&&(this.xhr.withCredentials=this.options.with_credentials),this.promise=new Promise(function(e,t){n.xhr.onreadystatechange=function(){return 0===n.xhr.status&&2<n.xhr.readyState?t({code:"ABORTED"}):4===n.xhr.readyState?200===n.xhr.status?e(n.xhr.responseText):t({code:n.xhr.status}):void 0},n.options.hasOwnProperty("send")&&n.options.send&&n.send()})}return _createClass(t,[{key:"send",value:function(e){var t=null;return e?t=e:this.options.hasOwnProperty("data")&&(t="application/json"===this.options.type?JSON.stringify(this.options.data):this.options.data),this.xhr.send(t),this}},{key:"then",value:function(e){return this.promise=this.promise.then(e),this}},{key:"catch",value:function(e){return this.promise=this.promise.catch(e),this}},{key:"finally",value:function(e){return this.promise=this.promise.finally(e),this}},{key:"abort",value:function(){return this.xhr.abort(),this}}]),t}();function get_array_from_form_data(e){var t,n={},i=_createForOfIteratorHelper(e.entries());try{for(i.s();!(t=i.n()).done;){var r=t.value;n[r[0]]=r[1]}}catch(e){i.e(e)}finally{i.f()}return n}function get_form_data_from_array(e){if(e instanceof FormData)return e;var t,n=new FormData;for(t in e)e.hasOwnProperty(t)&&n.append(t,e[t]);return n}window.env.events=new Events,window.app={managers:{},events:new Events,instance:null},FormData.prototype.to_object=function(){return get_array_from_form_data(this)},FormData.from_object=function(e){return get_form_data_from_array(e)},window.app.events=new Events,window.app.events.define(["vertical_resize","horizontal_resize"]);var currentHeight=window.innerHeight,currentWidth=window.innerWidth,Collapsible=(window.addEventListener("resize",function(e){currentHeight!==(currentHeight=window.innerHeight)&&window.app.events.trigger("vertical_resize",e),currentWidth!==(currentWidth=window.innerWidth)&&window.app.events.trigger("horizontal_resize",e)},!1),env.H_DATE_FORMAT="DD MMMM YYYY",env.H_DATE_TIME_FORMAT="DD MMMM YYYY à HH:mm:ss",env.DATE_TIME_FORMAT="DD / MM / YYYY à HH:mm:ss",env.DATE_FORMAT="DD / MM / YYYY",env.page_overlay_z_index=1005,function(){_inherits(s,Molecule);var r=_createSuper(s);function s(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,s),(e=r.call(this)).rocker=n?HTML.parse_element(n):null,e.options=i,e.collapsed=null==(n=i.collapsed)||n,e.events.define(["collapsed","expanded"]),e.build(t),e}return _createClass(s,[{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;_get(_getPrototypeOf(s.prototype),"build",this).call(this,e),this.container.classList.add("collapsible"),this.collapsedHeight=null!=(e=null!=(e=this.options.collapsedHeight)?e:this.container.getAttribute("data-collapsed-height"))?e:s.DEFAULT_COLLAPSE_HEIGHT,this.rockerContainer=this.container.querySelector(".rocker-container"),this.rocker||(this.rocker=this.container.querySelector(".collapsible-rocker")),this.rocker&&this.rocker.addEventListener("click",function(e){t.toggle()},!1),this.collapsed?this.collapse():this.expand()}},{key:"collapse",value:function(){this.container.style.height=this.collapsedHeight,this.rocker&&this.rocker.classList.remove("collapse"),this.rocker&&this.rocker.classList.add("expand"),this.collapsed=!0,this.events.trigger("collapsed")}},{key:"expand",value:function(){this.container.style.height=this.inner.offsetHeight+(this.rockerContainer?this.rockerContainer.offsetHeight:0)+"px",this.rocker&&this.rocker.classList.remove("expand"),this.rocker&&this.rocker.classList.add("collapse"),this.collapsed=!1,this.events.trigger("expanded")}},{key:"toggle",value:function(){this.collapsed?this.expand():this.collapse()}},{key:"activate",value:function(){this.container.classList.remove("deactivated"),this.collapse()}},{key:"deactivate",value:function(){this.container.classList.add("deactivated"),this.container.style.height="unset"}}],[{key:"scan",value:function(){var e,t=_createForOfIteratorHelper(document.querySelectorAll(".ova.collapsible"));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.hasAttribute("data-scan-ignore")||(n.hasAttribute("id")?s.stack[n.id]=new s(n,document.querySelector(n.getAttribute("data-rocker"))):new s(n,document.querySelector(n.getAttribute("data-rocker"))))}}catch(e){t.e(e)}finally{t.f()}}}]),s}()),FormField=(Collapsible.stack={},Collapsible.DEFAULT_COLLAPSE_HEIGHT="0",function(){_inherits(r,Atom);var i=_createSuper(r);function r(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,r),(t=i.call(this)).events.define(["change","not_valid_value","error","disabled","enabled","focus","blur","submit"]),t.opts=Object.assign(r.dflt_opts,n),t.name=e,t._value=null,t._has_focus=!1,t._is_enabled=!0,t._is_locked=!1,t._rules=[],t.last_err=null,t}return _createClass(r,[{key:"value",get:function(){return this._value},set:function(e){this.last_err=this.validate(e),this._value=null===this.last_err?this.type_parser(e):this.opts.error_value}},{key:"has_focus",get:function(){return this._has_focus}},{key:"is_enabled",get:function(){return this._is_enabled}},{key:"is_disabled",get:function(){return!this.is_enabled}},{key:"is_locked",get:function(){return this._is_locked}},{key:"is_valid",get:function(){return!!this.is_disabled||(this.last_err=this.validate(this.value),null===this.last_err?(this.error_messenger&&this.error_messenger.leave(),!0):(this.error(this.last_err),!1))}},{key:"process_value",value:function(e){}},{key:"fill",value:function(e){this.value=e[this.name]}},{key:"clear",value:function(){}},{key:"enable",value:function(){this.is_locked||(this._is_enabled=!0)}},{key:"disable",value:function(){this.is_locked||(this._is_enabled=!1)}},{key:"lock",value:function(e){e?this.enable():this.disable(),this._is_locked=!0}},{key:"unlock",value:function(e){this._is_locked=!1,e?this.enable():this.disable()}},{key:"focus",value:function(){this._has_focus=!0}},{key:"blur",value:function(){this._has_focus=!1}},{key:"validate",value:function(e){if(!this.is_disabled){var t,n=_createForOfIteratorHelper(this._rules);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!i.validate(e,this))return i}}catch(e){n.e(e)}finally{n.f()}}return null}},{key:"reset",value:function(){this._value=this.opts.dflt_value,this.error_messenger.leave()}},{key:"add_rule",value:function(e){this._rules.push(e),this.last_err=this.validate(this.value)}},{key:"remove_rule",value:function(e){this._rules.splice(this._rules.indexOf(e),1)}},{key:"set_rules",value:function(e){this._rules=e}},{key:"error_messenger_bld",value:function(){}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("field")}},{key:"error",value:function(e){}},{key:"type_parser",value:function(e){return e}}],[{key:"dflt_opts",get:function(){return{interactive_control:!1,dflt_value:null,error_value:null}}}]),r}()),LoadingState=function(){function e(){_classCallCheck(this,e),this.events=new Events,this.events.define(["loaded","unloaded"]),this.count=0}return _createClass(e,[{key:"busy",get:function(){return 0<this.count}},{key:"load",value:function(){0==this.count++&&this.events.trigger("loaded")}},{key:"unload",value:function(){0==--this.count&&this.events.trigger("unloaded")}},{key:"unloaded",value:function(){return 0===this.count}}]),e}(),FormRule=function(){function e(){_classCallCheck(this,e),this._message=""}return _createClass(e,[{key:"validate",value:function(e){}},{key:"message",get:function(){return this._message},set:function(e){this._message=e}}]),e}(),TransitionedAction=function(){function i(e,t,n){_classCallCheck(this,i),this.events=new Events,this.events.define("action"),this.element=HTML.parse_element(e),this.cssEventType=t,this.class=n,this.listen()}return _createClass(i,[{key:"listen",value:function(){var t=this;this.element.addEventListener(this.cssEventType,function(e){e.target===t.element&&t.element.classList.contains(t.class)&&(e.stopPropagation(),t.events.trigger("action",t.element),t.element.classList.remove(t.class))},!1)}},{key:"transition",value:function(){this.element.classList.add(this.class)}}]),i}(),project=(window.app.managers.ajax={request:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=new Ajax(e);return n.then(function(e){var t=null;try{if("OK"===(t=JSON.parse(e)).status)return t.content}catch(e){}if("object"===_typeof(t))throw t;throw{code:"BAD_RESPONSE",content:{xhr:n.xhr}}}),n.catch(function(e){if("ABORTED"===e.code)throw e;var t=null;try{t=JSON.parse(n.xhr.responseText)}catch(e){}if(t&&t.status)throw{code:t.status,content:t};throw{code:"UNKNOWN",content:{err:e,xhr:n.xhr}}}),t&&t(n),n.send()}},moment.locale(env.LANG),window[window.env.APP_CSS_CLASS]={page_overlay_count:0,managers:{},events:new Events,errors:{}},window[window.env.APP_CSS_CLASS]);function parse_exploitation(e){var t,n;return e._exploitation_licence?(e=moment(e._exploitation_expiration),t="Licence d'exploitation ",n=(n=Math.ceil(moment().diff(e,"days",!0)))<0?(t+="expirée","expired"):0===n?(t+="expire aujourd'hui","warning"):n<30?(t+="expire dans ".concat(n," jour(s)"),"warning"):(t+="valide jusqu'à ".concat(e.format(env.H_DATE_FORMAT)),"valide"),{str:t,state:n}):{str:"Sans licence d'exploitation",state:"null"}}function common_mgr(e){var r="".concat(window.env.API_URL_BASE,"/api/").concat(env.USER.url_node,"/").concat(e.replace("_","-"));return{get:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:r+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})},range:function(e){var t=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:r+"/range",type:"application/json",data:{_factor:void 0===t?10:t,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(e){var t=e._str,n=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:r+"/search",type:"application/json",data:{_str:t,_factor:void 0===n?10:n,_page:void 0===i?1:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register:function(e){var t=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:r+"/register",type:"application/json",data:{_code:t,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update:function(e){var t=e._id,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:r+"/update",type:"application/json",data:{_id:t,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:r+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})}}}window.storage={},project.events.define(["logout"]);var LoadingFrame=function(){_inherits(n,Molecule);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).build(),e}return _createClass(n,[{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("loading-frame")}}],[{key:"from_DOM",value:function(e){var t=new n;return t.container=HTML.parse_element(e),t.container.classList.add("ova",env.APP_CSS_CLASS,"loading-frame"),t.inner=t.container.querySelector(".inner"),t}}]),n}(),Button=(FormField.prototype.error_messenger_bld=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=null!=e?e:document.createElement("div");e||(n.className="".concat(env.APP_CSS_CLASS," error-messenger collapsed"),n.setAttribute("data-collapsed-height","0"),n.innerHTML='<div class="inner"></div>',this.inner.appendChild(n)),this.error_messenger=new(function(){_inherits(n,Collapsible);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"leave",value:function(){this.collapse()}},{key:"notify",value:function(){this.expand()}}]),n}())(n),this.error_messenger.html().addEventListener("click",function(e){t.error_messenger.leave()},!1)},FormField.prototype.error=function(e){this.is_disabled||(this.error_messenger.html().querySelector(".inner").innerHTML=e.message,this.error_messenger.notify())},FormField.prototype.messenger_on_top=function(){this.container.classList.add("messenger-on-top")},function(){_inherits(i,Atom);var n=_createSuper(i);function i(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return _classCallCheck(this,i),e=n.call(this),t&&e.build(),e}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.createElement("a"),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("button"),this.container.setAttribute("tabindex",0)}}],[{key:"from_DOM",value:function(n){return new(function(){_inherits(t,i);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,n)}}]),t}())}}]),i}()),LoadableAtom=function(){_inherits(t,Atom);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this)}return _createClass(t,[{key:"build",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.loading_state=new LoadingState,this.loading_state.events.pipe(this.events,["loaded","unloaded"],{loaded:function(){e.container.classList.add("loaded")},unloaded:function(){e.container.classList.remove("loaded")}})}}]),t}(),LengthRule=function(){_inherits(i,FormRule);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this)).constraints=e,t._message="Veuillez entrer une chaîne de longueur",t.constraints.hasOwnProperty("is")&&(t._message+=" égale à "+t.constraints.is),t.constraints.hasOwnProperty("min")&&(t._message+=" supérieure à "+t.constraints.min),t.constraints.hasOwnProperty("max")&&(t._message+=(t.constraints.hasOwnProperty("min")?" et":"")+" inférieure à "+t.constraints.max),t}return _createClass(i,[{key:"validate",value:function(e){if(this.constraints.hasOwnProperty("is")){if(e.length!==this.constraints.is)return!1}else if(this.constraints.hasOwnProperty("min")){if(e.length<this.constraints.min)return!1}else if(this.constraints.hasOwnProperty("max")&&e.length>this.constraints.max)return!1;return!0}}]),i}(),SlowlyRemovable=function(){_inherits(r,TransitionedAction);var i=_createSuper(r);function r(e,t){var n;return _classCallCheck(this,r),(n=i.call(this,e,t,"slowly-removable-remove")).events.define("removed"),n.events.add_listener("action",function(){n.element.remove(),n.events.trigger("removed",n.element)}),n}return _createClass(r,[{key:"remove",value:function(){this.element.classList.add("slowly-removable-remove")}}]),r}(),IdentifierRule=(!function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return e.hasOwnProperty("method")||(e.method="POST"),e.hasOwnProperty("type")||(e.type="application/json"),window.app.managers.ajax.request(e,t)}project.managers.ajax={request:i,authenticated_request:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=(e.with_credentials=!0,localStorage.getItem("session_token"));return"application/json"!==e.type&&e.type?"form-data"===e.type&&(e.hasOwnProperty("data")||(e.data=new FormData),e.data.append("session_token",n)):(e.hasOwnProperty("data")||(e.data={}),e.data.session_token=n),i(e,t)}}}(),function(){_inherits(n,FormRule);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this))._message="Veuillez entrer un identifiant correct",e}return _createClass(n,[{key:"validate",value:function(e){return RegexCollection.patterns.identifier.test(e)}}]),n}()),ShortText=(!function(){var e=LoadingFrame.prototype.base_bld;LoadingFrame.prototype.base_bld=function(){e.apply(this),this.container.classList.add(env.APP_CSS_CLASS),this.container.innerHTML='<img src="/assets/media/loading.svg" alt=""/>'}}(),function(){_inherits(r,FormField);var n=_createSuper(r);function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:r.dflt_opts;return _classCallCheck(this,r),(e=n.call(this,e,t)).value="",e.build(),e}return _createClass(r,[{key:"placeholder",get:function(){return this.input.placeholder},set:function(e){this.input.placeholder=e}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(r.prototype),"enable",this).call(this),this.input.disabled=!1)}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(r.prototype),"disable",this).call(this),this.input.disabled=!0)}},{key:"focus",value:function(){_get(_getPrototypeOf(r.prototype),"focus",this).call(this),this.input.focus()}},{key:"blur",value:function(){_get(_getPrototypeOf(r.prototype),"blur",this).call(this),this.input.blur()}},{key:"fill",value:function(e){_get(_getPrototypeOf(r.prototype),"fill",this).call(this,e),this.input.value=null!=(e=this.value)?e:""}},{key:"clear",value:function(){this.value=""}},{key:"reset",value:function(){_get(_getPrototypeOf(r.prototype),"reset",this).call(this),this.input.value=this.opts.dflt_value}},{key:"set_type",value:function(e){this.opts.type=e,this.input.type=e}},{key:"type_parser",value:function(e){return"number"===this.opts.type?parseFloat(e):e}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("short-text",this.name),this.input=document.createElement("input"),this.input.name=this.name,this.inner.appendChild(this.input),this.error_messenger_bld()}},{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"build",this).call(this,e,n),this.input.addEventListener("focus",function(e){t._has_focus=!0,t.events.trigger("focus")},!1),this.input.addEventListener("blur",function(e){t._has_focus=!1,t.value=t.input.value,t.is_valid,t.events.trigger("blur")},!1)}}],[{key:"from_DOM",value:function(n,i){return new(function(){_inherits(t,r);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,i)}return _createClass(t,[{key:"base_bld",value:function(){this.container=n,this.inner=this.container.children[0],this.input=this.container.querySelector("input"),this.error_messenger_bld(this.container.querySelector(".error_messenger"))}}]),t}())}},{key:"dflt_opts",get:function(){return Object.assign(FormField.dflt_opts,{type:"text",dflt_value:"",error_value:""})}}]),r}()),PushButton=function(){_inherits(i,LoadableAtom);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this)).label=e,t.events.define(["pushed","released"]),t.build(),t}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("button","push-button"),this.inner.innerHTML=this.label,this.loading_layer=document.createElement("div"),this.loading_layer.className="layer loading",this.loading_layer.innerHTML='<img src="/assets/media/loading.gif" alt=""/>',this.container.appendChild(this.loading_layer)}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.addEventListener("click",function(e){t.loading_state.busy||t.push()},!1),this.loading_state.events.add_listener("unloaded",function(){return t.events.trigger("released")})}},{key:"push",value:function(){this.loading_state.load(),this.events.trigger("pushed")}},{key:"release",value:function(){this.loading_state.unload()}}],[{key:"from_DOM",value:function(n){return new(function(){_inherits(t,i);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){this.container=n,this.container.classList.add(window.env.APP_CSS_CLASS,"atom","button","push-button"),this.inner=this.container.children[0],this.inner.classList.add("inner"),this.loading_layer=this.container.children[1],this.loading_layer.classList.add("layer","loading")}}]),t}())}}]),i}(),PasswordRule=function(){_inherits(n,LengthRule);var t=_createSuper(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{min:6,max:32};return _classCallCheck(this,n),(e=t.call(this,e))._message="Votre mot de passe doit contenir au moins une lettre majuscule et minuscule, un chiffre et avoir une longueur comprise entre "+e.constraints.min+" et "+e.constraints.max+" caractères",e}return _createClass(n,[{key:"validate",value:function(e){return _get(_getPrototypeOf(n.prototype),"validate",this).call(this,e)&&RegexCollection.patterns.password.test(e)&&/[A-Z]/.test(e)&&/[a-z]/.test(e)&&/[0-9]/.test(e)}}]),n}(),FormManager=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:n.dflt_opts();_classCallCheck(this,n),this.form=e,this.async=t.async,this.fields=null!=(e=t.fields)?e:new Map,this.loading_state=null!=(e=t.loading_state)?e:new LoadingState,this.events=new Events,this.events.define(["submit"])}return _createClass(n,[{key:"values",value:function(){var n={};return this.fields.forEach(function(e,t){n[t]=e.value}),n}},{key:"form_data",value:function(){return new FormData(this.form)}},{key:"fill",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.fields.has(t)&&this.fields.get(t).fill(e)}},{key:"is_valid",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(e&&this.fields.has(e))return this.fields.get(e).is_valid;var t,n=_createForOfIteratorHelper(this.fields.values());try{for(n.s();!(t=n.n()).done;)if(!t.value.is_valid)return!1}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"add_field",value:function(e,t){this.fields.set(e,t)}},{key:"set_fields",value:function(e){this.fields=e}},{key:"submit",value:function(){var e=this;this.loading_state.load(),this.is_valid()&&(this.async?this.events.trigger("submit",{callback:function(){e.loading_state.unload()}}):(this.form.submit(),this.loading_state.unload()))}},{key:"reset",value:function(){var e,t=_createForOfIteratorHelper(this.fields.values());try{for(t.s();!(e=t.n()).done;)e.value.reset()}catch(e){t.e(e)}finally{t.f()}}},{key:"enabled",value:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(e)return e.forEach(function(e){n.fields.get(e)&&t?_fld.enable():_fld.disable()});this.fields.forEach(function(e){t?e.enable():e.disable()})}},{key:"enable",value:function(){this.enabled(!0)}},{key:"disable",value:function(){this.enabled(!1)}}],[{key:"dflt_opts",value:function(){return{async:!0,loading_state:new LoadingState,rules:{}}}}]),n}(),PageOverlay=function(){_inherits(i,HTML);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this)).id=e,t.z_index=0,t.build(),t}return _createClass(i,[{key:"build",value:function(){var e=this;this.container=document.createElement("div"),this.container.className="".concat(env.APP_CSS_CLASS," page-overlay ").concat(this.id),this.transitioned_hiding=new TransitionedAction(this.container,"transitionend","hide"),this.transitioned_hiding.events.add_listener("action",function(){e.container.classList.remove("active")}),this.remover=new SlowlyRemovable(this.container,"transitionend"),document.body.appendChild(this.container)}},{key:"show",value:function(){this.z_index=env.page_overlay_z_index+2*window.project.page_overlay_count+++1,this.container.style.zIndex=this.z_index,this.container.classList.add("active")}},{key:"hide",value:function(){--project.page_overlay_count,this.transitioned_hiding.transition()}},{key:"remove",value:function(){--project.page_overlay_count,this.remover.remove()}}]),i}(),App=function(){function e(){_classCallCheck(this,e),this.events=new Events,project.instance=this}return _createClass(e,[{key:"init",value:function(){var t=this;this.updateBodyHeight(),window.addEventListener("resize",function(e){t.updateBodyHeight(),t.updateVhProperty()},!1)}},{key:"run",value:function(){var t=this;window.addEventListener("DOMContentLoaded",function(e){t.init()},!1)}},{key:"updateBodyHeight",value:function(){document.body.style.height="".concat(window.innerHeight,"px"),document.documentElement.style.setProperty("--body-height","".concat(window.innerHeight,"px"))}},{key:"updateVhProperty",value:function(){document.documentElement.style.setProperty("--vh","".concat(window.innerHeight/100,"px"))}}]),e}(),url_base="".concat(env.API_URL_BASE,"/api/user"),mgr=(project.managers.auth={},project.managers.auth),LoginForm=(mgr.login=function(e){var t=e._identifier,e=e._password;return project.managers.ajax.request({method:"POST",url:"".concat(url_base,"/auth/login"),data:{_email:t,_password:e},type:"application/json",with_credentials:!0})},mgr.logout=function(){return project.managers.ajax.authenticated_request({method:"POST",url:"".concat(url_base,"/auth/logout")})},function(){_inherits(i,Molecule);var n=_createSuper(i);function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.querySelector(".".concat(env.APP_CSS_CLASS,".login-form"));return _classCallCheck(this,i),(e=n.call(this)).container=HTML.parse_element(t),e.build(),e}return _createClass(i,[{key:"build",value:function(){var t=this;this.form_mgr=new FormManager(this.container.querySelector("form")),this.mount(),this.submit_btn=PushButton.from_DOM(document.querySelector(".push-button.submit")),this.submit_btn.events.add_listener("pushed",function(e){t.auth()}),this.loading_state=this.submit_btn.loading_state}},{key:"mount",value:function(){var e=ShortText.from_DOM(this.form_mgr.form.querySelector("._identifier"),"_identifier"),e=(e.add_rule(new IdentifierRule),this.form_mgr.add_field("_identifier",e),ShortText.from_DOM(this.form_mgr.form.querySelector("._password"),"_password"));e.add_rule(new PasswordRule),this.form_mgr.add_field("_password",e)}},{key:"auth",value:function(){}}]),i}()),Notification=function(){_inherits(r,Molecule);var i=_createSuper(r);function r(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,r),(t=i.call(this)).message=e,t.options=Object.assign(r.dflt_opts,n),t.timeout_id=null,t.build(),t}return _createClass(r,[{key:"build",value:function(){var t=this;_get(_getPrototypeOf(r.prototype),"build",this).call(this),this.container.classList.add("notification"),this.inner.innerHTML='<div class="header"><a class="closer">\x3c!--span class="icofont-close"></span--\x3e</a></div>',this.inner.innerHTML+='<div class="body"><div class="inner">'.concat(this.message,"</div></div>"),this.container.querySelector(".closer").addEventListener("click",function(e){t.destruct()},!1),this.container.querySelector(".closer").addEventListener("transitionend",function(e){e.stopPropagation()},!1),this.container.addEventListener("transitionend",function(e){t.container.classList.contains("destruct")&&t.container.remove()},!1),document.body.appendChild(this.container),this.styling()}},{key:"html",value:function(){return this.container}},{key:"notify",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.delay;this.container.classList.add("active"),this.options.auto_destruct&&(this.timeout_id=setTimeout(function(){e.destruct()},t))}},{key:"destruct",value:function(){this.container.classList.add("destruct"),this.timeout_id&&clearTimeout(this.timeout_id)}},{key:"styling",value:function(){var e=this.container.offsetWidth;this.container.style.left=window.innerWidth/2-e/2+"px"}}],[{key:"dflt_opts",get:function(){return{auto_destruct:!0,delay:5e3}}}]),r}(),Dpml=function(){_inherits(t,App);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this)}}]),t}(),AdminLogin=function(){_inherits(t,Dpml);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this),this.login_form=new(function(){_inherits(t,LoginForm);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,document.querySelector(".".concat(env.APP_CSS_CLASS,".login-form")))}return _createClass(t,[{key:"auth",value:function(){var e=this;this.form_mgr.is_valid()?(this.form_mgr.disable(),project.managers.auth.login(this.form_mgr.values()).then(function(e){localStorage.setItem("session_token",e.session_token),document.location="/".concat(env.LANG,"/admin/dashboard")}).catch(function(e){("ADMINISTRATOR_WRONG_AUTH_PARAMETERS_ERROR"===e.code?new Notification("Identifiant ou mot de passe incorrect"):new Notification("Une erreur a été rencontrée lors de la demande")).notify()}).finally(function(){e.loading_state.unload(),e.form_mgr.enable()})):this.loading_state.unload()}}]),t}())}}]),t}(),login=new AdminLogin;login.run();