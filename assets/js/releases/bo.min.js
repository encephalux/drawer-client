"use strict";function set(e,t,i,n){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,i,n){var a,e=_superPropBase(e,t);if(e){if((a=Object.getOwnPropertyDescriptor(e,t)).set)return a.set.call(n,i),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(n,t)){if(!a.writable)return!1;a.value=i,Object.defineProperty(n,t,a)}else _defineProperty(n,t,i);return!0})(e,t,i,n)}function _set(e,t,i,n,a){if(!set(e,t,i,n||e)&&a)throw new Error("failed to set property");return i}function ownKeys(t,e){var i,n=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var e=_superPropBase(e,t);if(e)return(e=Object.getOwnPropertyDescriptor(e,t)).get?e.get.call(i):e.value})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(i){var n=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,n?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var i,n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){r=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw a}}}}function _unsupportedIterableToArray(e,t){var i;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var Molecules=function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"Molecule with a name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}(),Atoms=(window.molecules=new Molecules,function(){function e(){_classCallCheck(this,e),this.stack={}}return _createClass(e,[{key:"register",value:function(e,t){if(this.stack.hasOwnProperty(e))throw"A atom with name '"+e+"' was registered";this.stack[e]=t}},{key:"unregister",value:function(e){this.stack.hasOwnProperty(e)&&delete this.stack[e]}},{key:"replace",value:function(e,t){this.stack[e]=t}},{key:"class",value:function(e){if(this.stack.hasOwnProperty(e))return this.stack[e];throw"Unregistered molecule at '"+e+"'"}}]),e}()),Events=(window.atoms=new Atoms,function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Class Events";_classCallCheck(this,t),this.class=e,this.events=[],this.listeners={}}return _createClass(t,[{key:"define",value:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.events.includes(e[t])||(this.events.push(e[t]),this.listeners[e[t]]=[]);else if(e instanceof String||"string"==typeof e){if(this.events.includes(e))return this;this.events.push(e),this.listeners[e]=[]}else console.log("[".concat(this.class,"] trying to define event from unknown type"));return this}},{key:"add_listener",value:function(e,t){var i=this;return(Array.isArray(e)?e:[e]).forEach(function(e){i.events.includes(e)?i.listeners[e].push(t):console.log("[".concat(i.class,"] trying to listen undefined event: ")+e)}),this}},{key:"remove_listener",value:function(e,t){return this.events[e]&&(this.events.splice(this.events.indexOf(e),1),delete this.listeners[e]),this}},{key:"trigger",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;if(this.listeners[e])for(var i=0;i<this.listeners[e].length;i++)this.listeners[e][i](t);else console.log("[".concat(this.class,"]: try to trigger event: ")+e);return this}},{key:"pipe",value:function(i){var e=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t=null!=t?t:this.events;return i.define(t),t.forEach(function(t){return e.add_listener(t,function(e){if(n.hasOwnProperty(t))return i.trigger(t,n[t](e));i.trigger(t,e)})}),this}},{key:"funnel",value:function(e,t,i){var n=this,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return this.events.includes(i)?console.log("[".concat(this.class,"]: try to funnel on undefined event: ")+_event):t.forEach(function(t){e.add_listener(t,function(e){if(a.hasOwnProperty(t))return n.trigger(i,a[t](e));n.trigger(i,e)})}),this}},{key:"map",value:function(e,i){var n=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e.forEach(function(t){n.add_listener(t[0],function(e){i.trigger(t[1],a.hasOwnProperty(t[0])?a[t[0]](e):e)})}),this}}]),t}()),Ajax=function(){function t(e){var i=this;_classCallCheck(this,t),this.options=e,this.xhr=new XMLHttpRequest,this.options.hasOwnProperty("loading")&&(this.xhr.onloadstart=this.options.loading),this.xhr.open(this.options.method,this.options.url),this.options.hasOwnProperty("type")&&null!==this.options.type&&"form-data"!==this.options.type&&this.xhr.setRequestHeader("Content-Type",this.options.type),this.options.hasOwnProperty("with_credentials")&&(this.xhr.withCredentials=this.options.with_credentials),this.promise=new Promise(function(e,t){i.xhr.onreadystatechange=function(){return 0===i.xhr.status&&2<i.xhr.readyState?t({code:"ABORTED"}):4===i.xhr.readyState?200===i.xhr.status?e(i.xhr.responseText):t({code:i.xhr.status}):void 0},i.options.hasOwnProperty("send")&&i.options.send&&i.send()})}return _createClass(t,[{key:"send",value:function(e){var t=null;return e?t=e:this.options.hasOwnProperty("data")&&(t="application/json"===this.options.type?JSON.stringify(this.options.data):this.options.data),this.xhr.send(t),this}},{key:"then",value:function(e){return this.promise=this.promise.then(e),this}},{key:"catch",value:function(e){return this.promise=this.promise.catch(e),this}},{key:"finally",value:function(e){return this.promise=this.promise.finally(e),this}},{key:"abort",value:function(){return this.xhr.abort(),this}}]),t}();function get_array_from_form_data(e){var t,i={},n=_createForOfIteratorHelper(e.entries());try{for(n.s();!(t=n.n()).done;){var a=t.value;i[a[0]]=a[1]}}catch(e){n.e(e)}finally{n.f()}return i}function get_form_data_from_array(e){if(e instanceof FormData)return e;var t,i=new FormData;for(t in e)e.hasOwnProperty(t)&&i.append(t,e[t]);return i}window.env.events=new Events,window.app={managers:{},events:new Events,instance:null},FormData.prototype.to_object=function(){return get_array_from_form_data(this)},FormData.from_object=function(e){return get_form_data_from_array(e)},window.app.events=new Events,window.app.events.define(["vertical_resize","horizontal_resize"]);var currentHeight=window.innerHeight,currentWidth=window.innerWidth,HTML=(window.addEventListener("resize",function(e){currentHeight!==(currentHeight=window.innerHeight)&&window.app.events.trigger("vertical_resize",e),currentWidth!==(currentWidth=window.innerWidth)&&window.app.events.trigger("horizontal_resize",e)},!1),env.H_DATE_FORMAT="DD MMMM YYYY",env.H_DATE_TIME_FORMAT="DD MMMM YYYY à HH:mm:ss",env.DATE_TIME_FORMAT="DD / MM / YYYY à HH:mm:ss",env.DATE_FORMAT="DD / MM / YYYY",env.page_overlay_z_index=1005,function(){function e(){_classCallCheck(this,e),this.events=new Events}return _createClass(e,[{key:"auto_build",get:function(){return!0}},{key:"base_bld",value:function(){}},{key:"build",value:function(){this.base_bld()}},{key:"html",value:function(){}}],[{key:"parse_element",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"div";return e instanceof HTMLElement?e:t instanceof String||"string"==typeof t?((t=document.createElement(t)).innerHTML+=e,t):null}},{key:"from_DOM",value:function(e){}}]),e}()),project=(window.app.managers.ajax={request:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,i=new Ajax(e);return i.then(function(e){var t=null;try{if("OK"===(t=JSON.parse(e)).status)return t.content}catch(e){}if("object"===_typeof(t))throw t;throw{code:"BAD_RESPONSE",content:{xhr:i.xhr}}}),i.catch(function(e){if("ABORTED"===e.code)throw e;var t=null;try{t=JSON.parse(i.xhr.responseText)}catch(e){}if(t&&t.status)throw{code:t.status,content:t};throw{code:"UNKNOWN",content:{err:e,xhr:i.xhr}}}),t&&t(i),i.send()}},moment.locale(env.LANG),window[window.env.APP_CSS_CLASS]={page_overlay_count:0,managers:{},events:new Events,errors:{}},window[window.env.APP_CSS_CLASS]);function _parse_exploitation(e){var t,i;return e._exploitation_licence?(e=moment(e._exploitation_expiration),t="Licence d'exploitation ",i=(i=Math.ceil(moment().diff(e,"days",!0)))<0?(t+="expirée","expired"):0===i?(t+="expire aujourd'hui","warning"):i<30?(t+="expire dans ".concat(i," jour(s)"),"warning"):(t+="valide jusqu'à ".concat(e.format(env.H_DATE_FORMAT)),"valide"),{str:t,state:i}):{str:"Sans licence d'exploitation",state:"null"}}function common_mgr(e){var a="".concat(window.env.API_URL_BASE,"/api/").concat(env.USER.url_node,"/").concat(e.replace("_","-"));return{get:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:a+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})},range:function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:a+"/range",type:"application/json",data:{_factor:void 0===t?10:t,_page:void 0===i?1:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:a+"/search",type:"application/json",data:{_str:t,_factor:void 0===i?10:i,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register:function(e){var t=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:a+"/register",type:"application/json",data:{_code:t,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update:function(e){var t=e._id,i=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:a+"/update",type:"application/json",data:{_id:t,_code:i,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:a+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})}}}window.storage={},project.events.define(["logout"]);var Molecule=function(){_inherits(n,HTML);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(e=i.call(this)).opts=Object.assign(n.dflt_opts,t),e}return _createClass(n,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"molecule"),this.opts.molecule_id&&this.container.setAttribute("data-molecule-id",this.opts.molecule_id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,i){return this.container.addEventListener(e,t,i)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"molecule")}},{key:"dflt_opts",get:function(){return{molecule_id:null}}}]),n}(),Atom=function(){_inherits(n,HTML);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(e=i.call(this)).opts=t,e}return _createClass(n,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)||e&&Array.from(e.children).find(function(e){return e.classList.contains("inner")});this.container=e||document.createElement("div"),this.container.classList.add("ova",window.env.APP_CSS_CLASS,"atom"),this.opts.id&&this.container.setAttribute("data-atom-id",this.opts.id),t?this.inner=t:(this.inner=document.createElement("div"),this.inner.className="inner",this.container.appendChild(this.inner))}},{key:"build",value:function(){this.base_bld(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,1<arguments.length&&void 0!==arguments[1]?arguments[1]:null)}},{key:"html",value:function(){return this.container}},{key:"add_event_listener",value:function(e,t,i){return this.container.addEventListener(e,t,i)}},{key:"remove",value:function(){this.container.remove()}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}],[{key:"likefy",value:function(e){e.classList.add("ova",window.env.APP_CSS_CLASS,"atom")}}]),n}(),Collapsible=(!function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;return e.hasOwnProperty("method")||(e.method="POST"),e.hasOwnProperty("type")||(e.type="application/json"),window.app.managers.ajax.request(e,t)}project.managers.ajax={request:n,authenticated_request:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,i=(e.with_credentials=!0,localStorage.getItem("session_token"));return"application/json"!==e.type&&e.type?"form-data"===e.type&&(e.hasOwnProperty("data")||(e.data=new FormData),e.data.append("session_token",i)):(e.hasOwnProperty("data")||(e.data={}),e.data.session_token=i),n(e,t)}}}(),function(){_inherits(s,Molecule);var a=_createSuper(s);function s(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,s),(e=a.call(this)).rocker=i?HTML.parse_element(i):null,e.options=n,e.collapsed=null==(i=n.collapsed)||i,e.events.define(["collapsed","expanded"]),e.build(t),e}return _createClass(s,[{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;_get(_getPrototypeOf(s.prototype),"build",this).call(this,e),this.container.classList.add("collapsible"),this.collapsedHeight=null!=(e=null!=(e=this.options.collapsedHeight)?e:this.container.getAttribute("data-collapsed-height"))?e:s.DEFAULT_COLLAPSE_HEIGHT,this.rockerContainer=this.container.querySelector(".rocker-container"),this.rocker||(this.rocker=this.container.querySelector(".collapsible-rocker")),this.rocker&&this.rocker.addEventListener("click",function(e){t.toggle()},!1),this.collapsed?this.collapse():this.expand()}},{key:"collapse",value:function(){this.container.style.height=this.collapsedHeight,this.rocker&&this.rocker.classList.remove("collapse"),this.rocker&&this.rocker.classList.add("expand"),this.collapsed=!0,this.events.trigger("collapsed")}},{key:"expand",value:function(){this.container.style.height=this.inner.offsetHeight+(this.rockerContainer?this.rockerContainer.offsetHeight:0)+"px",this.rocker&&this.rocker.classList.remove("expand"),this.rocker&&this.rocker.classList.add("collapse"),this.collapsed=!1,this.events.trigger("expanded")}},{key:"toggle",value:function(){this.collapsed?this.expand():this.collapse()}},{key:"activate",value:function(){this.container.classList.remove("deactivated"),this.collapse()}},{key:"deactivate",value:function(){this.container.classList.add("deactivated"),this.container.style.height="unset"}}],[{key:"scan",value:function(){var e,t=_createForOfIteratorHelper(document.querySelectorAll(".ova.collapsible"));try{for(t.s();!(e=t.n()).done;){var i=e.value;i.hasAttribute("data-scan-ignore")||(i.hasAttribute("id")?s.stack[i.id]=new s(i,document.querySelector(i.getAttribute("data-rocker"))):new s(i,document.querySelector(i.getAttribute("data-rocker"))))}}catch(e){t.e(e)}finally{t.f()}}}]),s}()),FormField=(Collapsible.stack={},Collapsible.DEFAULT_COLLAPSE_HEIGHT="0",function(){_inherits(a,Atom);var n=_createSuper(a);function a(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),(t=n.call(this)).events.define(["change","not_valid_value","error","disabled","enabled","focus","blur","submit"]),t.opts=Object.assign(a.dflt_opts,i),t.name=e,t._value=null,t._has_focus=!1,t._is_enabled=!0,t._is_locked=!1,t._rules=[],t.last_err=null,t}return _createClass(a,[{key:"value",get:function(){return this._value},set:function(e){this.last_err=this.validate(e),this._value=null===this.last_err?this.type_parser(e):this.opts.error_value}},{key:"has_focus",get:function(){return this._has_focus}},{key:"is_enabled",get:function(){return this._is_enabled}},{key:"is_disabled",get:function(){return!this.is_enabled}},{key:"is_locked",get:function(){return this._is_locked}},{key:"is_valid",get:function(){return!!this.is_disabled||(this.last_err=this.validate(this.value),null===this.last_err?(this.error_messenger&&this.error_messenger.leave(),!0):(this.error(this.last_err),!1))}},{key:"process_value",value:function(e){}},{key:"fill",value:function(e){this.value=e[this.name]}},{key:"clear",value:function(){}},{key:"enable",value:function(){this.is_locked||(this._is_enabled=!0)}},{key:"disable",value:function(){this.is_locked||(this._is_enabled=!1)}},{key:"lock",value:function(e){e?this.enable():this.disable(),this._is_locked=!0}},{key:"unlock",value:function(e){this._is_locked=!1,e?this.enable():this.disable()}},{key:"focus",value:function(){this._has_focus=!0}},{key:"blur",value:function(){this._has_focus=!1}},{key:"validate",value:function(e){if(!this.is_disabled){var t,i=_createForOfIteratorHelper(this._rules);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(!n.validate(e,this))return n}}catch(e){i.e(e)}finally{i.f()}}return null}},{key:"reset",value:function(){this._value=this.opts.dflt_value,this.error_messenger.leave()}},{key:"add_rule",value:function(e){this._rules.push(e),this.last_err=this.validate(this.value)}},{key:"remove_rule",value:function(e){this._rules.splice(this._rules.indexOf(e),1)}},{key:"set_rules",value:function(e){this._rules=e}},{key:"error_messenger_bld",value:function(){}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("field")}},{key:"error",value:function(e){}},{key:"type_parser",value:function(e){return e}}],[{key:"dflt_opts",get:function(){return{interactive_control:!1,dflt_value:null,error_value:null}}}]),a}()),TransitionedAction=function(){function n(e,t,i){_classCallCheck(this,n),this.events=new Events,this.events.define("action"),this.element=HTML.parse_element(e),this.cssEventType=t,this.class=i,this.listen()}return _createClass(n,[{key:"listen",value:function(){var t=this;this.element.addEventListener(this.cssEventType,function(e){e.target===t.element&&t.element.classList.contains(t.class)&&(e.stopPropagation(),t.events.trigger("action",t.element),t.element.classList.remove(t.class))},!1)}},{key:"transition",value:function(){this.element.classList.add(this.class)}}]),n}(),Button=function(){_inherits(n,Atom);var i=_createSuper(n);function n(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return _classCallCheck(this,n),e=i.call(this),t&&e.build(),e}return _createClass(n,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.createElement("a"),t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("button"),this.container.setAttribute("tabindex",0)}}],[{key:"from_DOM",value:function(i){return new(function(){_inherits(t,n);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,i)}}]),t}())}}]),n}(),ProgressBar=function(){_inherits(n,Atom);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return _classCallCheck(this,n),(e=i.call(this)).target=t,e.level=0,e.factor=0,e.computable=!0,e.build(),e}return _createClass(n,[{key:"set_not_computable",value:function(){this.computable=!1,this.container.classList.add("not-computable")}},{key:"set_computable",value:function(){this.computable=!0,this.container.classList.remove("not-computable")}},{key:"set_target",value:function(e){this.target=e,this.set_computable(),this.set_level(this.level)}},{key:"set_level",value:function(e){this.computable&&(this.level=e,this.factor=this.level/this.target,this.inner.style.width="".concat(100*this.factor,"%"))}},{key:"set_completed",value:function(){this.container.classList.remove("not-computable"),this.container.classList.add("completed")}},{key:"set_success",value:function(){this.container.classList.add("success")}},{key:"set_error",value:function(){this.container.classList.add("error")}},{key:"reset",value:function(){this.container.classList.remove("completed","success","error"),this.set_level(0)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("progress-bar")}}]),n}(),Uploader=function(){function n(e){var t=e._url,i=e._files,e=e._text_flds;_classCallCheck(this,n),this.url=t,this.files=i,this.text_flds=null!=e?e:{},this.ajax=null,this.computable=null,this.events=new Events,this.events.define(["start","progress","cancelled","uploaded","success","error","aborted"])}return _createClass(n,[{key:"init",value:function(){this.form_data=FormData.from_object(this.text_flds);var e,t=_createForOfIteratorHelper(this.files);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.form_data.append("f_file",i)}}catch(e){t.e(e)}finally{t.f()}this.initialized=!0}},{key:"upload",value:function(){var i=this;this.initialized||this.init(),this.ajax=new Ajax({url:this.url,method:"POST",type:"form-data",data:this.form_data,with_credentials:!0}),this.ajax.xhr.upload.addEventListener("loadstart",function(e){i.computable=e.lengthComputable;var t={_computable:e.lengthComputable};e.lengthComputable&&(t._loaded=e.loaded,t._total=e.total),i.events.trigger("start",t)}),this.ajax.xhr.upload.addEventListener("progress",function(e){i.computable&&i.events.trigger("progress",{_loaded:e.loaded,_total:e.total})}),this.ajax.xhr.upload.addEventListener("load",function(e){i.events.trigger("uploaded",{_loaded:e.loaded,_total:e.total})}),this.ajax.xhr.addEventListener("error",function(e){console.log("eerooor")}),this.ajax.then(function(e){i.events.trigger("success",e)}).catch(function(e){i.events.trigger("error",e)}),this.ajax.send()}},{key:"cancel",value:function(){this.ajax.abort()}}]),n}(),url_base="".concat(env.USER.api_url_base,"/requests"),get=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:url_base+"/get",method:"POST",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},range=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:url_base+"/range",type:"application/json",data:{_factor:t,_page:i,filter:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register=function(e){e=e._request_type;return project.managers.ajax.authenticated_request({url:url_base+"/register",method:"POST",data:{_request_type:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove=function(e){e._id;return project.managers.ajax.authenticated_request({url:url_base+"/delete",method:"POST",data:{}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},Notification=(project.managers.requests={url_base:url_base,get:get,range:range,register:register,remove:remove},function(){_inherits(a,Molecule);var n=_createSuper(a);function a(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),(t=n.call(this)).message=e,t.options=Object.assign(a.dflt_opts,i),t.timeout_id=null,t.build(),t}return _createClass(a,[{key:"build",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.container.classList.add("notification"),this.inner.innerHTML='<div class="header"><a class="closer">\x3c!--span class="icofont-close"></span--\x3e</a></div>',this.inner.innerHTML+='<div class="body"><div class="inner">'.concat(this.message,"</div></div>"),this.container.querySelector(".closer").addEventListener("click",function(e){t.destruct()},!1),this.container.querySelector(".closer").addEventListener("transitionend",function(e){e.stopPropagation()},!1),this.container.addEventListener("transitionend",function(e){t.container.classList.contains("destruct")&&t.container.remove()},!1),document.body.appendChild(this.container),this.styling()}},{key:"html",value:function(){return this.container}},{key:"notify",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.options.delay;this.container.classList.add("active"),this.options.auto_destruct&&(this.timeout_id=setTimeout(function(){e.destruct()},t))}},{key:"destruct",value:function(){this.container.classList.add("destruct"),this.timeout_id&&clearTimeout(this.timeout_id)}},{key:"styling",value:function(){var e=this.container.offsetWidth;this.container.style.left=window.innerWidth/2-e/2+"px"}}],[{key:"dflt_opts",get:function(){return{auto_destruct:!0,delay:5e3}}}]),a}()),Layout=(FormField.prototype.error_messenger_bld=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=null!=e?e:document.createElement("div");e||(i.className="".concat(env.APP_CSS_CLASS," error-messenger collapsed"),i.setAttribute("data-collapsed-height","0"),i.innerHTML='<div class="inner"></div>',this.inner.appendChild(i)),this.error_messenger=new(function(){_inherits(i,Collapsible);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e)}return _createClass(i,[{key:"leave",value:function(){this.collapse()}},{key:"notify",value:function(){this.expand()}}]),i}())(i),this.error_messenger.html().addEventListener("click",function(e){t.error_messenger.leave()},!1)},FormField.prototype.error=function(e){this.is_disabled||(this.error_messenger.html().querySelector(".inner").innerHTML=e.message,this.error_messenger.notify())},FormField.prototype.messenger_on_top=function(){this.container.classList.add("messenger-on-top")},function(){function t(e){_classCallCheck(this,t),this.container=HTML.parse_element(e),this.container.classList.add(env.APP_CSS_CLASS,"layout"),this.events=new Events}return _createClass(t,[{key:"init",value:function(){}},{key:"add_item",value:function(e){}},{key:"remove_item",value:function(e){}},{key:"update",value:function(){}},{key:"clear",value:function(){}},{key:"empty",value:function(){}}]),t}()),LoadingFrame=function(){_inherits(i,Molecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("loading-frame")}}],[{key:"from_DOM",value:function(e){var t=new i;return t.container=HTML.parse_element(e),t.container.classList.add("ova",env.APP_CSS_CLASS,"loading-frame"),t.inner=t.container.querySelector(".inner"),t}}]),i}(),SlowlyRemovable=function(){_inherits(a,TransitionedAction);var n=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=n.call(this,e,t,"slowly-removable-remove")).events.define("removed"),i.events.add_listener("action",function(){i.element.remove(),i.events.trigger("removed",i.element)}),i}return _createClass(a,[{key:"remove",value:function(){this.element.classList.add("slowly-removable-remove")}}]),a}(),RegexCollection=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"patterns",get:function(){return{email:/^[a-z][a-z0-9._-]{2,254}@[a-z0-9._-]{2,}\.[a-z]{2,4}$/i,alphabetic:/^[a-z]+$/i,numeric:/^[0-9]+$/,decimal:/^[0-9]+\.[0-9]+$/,name:/^[a-zàáâãäåæçèéêëìíîïðñòóôõöøœšÞùúûüýÿß' -]*$/i,name_with_number:/^[a-z0-9àáâãäåæçèéêëìíîïðñòóôõöøœšÞùúûüýÿß' -]*$/i,filename:/^[a-z0-9 $._-]+$/i,identifier:/^[a-z][a-z0-9_.-]{2,32}$/,password:/^[a-zA-Z0-9@_$#&()%-]{6,32}$/,date:{fr:/^[0-9]{2}-[0-9]{2}-[0-9]{4}$/,en:/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/},hour:/^[0-9]{1,2}:[0-9]{1,2}$/,telephone:/^\+?[0-9]{6,15}$/}}}]),e}(),UploadMonitor=function(){_inherits(i,Molecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).events.define(["close","cancel"]),e.uploader=null,e.completed=!1,e.success=null,e.build(),e}return _createClass(i,[{key:"set_label",value:function(e){this.label.innerHTML=e}},{key:"attach_uploader",value:function(e){var i=this;this.uploader=e,this.uploader.events.add_listener("start",function(e){var t=e._computable,e=e._total;i.set_label("Envoi en cours..."),t?i.progress_bar.set_target(e):i.progress_bar.set_not_computable()}).add_listener("progress",function(e){e=e._loaded;i.progress_bar.set_level(e)}).add_listener("uploaded",function(){i.set_label("Finalisation...")}).add_listener("success",function(){i.set_success()}).add_listener("error",function(){i.set_error()})}},{key:"set_success",value:function(){this.success=!0,this.container.classList.add("success"),this.progress_bar.set_success(),this.set_label("Terminé"),this.cancel_btn.inner.innerHTML="Fermé"}},{key:"set_error",value:function(){this.success=!1,this.container.classList.add("error"),this.set_label("Echec"),this.progress_bar.set_error(),this.cancel_btn.inner.innerHTML="Fermé"}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("upload-monitor"),this.inner.innerHTML='\n            <div class="field label">Préparation</div>\n            <div class="progress-bar-slot"></div>\n            <div class="bottom">\n                <div class="state"></div>\n                <div class="cancel-btn-slot"></div>\n            </div>\n        ',this.label=this.inner.querySelector(".field.label"),this.progress_bar=new ProgressBar,this.inner.querySelector(".progress-bar-slot").appendChild(this.progress_bar.html()),this.progress_bar.set_not_computable(),this.cancel_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("canceller","inline"),this.inner.innerHTML="Annuler"}}]),t}()),this.inner.querySelector(".cancel-btn-slot").appendChild(this.cancel_btn.html())}},{key:"build",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.cancel_btn.add_event_listener("click",function(){e.completed||e.events.trigger("cancel"),e.events.trigger("close")})}}]),i}(),_url_base="".concat(env.USER.api_url_base,"/requests/required-documents"),_get2=function(e){var t=e._request,i=e._request_step,e=e._id;return project.managers.ajax.authenticated_request({url:_url_base+"/get",method:"POST",data:{_request:t,_request_step:i,_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_range=function(e){var t=e._request,i=e._request_step,n=e._factor,a=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base+"/range",type:"application/json",data:{_request:t,_request_step:i,_factor:n,_page:a,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search=function(e){var t=e._request,i=e._request_step,n=e._str,a=e._factor,s=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base+"/search",type:"application/json",data:{_request:t,_request_step:i,_str:n,_factor:a,_page:s,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},upload=function(e){var t=e._request,i=e._request_step,n=e._files,e=e._doc;return new Uploader({_url:"".concat(_url_base,"/upload/").concat(t,"/").concat(i,"/").concat(e),_files:n})},FileField=(project.managers.requests.required_documents={url_base:_url_base,get:_get2,range:_range,search:_search,upload:upload,compile:function(n,a){return{get:function(e){e=e._id;return _get2({_request:n,_request_step:a,_id:e})},range:function(e){var t=e._factor,e=e._page;return _range({_request:n,_request_step:a,_factor:t,_page:e})},search:function(e){var t=e._str,i=e._factor,e=e._page;return _search({_request:n,_request_step:a,_str:t,_factor:i,_page:e})}}}},function(){_inherits(s,FormField);var n=_createSuper(s);function s(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,s),(e=n.call(this,e)).events.define("change"),e.label=t,e.options=Object.assign(s.dflt_opts,i),e.build(),e}return _createClass(s,[{key:"value",get:function(){return _get(_getPrototypeOf(s.prototype),"value",this)},set:function(e){this.process_value(),this.last_err?(this.error(this.last_err),this.input.value=""):this.input.value=e}},{key:"process_value",value:function(e){e instanceof FileList?(this.last_err=this.validate(e),this.last_err||(this._value=e)):this._value=null}},{key:"is_valid",get:function(){var e;return!!this.is_disabled||!(!this.options.optional||null!==this.value&&0!==this.value.length)||((e=this.validate(this.value))&&this.error(e),!e)}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(s.prototype),"enable",this).call(this),this.input.disabled=!1)}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(s.prototype),"disable",this).call(this),this.input.disabled=!0)}},{key:"fill",value:function(e){e.hasOwnProperty(this.name)&&(this.value=e[this.name])}},{key:"reset",value:function(){this.value=null,this.input.value=""}},{key:"error_messenger_bld",value:function(){}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("file"),this.input=document.createElement("input"),this.input.type="file",this.input.name=this.name,this.inner.appendChild(this.input)}},{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(s.prototype),"build",this).call(this,e,i),this.input.addEventListener("change",function(e){t.process_value(t.input.files),t.is_enabled&&(t.last_err?t.error(t.last_err):t.events.trigger("change",t.value))},!1)}},{key:"from_DOM",value:function(i,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new(function(){_inherits(t,s);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,n,_title,a)}return _createClass(t,[{key:"base_bld",value:function(){this.container=HTML.parse_element(i),this.inner=this.container.children[0],this.input=this.container.querySelector("input")}}]),t}())}},{key:"error",value:function(e){new Notification(e.message).notify()}}],[{key:"dflt_opts",get:function(){return{optional:!1}}}]),s}()),State=function(){_inherits(s,Atom);var a=_createSuper(s);function s(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,s),(t=a.call(this)).opts=Object.assign(s.dflt_opts,n),t.states=e,t.cur_state=null,t.build(),t.set_state(i),t}return _createClass(s,[{key:"set_state",value:function(e){this.container.classList.remove(this.cur_state),this.cur_state=e,this.container.classList.add(this.cur_state),this.opts.has_label&&(this.label.innerHTML=this.parse_state(this.cur_state))}},{key:"parse_state",value:function(e){return this.states[e]}},{key:"base_bld",value:function(){_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this),this.container.classList.add("state"),this.inner.innerHTML='<span class="ball"></span>',this.opts.has_label?(this.label=document.createElement("span"),this.label.className="value font-small",this.inner.appendChild(this.label)):this.container.classList.add("no-label")}}],[{key:"dflt_opts",get:function(){return{has_label:!0}}}]),s}(),LongTextViewer=function(){_inherits(a,Atom);var n=_createSuper(a);function a(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:50;return _classCallCheck(this,a),(t=n.call(this)).text=e,t.excerpt_length=i,t.build(),t}return _createClass(a,[{key:"excerpt",get:function(){return this.text.length<this.excerpt_length?this.text:this.text.substring(0,this.excerpt_length-1)+"..."}},{key:"set_text",value:function(e){this.text=e}},{key:"expand",value:function(){this.inner.innerHTML=this.text}},{key:"base_bld",value:function(){_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("long-text-viewer"),this.inner.innerHTML='\n            <span class="excerpt">'.concat(this.excerpt,'</span>\n            \x3c!--a class="rocker">Tout lire</a>\n            <div class="text">\n                <a class="closer"></a>\n                <p>').concat(this.text,"</p>\n            </div--\x3e\n        ")}}]),a}(),Rollable=function(){_inherits(n,Molecule);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(e=i.call(this)).enrolled=!1,e.constraints=Object.assign(n.dflt_constraints,t),e}return _createClass(n,[{key:"unroll",value:function(){var e;this.container.classList.remove("rolled"),this.container.style.height=null!=(e=this.constraints.unrolled_height)?e:"".concat(this.inner.offsetHeight,"px"),this.enrolled=!0}},{key:"roll",value:function(){this.container.classList.add("rolled"),this.container.style.height=this.constraints.rolled_height,this.enrolled=!1}},{key:"attach_rocker",value:function(e){var t=this;e.events.add_listener("roll",function(){return t.roll()}).add_listener("unroll",function(){return t.unroll()})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("rollable")}}],[{key:"dflt_constraints",get:function(){return{rolled_height:0,unrolled_height:null}}}]),n}(),DataListItem=function(){_inherits(s,Molecule);var a=_createSuper(s);function s(e,t){var i,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:DataList.mngmt_modes.full;return _classCallCheck(this,s),(i=a.call(this)).oid=e,i.mngmt_mode=n,i.data=t,i.selected=!1,i.events.define(["edit","remove","select","unselect"]),i}return _createClass(s,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("data-list-item")}},{key:"update",value:function(e){}},{key:"release",value:function(){}}]),s}(),ListLayout=function(){_inherits(i,Layout);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e)}return _createClass(i,[{key:"init",value:function(){this.container.classList.add("list-layout"),this.clear()}},{key:"add_item",value:function(e){this.container.appendChild(e)}},{key:"remove_item",value:function(e){e.remove()}},{key:"update",value:function(){}},{key:"clear",value:function(){this.container.innerHTML=""}}]),i}(),LoadingState=function(){function e(){_classCallCheck(this,e),this.events=new Events,this.events.define(["loaded","unloaded"]),this.count=0}return _createClass(e,[{key:"busy",get:function(){return 0<this.count}},{key:"load",value:function(){0==this.count++&&this.events.trigger("loaded")}},{key:"unload",value:function(){0==--this.count&&this.events.trigger("unloaded")}},{key:"unloaded",value:function(){return 0===this.count}}]),e}(),PageOverlay=(!function(){var e=LoadingFrame.prototype.base_bld;LoadingFrame.prototype.base_bld=function(){e.apply(this),this.container.classList.add(env.APP_CSS_CLASS),this.container.innerHTML='<img src="/assets/media/loading.svg" alt=""/>'}}(),function(){_inherits(n,HTML);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this)).id=e,t.z_index=0,t.build(),t}return _createClass(n,[{key:"build",value:function(){var e=this;this.container=document.createElement("div"),this.container.className="".concat(env.APP_CSS_CLASS," page-overlay ").concat(this.id),this.transitioned_hiding=new TransitionedAction(this.container,"transitionend","hide"),this.transitioned_hiding.events.add_listener("action",function(){e.container.classList.remove("active")}),this.remover=new SlowlyRemovable(this.container,"transitionend"),document.body.appendChild(this.container)}},{key:"show",value:function(){this.z_index=env.page_overlay_z_index+2*window.project.page_overlay_count+++1,this.container.style.zIndex=this.z_index,this.container.classList.add("active")}},{key:"hide",value:function(){--project.page_overlay_count,this.transitioned_hiding.transition()}},{key:"remove",value:function(){--project.page_overlay_count,this.remover.remove()}}]),n}()),FormRule=function(){function e(){_classCallCheck(this,e),this._message=""}return _createClass(e,[{key:"validate",value:function(e){}},{key:"message",get:function(){return this._message},set:function(e){this._message=e}}]),e}(),DateRule=function(){_inherits(i,FormRule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this))._message="Veuillez sélectionner une date",e}return _createClass(i,[{key:"validate",value:function(e){return!(0===e.length||!e)&&RegexCollection.patterns.date.en.test(e)}}]),i}(),ShortText=function(){_inherits(a,FormField);var i=_createSuper(a);function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.dflt_opts;return _classCallCheck(this,a),(e=i.call(this,e,t)).value="",e.build(),e}return _createClass(a,[{key:"placeholder",get:function(){return this.input.placeholder},set:function(e){this.input.placeholder=e}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(a.prototype),"enable",this).call(this),this.input.disabled=!1)}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(a.prototype),"disable",this).call(this),this.input.disabled=!0)}},{key:"focus",value:function(){_get(_getPrototypeOf(a.prototype),"focus",this).call(this),this.input.focus()}},{key:"blur",value:function(){_get(_getPrototypeOf(a.prototype),"blur",this).call(this),this.input.blur()}},{key:"fill",value:function(e){_get(_getPrototypeOf(a.prototype),"fill",this).call(this,e),this.input.value=null!=(e=this.value)?e:""}},{key:"clear",value:function(){this.value=""}},{key:"reset",value:function(){_get(_getPrototypeOf(a.prototype),"reset",this).call(this),this.input.value=this.opts.dflt_value}},{key:"set_type",value:function(e){this.opts.type=e,this.input.type=e}},{key:"type_parser",value:function(e){return"number"===this.opts.type?parseFloat(e):e}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("short-text",this.name),this.input=document.createElement("input"),this.input.name=this.name,this.inner.appendChild(this.input),this.error_messenger_bld()}},{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(a.prototype),"build",this).call(this,e,i),this.input.addEventListener("focus",function(e){t._has_focus=!0,t.events.trigger("focus")},!1),this.input.addEventListener("blur",function(e){t._has_focus=!1,t.value=t.input.value,t.is_valid,t.events.trigger("blur")},!1)}}],[{key:"from_DOM",value:function(i,n){return new(function(){_inherits(t,a);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,n)}return _createClass(t,[{key:"base_bld",value:function(){this.container=i,this.inner=this.container.children[0],this.input=this.container.querySelector("input"),this.error_messenger_bld(this.container.querySelector(".error_messenger"))}}]),t}())}},{key:"dflt_opts",get:function(){return Object.assign(FormField.dflt_opts,{type:"text",dflt_value:"",error_value:""})}}]),a}(),RequestStepDocsDLI=function(){_inherits(a,DataListItem);var n=_createSuper(a);function a(e,t,i){return _classCallCheck(this,a),(e=n.call(this,e,t,i)).events.define(["resize"]),e.build(),e}return _createClass(a,[{key:"set_last_modification",value:function(e){this.last_modification.innerHTML=moment(e).format(env.H_DATE_TIME_FORMAT)}},{key:"refresh",value:function(){this.set_last_modification(this.data._last_modification_date),this.state.set_state(this.data._validation_state),this.events.trigger("resize")}},{key:"upload",value:function(e){var n=this;this.upload_monitor_bld(),this.uploader=project.managers.requests.required_documents.upload({_request:this.data.request_item.data._id,_request_step:this.data._request_step,_files:e,_doc:this.data._id}),this.uploader.events.add_listener("success",function(e){try{var t=JSON.parse(e).content,i=!n.data._upld_id;Object.assign(n.data,t),i&&n.file_overview_bld()||n.refresh()}catch(e){new Notification("Impossible de déterminer l'issue de l'envoi du fichier").notify()}}),this.upload_monitor.attach_uploader(this.uploader),this.upload_monitor.events.add_listener("start_upload",function(){return setTimeout(function(){return n.uploader.upload()},1100)})}},{key:"file_overview_bld",value:function(){this.data._upld_id&&(this.file_stat=new(function(){_inherits(i,Rollable);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("file-overview"),this.inner.innerHTML='\n                        <span class="label">Un fichier chargé</span>\n                        <span class="field extension">PDF</span>\n                        <div class="date">le <span class="field last-modification"></span></div>\n                        <div class="state-slot"></div>\n                        <div class="open-btn-slot"></div>\n                    '}}]),i}()),this.extension=this.file_stat.inner.querySelector(".field.extension"),this.last_modification=this.file_stat.inner.querySelector(".field.last-modification"),this.set_last_modification(this.data._last_modification_date),this.state=new State({undefined:"En attente de traitement",validated:"Validé",invalidated:"Invalidé"},this.data._validation_state),this.file_stat.inner.querySelector(".state-slot").appendChild(this.state.html()),this.file_opener=new(function(){_inherits(i,Button);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).events.define("open_file"),e}return _createClass(i,[{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("file-opener"),this.inner.innerHTML="Ouvrir",this.add_event_listener("click",function(){return e.events.trigger("open_file")})}}]),i}()),this.file_stat.inner.querySelector(".open-btn-slot").appendChild(this.file_opener.html()),this.inner.querySelector(".file-overview-slot").appendChild(this.file_stat.html()))}},{key:"upload_monitor_bld",value:function(){var e=document.createElement("div"),t=(e.className="monitor-wrapper",this.inner.appendChild(e),this.upload_monitor=new(function(){_inherits(i,UploadMonitor);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).events.define("start_upload"),e}return _createClass(i,[{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.label.addEventListener("animationend",function(e){"monitor_sliding"===e.animationName&&t.events.trigger("start_upload")})}}]),i}()),e.appendChild(this.upload_monitor.html()),new SlowlyRemovable(e,"transitionend"));this.upload_monitor.events.add_listener("close",function(){return t.remove()})}},{key:"base_bld",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("request-step-docs-dli"),this.inner.innerHTML='\n            <div class="naming">\n                <div class="field name">'.concat(this.data._name,'</div>\n                <div class="description-slot text-secondary"></div>\n            </div>\n            <div class="actions">\n                <div class="file-overview-slot"></div>\n                <div class="load-file-slot"></div>\n            </div>\n        '),this.description=new LongTextViewer(this.data._description,130),this.inner.querySelector(".description-slot").appendChild(this.description.html()),this.file_overview_bld(),this.data.request_item.data._locked||(this.load_file_btn=new(function(){_inherits(t,FileField);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.button=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("label")),this.container.classList.add("load-file","bordered","primary"),this.inner.innerHTML='Charger un fichier <span class="fi fi-rr-upload suffix"></span>'}}]),t}()),this.button.add_event_listener("click",function(){return e.input.click()}),this.inner.appendChild(this.button.html())}}]),t}()),this.load_file_btn.events.add_listener("change",function(e){t.upload(e)}),this.inner.querySelector(".load-file-slot").appendChild(this.load_file_btn.html()))}}]),a}(),DataListLayout=function(){_inherits(i,ListLayout);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),(e=t.call(this,e)).is_empty=!0,e}return _createClass(i,[{key:"init",value:function(){_get(_getPrototypeOf(i.prototype),"init",this).call(this),this.container.classList.add("data-list-layout")}},{key:"add_item",value:function(e){this.is_empty&&(this.clear(),this.is_empty=!1),_get(_getPrototypeOf(i.prototype),"add_item",this).call(this,e.html())}},{key:"remove_item",value:function(e){_get(_getPrototypeOf(i.prototype),"remove_item",this).call(this,e.html())}},{key:"empty",value:function(){this.is_empty=!0,this.container.classList.add("empty"),this.clear()}}]),i}(),DataList=function(){_inherits(r,Molecule);var s=_createSuper(r);function r(e,t){var i,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return _classCallCheck(this,r),(i=s.call(this,Object.assign(r.dflt_opts,n))).manager=e,i.factor=t,i.initialized=!1,i.items={},i.selected=i.opts.slct_mode===r.slct_modes.single?null:[],i.total=0,i.oid=0,i.cur_page=1,i.cur_ajax=null,i.filter=new Map,i.busy=!1,i.force_unlock=!1,i.searching=!1,i.cur_search_str="",i.locks={all:!1,adding:!1,updating:!1,removing:!1},i.events.define(["initialized","loading","loaded","edit","@search","selected","unselected","selection_change"]),i.loading_state=new LoadingState,i.loading_state.events.add_listener("loaded",function(){return i.busy=!0}).add_listener("unloaded",function(){return i.busy=!1}),a&&i.build(),i}return _createClass(r,[{key:"primary_key",get:function(){return"_id"}},{key:"item_class",get:function(){}},{key:"is_first_page",get:function(){return 1===this.cur_page}},{key:"is_last_page",get:function(){return this.cur_page>=Math.ceil(this.total/this.factor)}},{key:"can_lock",get:function(){var i=this;return new Promise(function(e,t){if(i.busy)return t({code:"BUSY_ERROR"});e()})}},{key:"can_next",get:function(){var e=this;return this.can_lock.then(function(){if(e.is_last_page)throw{code:"OUT_OF_BOUND_ERROR"}})}},{key:"can_previous",get:function(){var e=this;return this.can_lock.then(function(){if(e.is_first_page)throw{code:"OUT_OF_BOUND_ERROR"}})}},{key:"layout_bld",value:function(){this.layout=null}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("ova","data-list"),this.loading_frame=new LoadingFrame,this.container.appendChild(this.loading_frame.html()),this.layout_bld()}},{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"build",this).call(this,e,i),this.events.add_listener("@search",function(e){return t.search(e)}),this.loading_state.events.add_listener("loaded",function(){t.loading_frame.show(),t.events.trigger("loading")}).add_listener("unloaded",function(){t.loading_frame.hide()})}},{key:"load",value:function(e){var a=this,t=e._factor,i=void 0===t?this.factor:t,s=e._page;return this.can_lock.then(function(){a.loading_state.load();var e={_factor:i,_page:s,filter:a.process_filters()},n=a.searching?(e._str=a.cur_search_str,a.manager.search):a.manager.range;return new Promise(function(t,i){if(a.force_unlock)return a.loading_state.unload(),i({code:"ABORTED",content:{xhr:null}});n(e,function(e){return a.cur_ajax=e}).then(function(e){a.cur_page=s,a.parse_result(e),a.events.trigger("loaded"),t(e)}).catch(function(e){return i(e)}).finally(function(){a.cur_ajax=null,a.loading_state.unload()})})})}},{key:"force_load",value:function(e){var t=this,i=e._factor,n=void 0===i?this.factor:i,a=e._page;return this.force_unlock=!0,(null!==this.cur_ajax?this.cur_ajax.abort():Promise.resolve()).then(function(){return t.force_unlock=!1,t.load({_page:a,_factor:n})})}},{key:"leave_search",value:function(){if(this.opts.searchable)return this.searching=!1,this.cur_search_str="",this.force_load({_page:1})}},{key:"search",value:function(e){if(this.opts.searchable)return""===e?this.leave_search():(this.searching=!0,this.cur_search_str=e,this.force_load({_page:1}))}},{key:"init",value:function(){var e=this;return this.load({_page:1}).then(function(){e.initialized=!0,e.events.trigger("initialized")})}},{key:"reset",value:function(){return this.opts.slct_mode===r.slct_modes.single?null===this.selected?void 0:(this.selected.unselect(),void(this.selected=null)):(this.selected.forEach(function(e){return e.unselect()}),this.leave_search())}},{key:"refresh",value:function(){return this.load({_page:this.cur_page})}},{key:"process_item",value:function(t){var i=this,e="oid_".concat(++this.oid);if(this.opts.mngmt_mode===r.mngmt_modes.view)return new this.item_class(e,t,this.opts.mngmt_mode);if(this.opts.slct_mode===r.slct_modes.single&&this.selected){if(this.selected.data[this.primary_key]===t[this.primary_key])return this.selected.oid=e,this.selected}else if(this.opts.slct_mode===r.slct_modes.multiple){var n=this.selected.find(function(e){return e.data[i.primary_key]===t[i.primary_key]});if(n)return n.oid=e,n.update(t),n}n=new this.item_class(e,t,this.opts.mngmt_mode);return n.events.add_listener("select",function(e){return i.select_item(e)}).add_listener("unselect",function(e){return i.unselect_item(e)}),this.opts.mngmt_mode!==r.slct_modes.selector&&n.events.pipe(this.events,["edit"]).add_listener("remove",function(e){return i.remove_item(e)}),n}},{key:"select_item",value:function(e){this.opts.slct_mode===r.slct_modes.single?(this.selected&&(this.selected.unselect(),this.events.trigger("unselected",this.selected)),this.selected=e):this.opts.slct_mode===r.slct_modes.multiple&&this.selected.push(e),e.select(),this.events.trigger("selected",e).trigger("selection_change",this.selected)}},{key:"unselect_item",value:function(e){var t;this.opts.slct_mode===r.slct_modes.single?(e.unselect(),this.selected=null):(-1<(t=this.selected.indexOf(e))&&this.selected.splice(t,1),e.unselect()),this.events.trigger("unselected",e),this.events.trigger("selection_change",this.selected)}},{key:"add_item",value:function(t){var i=this;return this.busy=!0,this.manager.register(t).then(function(e){e=i.process_item(_objectSpread(_objectSpread({},t),e));return i.items[e.oid]=e}).finally(function(){return i.busy=!1})}},{key:"update_item",value:function(e,t){var i=this;return this.busy=!0,this.manager.update(_objectSpread(_defineProperty({},this.primary_key,e.data[this.primary_key]),t)).finally(function(){return i.busy=!1})}},{key:"remove_item",value:function(e){var t=this;return this.busy=!0,this.manager.remove(_defineProperty({},this.primary_key,e.data[this.primary_key])).then(function(){e.release(),t.busy=!1,t.refresh()}).catch(function(e){throw t.busy=!1,e})}},{key:"remove_selected",value:function(){var e=this;return this.loading_state.load(),this.manager.remove(_defineProperty({},this.primary_key,this.opts.slct_mode===r.slct_modes.single?this.selected.data._id:this.selected.map(function(e){return e.data._id}))).finally(function(){return e.loading_state.unload()})}},{key:"clear",value:function(){this.total=0,this.items={},this.layout.clear()}},{key:"next",value:function(){var e=this;return this.can_next.then(function(){return e.load({_page:e.cur_page+1})})}},{key:"previous",value:function(){var e=this;return this.can_previous.then(function(){return e.load({_page:e.cur_page-1})})}},{key:"add_filter",value:function(e,t){this.filter.set(e,t)}},{key:"update_filter",value:function(e,t){this.filter.set(e,t)}},{key:"remove_filter",value:function(e){this.filter.delete(e)}},{key:"process_filters",value:function(){var i=[];return this.filter.forEach(function(e,t){i.push({column:t,value:e})}),i}},{key:"serialize_filters",value:function(){var i="[";return this.filter.forEach(function(e,t){i+="".concat("",'{"column":"').concat(e,'", "value":"').concat(t[0],'"')}),i+"]"}},{key:"parse_result",value:function(e){if(0===e.total)return 0===this.total?void 0:(this.clear(),this.container.classList.add("empty"),this.layout.empty());0===this.total?this.container.classList.remove("empty"):this.clear(),this.total=e.total;var t,i=_createForOfIteratorHelper(e.list);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=this.process_item(n);this.items[a.oid]=a,this.layout.add_item(a)}}catch(e){i.e(e)}finally{i.f()}}},{key:"notify_busy",value:function(){new Notification("Veuillez patienter la fin de l'opération en cours puis réessayez.").notify()}}],[{key:"mngmt_modes",get:function(){return{view:"view",selector:"selector",full:"full"}}},{key:"slct_modes",get:function(){return{single:"single",multiple:"multiple"}}},{key:"dflt_opts",get:function(){return{slct_mode:r.slct_modes.multiple,mngmt_mode:r.mngmt_modes.full,searchable:!0}}}]),r}(),Popup=function(){_inherits(a,Molecule);var n=_createSuper(a);function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return _classCallCheck(this,a),(t=n.call(this,Object.assign(a.dflt_opts,t))).id=e,t.is_shown=!1,i&&t.build(),t}return _createClass(a,[{key:"base_bld",value:function(){_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("popup"),this.id&&this.container.classList.add(this.id),this.wrapper=document.createElement("div"),this.wrapper.classList.add("wrapper"),this.container.appendChild(this.wrapper),this.header=document.createElement("div"),this.header.className="header",this.wrapper.appendChild(this.header),this.wrapper.appendChild(this.inner),this.badge=document.createElement("div"),this.badge.className="badge",this.header.appendChild(this.badge),this.opts.closer&&(this.closer=document.createElement("a"),this.closer.className="".concat(env.APP_CSS_CLASS," closer"),this.header.appendChild(this.closer)),this.remover=new SlowlyRemovable(this.container,"transitionend"),this.transitioned_hiding=new TransitionedAction(this.container,"transitionend","hide"),this.page_overlay=new PageOverlay(this.id),document.body.appendChild(this.container)}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.transitioned_hiding.events.add_listener("action",function(){t.container.classList.remove("active")}),this.opts.closer&&this.closer.addEventListener("click",function(e){t.hide()},!1)}},{key:"show",value:function(){this.is_shown=!0,this.page_overlay.show(),this.container.style.zIndex="".concat(this.page_overlay.z_index+1),this.container.classList.add("active")}},{key:"hide",value:function(){this.page_overlay.hide(),this.transitioned_hiding.transition(),this.is_shown=!1}},{key:"remove",value:function(){this.page_overlay.remove(),this.remover.remove(),this.is_shown=!1}}],[{key:"dflt_opts",get:function(){return{closer:!0}}}]),a}();function make_promising(e){Object.defineProperty(e.prototype,"cur_reso",{value:null,writable:!0,configurable:!0,enumerable:!0}),Object.defineProperty(e.prototype,"cur_rej",{value:null,writable:!0,configurable:!0,enumerable:!0}),Object.defineProperty(e.prototype,"promise",{value:function(){var i=this;return new Promise(function(e,t){i.cur_reso=e,i.cur_rej=t})}})}var LengthRule=function(){_inherits(n,FormRule);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this)).constraints=e,t._message="Veuillez entrer une chaîne de longueur",t.constraints.hasOwnProperty("is")&&(t._message+=" égale à "+t.constraints.is),t.constraints.hasOwnProperty("min")&&(t._message+=" supérieure à "+t.constraints.min),t.constraints.hasOwnProperty("max")&&(t._message+=(t.constraints.hasOwnProperty("min")?" et":"")+" inférieure à "+t.constraints.max),t}return _createClass(n,[{key:"validate",value:function(e){if(this.constraints.hasOwnProperty("is")){if(e.length!==this.constraints.is)return!1}else if(this.constraints.hasOwnProperty("min")){if(e.length<this.constraints.min)return!1}else if(this.constraints.hasOwnProperty("max")&&e.length>this.constraints.max)return!1;return!0}}]),n}(),Checkbox=function(){_inherits(s,FormField);var a=_createSuper(s);function s(e){var t=e._name,i=e._label,n=e._checked_value,n=void 0===n||n,e=e._unchecked_value,e=void 0===e?void 0:e;return _classCallCheck(this,s),(t=a.call(this,t)).checked_value=n,t.unchecked_value=e,t._value=t.unchecked_value,t._is_checked=!1,t.label_str=i,t.events.define(["checked","unchecked","state_changed"]),t.build(),t}return _createClass(s,[{key:"is_checked",get:function(){return this._is_checked}},{key:"is_valid",get:function(){return!0}},{key:"value",get:function(){return this._value},set:function(e){this._value=e===this.checked_value?this.checked_value:this.unchecked_value}},{key:"fill",value:function(e){e.hasOwnProperty(this.name)&&(e[this.name]===this.checked_value?this.check():this.uncheck())}},{key:"reset",value:function(){this.uncheck()}},{key:"check",value:function(){this.is_disabled||(this.container.classList.add("checked"),this._is_checked=!0,this.value=this.checked_value,this.events.trigger("checked"),this.events.trigger("state_changed",!0))}},{key:"uncheck",value:function(){this.is_disabled||(this.container.classList.remove("checked"),this._is_checked=!1,this.value=this.unchecked_value,this.events.trigger("unchecked"),this.events.trigger("state_changed",!1))}},{key:"toggle",value:function(){this.is_disabled||(this.is_checked?this.uncheck():this.check())}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(s.prototype),"enable",this).call(this),this.container.classList.remove("disabled"))}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(s.prototype),"disable",this).call(this),this.container.classList.add("disabled"))}},{key:"base_bld",value:function(){_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("checkbox"),this.name&&this.container.classList.add(this.name),this.inner.innerHTML='\n            <div class="icon">\n                <span class="fi fi-rr-check"></span>\n            </div>\n            '.concat(this.label_str?'<div class="label">'.concat(this.label_str,"</div>"):"","\n        "),this.input=document.createElement("input"),this.input.type="hidden",this.inner.appendChild(this.input)}},{key:"build",value:function(){var e=this;_get(_getPrototypeOf(s.prototype),"build",this).call(this),this.container.addEventListener("click",function(){return e.toggle()},!1)}}]),s}(),LongText=function(){_inherits(a,FormField);var i=_createSuper(a);function a(e,t){return _classCallCheck(this,a),(e=i.call(this,e,Object.assign(a.dflt_opts,t)))._value="",e.build(),e}return _createClass(a,[{key:"placeholder",get:function(){this.textarea.placeholder},set:function(e){this.textarea.placeholder=e}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(a.prototype),"enable",this).call(this),this.textarea.disabled=!1)}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(a.prototype),"disable",this).call(this),this.textarea.disabled=!0)}},{key:"focus",value:function(){_get(_getPrototypeOf(a.prototype),"focus",this).call(this),this.textarea.focus()}},{key:"blur",value:function(){_get(_getPrototypeOf(a.prototype),"blur",this).call(this),this.textarea.blur()}},{key:"fill",value:function(e){if(!e.hasOwnProperty(this.name))return this.value="";_get(_getPrototypeOf(a.prototype),"fill",this).call(this,e),this.textarea.value=null!=(e=this.value)?e:""}},{key:"reset",value:function(){this.clear()}},{key:"clear",value:function(){this.value="",this.textarea.value=""}},{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("long-text",this.name),this.textarea=document.createElement("textarea"),this.textarea.name=this.name,this.inner.appendChild(this.textarea),this.error_messenger_bld()}},{key:"build",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(a.prototype),"build",this).call(this,e,i),this.textarea.addEventListener("focus",function(e){t._has_focus=!0,t.events.trigger("focus")},!1),this.textarea.addEventListener("blur",function(e){t._has_focus=!1,t.value=t.textarea.value,t.is_valid,t.events.trigger("blur")},!1)}}],[{key:"from_DOM",value:function(i,n){return new(function(){_inherits(t,a);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,n)}return _createClass(t,[{key:"base_bld",value:function(){this.container=HTML.parse_element(i),this.inner=this.container.children[0],this.textarea=this.container.querySelector("textarea"),this.error_messenger_bld(this.container.querySelector(".error_messenger"))}}]),t}())}},{key:"dflt_opts",get:function(){return{dflt_value:"",error_value:""}}}]),a}(),DateField=function(){_inherits(i,ShortText);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e)}return _createClass(i,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this,e,t),this.input.type="date"}},{key:"build",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(i.prototype),"build",this).call(this,e,t),this.add_rule(new DateRule)}}]),i}(),FormManager=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:i.dflt_opts();_classCallCheck(this,i),this.form=e,this.async=t.async,this.fields=null!=(e=t.fields)?e:new Map,this.loading_state=null!=(e=t.loading_state)?e:new LoadingState,this.events=new Events,this.events.define(["submit"])}return _createClass(i,[{key:"values",value:function(){var i={};return this.fields.forEach(function(e,t){i[t]=e.value}),i}},{key:"form_data",value:function(){return new FormData(this.form)}},{key:"fill",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.fields.has(t)&&this.fields.get(t).fill(e)}},{key:"is_valid",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(e&&this.fields.has(e))return this.fields.get(e).is_valid;var t,i=_createForOfIteratorHelper(this.fields.values());try{for(i.s();!(t=i.n()).done;)if(!t.value.is_valid)return!1}catch(e){i.e(e)}finally{i.f()}return!0}},{key:"add_field",value:function(e,t){this.fields.set(e,t)}},{key:"set_fields",value:function(e){this.fields=e}},{key:"submit",value:function(){var e=this;this.loading_state.load(),this.is_valid()&&(this.async?this.events.trigger("submit",{callback:function(){e.loading_state.unload()}}):(this.form.submit(),this.loading_state.unload()))}},{key:"reset",value:function(){var e,t=_createForOfIteratorHelper(this.fields.values());try{for(t.s();!(e=t.n()).done;)e.value.reset()}catch(e){t.e(e)}finally{t.f()}}},{key:"enabled",value:function(t){var i=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(e)return e.forEach(function(e){i.fields.get(e)&&t?_fld.enable():_fld.disable()});this.fields.forEach(function(e){t?e.enable():e.disable()})}},{key:"enable",value:function(){this.enabled(!0)}},{key:"disable",value:function(){this.enabled(!1)}}],[{key:"dflt_opts",value:function(){return{async:!0,loading_state:new LoadingState,rules:{}}}}]),i}(),Scalable=function(){_inherits(t,Molecule);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"show",value:function(){this.container.style.display="unset"}},{key:"hide",value:function(){this.hiding.transition()}},{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("scalable"),this.container.style.display="none",this.closer=document.createElement("a"),this.closer.className="scalable-closer",this.closer.addEventListener("click",function(){return e.hide()}),this.inner.appendChild(this.closer)}},{key:"build",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.hiding=new TransitionedAction(this.container,"transitionend","hide"),this.hiding.events.add_listener("action",function(){e.container.style.display="none"})}}]),t}(),Menu=function(){_inherits(a,Molecule);var n=_createSuper(a);function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return _classCallCheck(this,a),(t=n.call(this,t)).events.define("selected"),t.items_list=e,t.items=[],i&&t.build(),t}return _createClass(a,[{key:"add_item",value:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.createElement("a");return i.innerHTML=e.label,i.className="item ".concat(e.class),this.events.define(e.event),i.addEventListener("click",function(){t.events.trigger("selected",e),t.events.trigger(e.event)}),this.inner.appendChild(i),this.items.push(i),i}},{key:"base_bld",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("menu"),this.items_list.forEach(function(e){return t.add_item(e)})}}]),a}(),RequestStepDocsDL=function(){_inherits(a,DataList);var n=_createSuper(a);function a(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:5;return _classCallCheck(this,a),(i=n.call(this,project.managers.requests.required_documents.compile(e.data._id,t),i,{mngmt_mode:DataList.mngmt_modes.view})).request_item=e,i.request_step=t,i.events.define("resize"),i.build(),i}return _createClass(a,[{key:"item_class",get:function(){return RequestStepDocsDLI}},{key:"add_item",value:function(){}},{key:"update_item",value:function(){}},{key:"remove_item",value:function(){}},{key:"process_item",value:function(e){e.request_item=this.request_item,e._request_step=this.request_step;e=_get(_getPrototypeOf(a.prototype),"process_item",this).call(this,e);return e.events.pipe(this.events,["resize"]),e}},{key:"layout_bld",value:function(){this.layout=new DataListLayout(this.inner),this.layout.init()}},{key:"base_bld",value:function(){_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("request-step-docs-dl")}}]),a}(),Toggler=function(){_inherits(i,Button);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,!1)).events.define("toggled"),e.toggled=!1,e.build(),e}return _createClass(i,[{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("toggler"),this.add_event_listener("click",function(){e.container.classList.toggle("toggled"),e.toggled=!e.toggled,e.events.trigger("toggled",e.toggled)})}}]),i}(),LoadableAtom=function(){_inherits(t,Atom);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this)}return _createClass(t,[{key:"build",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.loading_state=new LoadingState,this.loading_state.events.pipe(this.events,["loaded","unloaded"],{loaded:function(){e.container.classList.add("loaded")},unloaded:function(){e.container.classList.remove("loaded")}})}}]),t}(),RequestStepsGraphBall=function(){_inherits(n,Atom);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.states.init;return _classCallCheck(this,n),(e=i.call(this)).build(),e.set_state(t),e}return _createClass(n,[{key:"base_bld",value:function(){this.container=document.createElement("div"),Atom.likefy(this.container),this.container.classList.add("request-steps-graph-ball")}},{key:"set_state",value:function(e){this.container.classList.remove(this.state),this.state=e,this.container.classList.add(this.state)}}],[{key:"states",get:function(){return{init:"init",invalidated:"invalidated",validated:"validated",undefined:"undefined"}}}]),n}(),Confirm=function(){_inherits(a,Molecule);var n=_createSuper(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,a),(e=n.call(this)).opts=Object.assign(a.dflt_opts,i),e.message=t,e.cur_reso=null,e.cur_rej=null,e.build(),e}return _createClass(a,[{key:"base_bld",value:function(){var t=this,e=(_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("confirm"),this.message&&((e=document.createElement("p")).innerHTML=this.message,this.inner.appendChild(e)),document.createElement("div")),i=(this.inner.appendChild(e),this.opts.accept_text),n=(this.confirm=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("filled","primary","confirm-btn"),this.inner.innerHTML=i}}]),t}()),this.confirm.add_event_listener("click",function(e){t.cur_reso&&t.cur_reso(!0)},!1),e.appendChild(this.confirm.html()),this.opts.cancel_text);this.cancel=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("filled","light","cancel"),this.inner.innerHTML=n}}]),t}()),this.cancel.add_event_listener("click",function(e){t.cur_reso&&t.cur_reso(!1)},!1),e.appendChild(this.cancel.html())}},{key:"promise",value:function(){var i=this;return new Promise(function(e,t){i.cur_reso=e,i.cur_rej=t})}}],[{key:"dflt_options",get:function(){return{accept_text:"Oui",cancel_text:"Non"}}}]),a}(),spr_build=RequestStepDocsDLI.prototype.build,ValidationFormPopup=(RequestStepDocsDLI.prototype.build=function(){var t=this,e=(spr_build.apply(this),"".concat(env.USER.api_url_base,"/requests/required-documents/file/").concat(this.data.request_item.data._id,"/").concat(this.data._request_step,"/").concat(this.data._id));this.data._upld_id&&this.file_opener.events.add_listener("open_file",function(){app.instance.file_viewer.show(e,t.data,{validation_ctrl:!t.data.request_item.data._locked}).add_listener("validation_state_change",function(e){t.data._validation_date=e._validation_date,t.data._validation_state=e._validation_state,t.refresh()})})},function(){_inherits(n,Popup);var i=_createSuper(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return _classCallCheck(this,n),(e=i.call(this,"validation-form-popup",Object.assign(n.dflt_opts,e),!1)).events.define(["confirmed","cancelled"]),t&&e.build(),e}return _createClass(n,[{key:"release",value:function(){this.send_btn.release(),this.form_mgr.enable()}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.inner.innerHTML='\n            <div class="title">'.concat(this.opts.title,'</div>\n            <div class="form"></div>\n        '),this.form=document.createElement("form"),this.inner.querySelector(".form").appendChild(this.form),this.mount();var e=validation_btns_bld(this.inner,{accept_text:this.opts.accept_text,cancel_text:this.opts.cancel_text}),t=e.validate,e=e.cancel;this.send_btn=t,this.cancel_btn=e}},{key:"mount",value:function(){var e,t=this;this.form_mgr=new FormManager(this.form),this.opts.required_treatment_date&&(this.treatment_date=new DateField("_treatment_date"),this.form.appendChild(this.treatment_date.html()),this.form_mgr.add_field("_treatment_date",this.treatment_date)),this.observation=new LongText("_observation"),this.observation.placeholder="Ajoutez vos observations",this.observation.add_rule(new LengthRule(this.opts.observation_constraint)),this.form.appendChild(this.observation.html()),this.form_mgr.add_field("_observation",this.observation),this.opts.commentable&&(this.use_obsvt_as_cmt=new Checkbox({_name:"_use_obsvt_as_cmt",_label:"Utiliser l'observation comme commentaire",_checked_value:!0,_unchecked_value:!1}),this.use_obsvt_as_cmt.events.add_listener("state_changed",function(e){e?(t.cmt_rollable.roll(),t.comment.disable()):(t.comment.enable(),t.cmt_rollable.unroll())}),this.form.appendChild(this.use_obsvt_as_cmt.html()),this.form_mgr.add_field("_use_obsvt_as_cmt",this.use_obsvt_as_cmt),this.comment=new LongText("comment"),this.comment.placeholder="Votre commentaire",this.comment.add_rule(new LengthRule(this.opts.comment_constraint)),this.form.appendChild(this.comment.html()),this.form_mgr.add_field("_comment",this.comment),e=this.comment.html(),this.cmt_rollable=new(function(){_inherits(i,Rollable);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("comment-rollable"),this.inner.innerHTML='\n                    <p class="note">Le commentaire est le message qui accompagne la notification envoyée par mail à l\'utilisateur</p>\n                ',this.inner.appendChild(e)}}]),i}()),this.form.appendChild(this.cmt_rollable.html()))}},{key:"build",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.send_btn.events.add_listener("pushed",function(){if(!e.form_mgr.is_valid())return e.send_btn.release();e.form_mgr.disable(),e.events.trigger("confirmed",{values:e.form_mgr.values(),popup:e})}),this.cancel_btn.add_event_listener("click",function(){return e.events.trigger("cancelled",{popup:e})})}}],[{key:"dflt_opts",get:function(){return{title:"Confirmation",accept_text:"Envoyer",cancel_text:"Annuler",required_treatment_date:!0,commentable:!0,closer:!1,observation_constraint:{min:10,max:2e3},comment_constraint:{min:10,max:2e3}}}}]),n}()),ScalableMenu=function(){_inherits(a,Scalable);var n=_createSuper(a);function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return _classCallCheck(this,a),(t=n.call(this,t)).items_list=e,i&&t.build(),t}return _createClass(a,[{key:"add_item",value:function(e){this.menu.add_item(e)}},{key:"base_bld",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("scalable-menu"),this.menu=new Menu(this.items_list),this.menu.events.pipe(this.events,null,{selected:function(e){return t.hide(),e}}),this.inner.appendChild(this.menu.html())}}]),a}(),_url_base2="".concat(env.USER.api_url_base,"/requests/story"),_get3=function(e){var t=e._request,e=e._id;return project.managers.ajax.authenticated_request({url:_url_base2+"/get",method:"POST",data:{_request:t,_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_range2=function(e){var t=e._request,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base2+"/range",type:"application/json",data:{_request:t,_factor:i,_page:n,filter:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search=function(e){var t=e._request,i=e._str,n=e._factor,a=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base2+"/search",type:"application/json",data:{_request:t,_str:i,_factor:n,_page:a,filter:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_validate=function(e,t){var i=e._request,n=e._request_step,a=e._treatment_date,e=e._observation;return project.managers.ajax.authenticated_request({url:_url_base2+"/validate-step",type:"application/json",data:{_request:i,_request_step:n,_treatment_date:a,_observation:void 0===e?null:e}},t)},_invalidate=function(e,t){var i=e._request,n=e._request_step,a=e._treatment_date,s=e._observation,r=e._use_obsvt_as_cmt,e=e._comment;return project.managers.ajax.authenticated_request({url:_url_base2+"/invalidate-step",type:"application/json",data:{_request:i,_request_step:n,_treatment_date:a,_observation:void 0===s?null:s,_use_obsvt_as_cmt:r,_comment:void 0===e?null:e}},t)},RequestStoryDLI=(project.managers.requests.story={get:_get3,range:_range2,search:search,validate:_validate,invalidate:_invalidate,compile:function(s){return{get:function(e,t){e=e._id;return _get3({_request:s,_id:e},t)},range:function(e,t){var i=e._factor,n=e._page,e=e.filter;return _range2({_request:s,_factor:i,_page:n,filter:e},t)},search:function(e,t){var i=e._str,n=e._factor,a=e._page,e=e.filter;return _range2({_request:s,_str:i,_factor:n,_page:a,filter:e},t)},validate:function(e,t){var i=e._request_step,n=e._treatment_date,e=e._observation;return _validate({_request:s,_request_step:i,_treatment_date:n,_observation:void 0===e?null:e},t)},invalidate:function(e,t){var i=e._request_step,n=e._treatment_date,a=e._observation,e=e._comment;return _invalidate({_request:s,_request_step:i,_treatment_date:n,_observation:void 0===a?null:a,_use_obsvt_as_cmt:_use_obsvt_as_cmt,_comment:void 0===e?null:e},t)}}}},function(){_inherits(a,DataListItem);var n=_createSuper(a);function a(e,t,i){return _classCallCheck(this,a),(e=n.call(this,e,t,i)).build(),e}return _createClass(a,[{key:"update",value:function(){0<arguments.length&&void 0!==arguments[0]||this.data;this.state.set_state(this.data._state),this.docs_stat_fld.innerHTML=this.docs_stat()}},{key:"docs_stat",value:function(){return 0===this.data._required_documents?"Aucun document requis":"".concat(this.data._uploaded_documents_count," sur ").concat(this.data._required_documents," documents fournis")}},{key:"base_bld",value:function(){var e,t=this;_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("request-story-dli"),this.inner.innerHTML='\n            <div class="about">\n                <div class="state-slot"></div>\n                <div class="field order">'.concat(this.data._order,'</div>\n                <div class="step-desc">\n                    <div class="field name">').concat(this.data._name,'</div>\n                    <div class="field description-slot font-small text-secondary"></div>\n                </div>\n                <div class="center">\n                    <div class="field required-documents-stat font-small">').concat(this.docs_stat(),'</div>\n                </div>\n                <div class="docs-rocker">\n                    <div class="documents-manager-rocker-slot"></div>\n                </div>\n            </div>\n            <div class="required-documents-slot"></div>\n        '),this.state=new State({undefined:"En cours",validated:"Validée",invalidated:"Invalidée"},this.data._state,{has_label:!1}),this.inner.querySelector(".state-slot").appendChild(this.state.html()),this.description=new LongTextViewer(this.data._description),this.inner.querySelector(".description-slot").appendChild(this.description.html()),this.docs_stat_fld=this.inner.querySelector(".field.required-documents-stat"),0<this.data._required_documents&&(this.step_docs_rocker=new(function(){_inherits(i,Toggler);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).events.define(["roll","unroll"]),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("bordered","primary"),this.inner.innerHTML='\n                        <span>Documents requis</span>\n                        <div class="icon">\n                            <span class="fi fi-rr-angle-small-down"></span>\n                        </div>\n                    '}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.events.add_listener("toggled",function(e){e?t.events.trigger("unroll"):t.events.trigger("roll")})}}]),i}()),this.inner.querySelector(".documents-manager-rocker-slot").appendChild(this.step_docs_rocker.html()),this.step_docs_dl=new RequestStepDocsDL(this.data.request_item,this.data._request_step),this.step_docs_dl_toolbar=new DataListToolbar("step-docs-toolbar",{add:!1,edit:!1,delete:!1}),this.step_docs_dl.init(),(e=new(function(){_inherits(a,Rollable);var n=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=n.call(this,{})).toolbar=e,i.dl=t,i.build(),i}return _createClass(a,[{key:"base_bld",value:function(){var e=this,t=(_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("required-documents-rollable"),this.roll(),document.createElement("div"));t.className="toolbar-wrapper",t.appendChild(this.toolbar.html()),this.inner.appendChild(t),this.inner.appendChild(this.dl.html()),this.dl.events.add_listener(["resize","loaded"],function(){return e.enrolled&&e.unroll()})}}]),a}())(this.step_docs_dl_toolbar,this.step_docs_dl)).attach_rocker(this.step_docs_rocker),this.step_docs_rocker.events.add_listener("unroll",function(){t.container.classList.add("unrolled")}).add_listener("roll",function(){t.container.classList.remove("unrolled")}),this.inner.querySelector(".required-documents-slot").appendChild(e.html()))}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"build",this).call(this),0<this.data._required_documents&&this.step_docs_dl_toolbar.events.add_listener("refresh",function(e){return t.step_docs_dl.refresh()}).add_listener("search",function(e){return t.step_docs_dl.search(e)}),this.update()}}]),a}()),PushButton=function(){_inherits(n,LoadableAtom);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this)).label=e,t.events.define(["pushed","released"]),t.build(),t}return _createClass(n,[{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("button","push-button"),this.inner.innerHTML=this.label,this.loading_layer=document.createElement("div"),this.loading_layer.className="layer loading",this.loading_layer.innerHTML='<img src="/assets/media/loading.gif" alt=""/>',this.container.appendChild(this.loading_layer)}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.container.addEventListener("click",function(e){t.loading_state.busy||t.push()},!1),this.loading_state.events.add_listener("unloaded",function(){return t.events.trigger("released")})}},{key:"push",value:function(){this.loading_state.load(),this.events.trigger("pushed")}},{key:"release",value:function(){this.loading_state.unload()}}],[{key:"from_DOM",value:function(i){return new(function(){_inherits(t,n);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){this.container=i,this.container.classList.add(window.env.APP_CSS_CLASS,"atom","button","push-button"),this.inner=this.container.children[0],this.inner.classList.add("inner"),this.loading_layer=this.container.children[1],this.loading_layer.classList.add("layer","loading")}}]),t}())}}]),n}(),ToolbarItem=function(){_inherits(a,Molecule);var n=_createSuper(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"toolbar-item",i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return _classCallCheck(this,a),(e=n.call(this)).id=t,i&&e.build(),e}return _createClass(a,[{key:"build",value:function(){_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.container.classList.add("toolbar-item",this.id)}},{key:"show",value:function(){this.container.classList.remove("hide")}},{key:"hide",value:function(){this.container.classList.add("hide")}}],[{key:"likefy",value:function(e){e.classList.add("toolbar-item")}}]),a}(),Toolbar=function(){_inherits(a,Molecule);var n=_createSuper(a);function a(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"toolbar",i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return _classCallCheck(this,a),(e=n.call(this)).id=t,e.items={},i&&e.build(),e}return _createClass(a,[{key:"build",value:function(){_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.container.classList.add("toolbar"),this.id&&this.container.classList.add(this.id)}},{key:"add_item",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return!this.items.hasOwnProperty(e)&&(this.items[e]=t,i?this.inner.insertBefore(t.html(),this.items[i].html()):this.inner.appendChild(t.html()),!0)}},{key:"remove_item",value:function(e){return!!this.items.hasOwnProperty(e)&&(this.items[e].remove(),delete this.items[e],!0)}},{key:"show_item",value:function(e){return!!this.items.hasOwnProperty(e)&&(this.items[e].show(),!0)}},{key:"hide_item",value:function(e){return!!this.items.hasOwnProperty(e)&&(this.items[e].hide(),!0)}},{key:"disable",value:function(){}}]),a}(),RequestStepsGraph=function(){_inherits(s,Molecule);var a=_createSuper(s);function s(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:RequestStepsGraphBall.states.init,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return _classCallCheck(this,s),(e=a.call(this)).cur_step=0,e.cur_step_state=RequestStepsGraphBall.states.init,e.steps_count=0,e.balls=[],e.build(),e.update_graph({_cur_step:t,_cur_step_state:i,_steps_count:n}),e}return _createClass(s,[{key:"init",value:function(){this.cur_step=0,this.cur_step_state=RequestStepsGraphBall.states.init,this.steps_count=0}},{key:"set_step",value:function(e,t){this.update_graph({_cur_step:e,_cur_step_state:t})}},{key:"clear",value:function(){this.balls.forEach(function(e){return e.remove()}),this.balls=[],this.init()}},{key:"error",value:function(){this.clear()}},{key:"set_steps_count",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.steps_count,t=e-this.steps_count;if(0<t)for(var i=0;i<t;i++){var n=new RequestStepsGraphBall;this.balls.push(n),this.inner.appendChild(n.html())}else t<0&&this.balls.splice(-1,-t).forEach(function(e){return e.remove()});this.steps_count=e}},{key:"update_graph",value:function(e){var t=e._cur_step,t=void 0===t?this.cur_step:t,i=e._cur_step_state,i=void 0===i?this.cur_step_state:i,e=e._steps_count;if(e&&this.set_steps_count(e),!(0<t&&t<=this.steps_count))return this.error();var n=t-this.cur_step;if(0!=n)for(var a=0<n?1:0;a<Math.abs(n);a++){var s=0<n?RequestStepsGraphBall.states.validated:RequestStepsGraphBall.states.init;this.balls[this.cur_step+(0<n?1:-1)*a-1].set_state(s)}this.balls[t-1].set_state(i),this.cur_step=t,this.cur_step_state=i}},{key:"base_bld",value:function(){_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this),this.container.classList.add("request-steps-graph")}}]),s}(),RowDock=function(){_inherits(i,Molecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).events.define(["edit","remove"]),e.selected=!1,e.build(),e}return _createClass(i,[{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.classList.add("row-dock"),this.wrapper=document.createElement("div"),this.wrapper.className="wrapper",this.inner.appendChild(this.wrapper),this.managing=document.createElement("div"),this.managing.className="managing",this.managing.innerHTML='\n            <a class="'.concat(env.APP_CSS_CLASS,' atom button action icon edit">\n                <div class="inner">\n                    <span class="fi fi-rr-pencil"></span>\n                </div>\n            </a>\n            <a class="').concat(env.APP_CSS_CLASS,' atom button action icon delete">\n                <div class="inner">\n                    <span class="fi fi-rr-trash"></span>\n                </div>\n            </a>\n        '),this.wrapper.appendChild(this.managing),this.managing.querySelector(".action.delete").addEventListener("click",function(e){t.events.trigger("remove")},!1),this.managing.querySelector(".action.edit").addEventListener("click",function(e){t.events.trigger("edit")},!1),this.selector=document.createElement("div"),this.selector.className="menu-icon",this.selector.innerHTML='<span class="fi fi-rr-angle-small-left"></span>',this.wrapper.appendChild(this.selector),this.loading_frame=new LoadingFrame,this.container.appendChild(this.loading_frame.html()),this.loading_state=new LoadingState,this.loading_state.events.add_listener("loaded",function(e){t.loading_frame.show()}).add_listener("unloaded",function(e){t.loading_frame.hide()})}},{key:"disable",value:function(){this.container.classList.add("disabled")}}]),i}(),spr_base_bld=RequestStoryDLI.prototype.base_bld,_spr_build=RequestStoryDLI.prototype.build,RequestStoryDL=(RequestStoryDLI.prototype.base_bld=function(){var i=this;spr_base_bld.apply(this),this.data.request_item.data._locked||(this.menu_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("icon","menu-rocker"),this.inner.innerHTML='\n                    <span class="fi fi-rr-menu-dots-vertical"></span>\n                '}}]),t}()),this.inner.querySelector(".about").appendChild(this.menu_btn.html()),this.menu=new(function(){_inherits(i,ScalableMenu);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,[{class:"validate-btn",event:"validate_step",label:"Valider cette étape"},{class:"invalidate-btn",event:"invalidate_step",label:"Invalider cette étape"}],{},!1)).events.define(["showing","hidden"]),e.build(),e}return _createClass(i,[{key:"show",value:function(){this.events.trigger("showing"),_get(_getPrototypeOf(i.prototype),"show",this).call(this)}},{key:"build",value:function(){_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.hiding.events.map([["action","hidden"]],this.events)}}]),i}()),this.menu.events.add_listener("showing",function(){return i.container.classList.add("menu-shown")}).add_listener("hidden",function(){return i.container.classList.remove("menu-shown")}).add_listener("validate_step",function(){if("validated"===i.data._state)return new Notification("Etape déjà validé!").notify();var t=new ValidationFormPopup({title:"Validation d'étape",commentable:!1});t.events.add_listener("confirmed",function(e){e=e.values;project.managers.requests.story.validate(_objectSpread({_request:i.data._request,_request_step:i.data._request_step},e)).then(function(e){t.remove(),i.data._state=e._state,i.data._state_date=e._state_date,i.update(),i.events.trigger("cur_step_changed",e._next_entry?{step:e.next_entry._request_step,order:e.next_entry._order,name:e.next_entry._name,state:e.next_entry._state}:{step:i.data._request_step,order:i.data._order,name:i.data._name,state:e._state})}).catch(function(e){t.release(),new Notification("Une erreur est survénue lors de l'opération").notify()})}).add_listener("cancelled",function(){return t.remove()}),t.show()}).add_listener("invalidate_step",function(){if("invalidated"===i.data._state)return new Notification("Etape déjà invalidé!").notify();var t=new ValidationFormPopup({title:"Invalidation d'étape"});t.events.add_listener("confirmed",function(e){e=e.values;project.managers.requests.story.invalidate(_objectSpread({_request:i.data._request,_request_step:i.data._request_step},e)).then(function(e){t.remove(),i.data._state=e._state,i.data._state_date=e._state_date,i.update(),i.events.trigger("cur_step_changed",{step:i.data._request_step,order:i.data._order,name:i.data._name,state:e._state})}).catch(function(e){t.release(),new Notification("Une erreur est survénue lors de l'opération").notify()})}).add_listener("cancelled",function(){return t.remove()}),t.show()}),this.container.appendChild(this.menu.html()),this.menu_btn.add_event_listener("click",function(){i.menu.show()}))},RequestStoryDLI.prototype.build=function(){this.events.define(["cur_step_changed"]),_spr_build.apply(this)},function(){_inherits(i,DataList);var t=_createSuper(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;return _classCallCheck(this,i),(e=t.call(this,null,e,{mngmt_mode:DataList.mngmt_modes.view})).request_item=null,e.build(),e}return _createClass(i,[{key:"item_class",get:function(){return RequestStoryDLI}},{key:"set_request",value:function(e){this.request_item=e,this.manager=project.managers.requests.story.compile(e.data._id),this.leave_search()}},{key:"init",value:function(){var e=this;return Promise.resolve().then(function(){e.initialized=!0})}},{key:"add_item",value:function(){}},{key:"update_item",value:function(){}},{key:"remove_item",value:function(){}},{key:"process_item",value:function(e){return e.request_item=this.request_item,_get(_getPrototypeOf(i.prototype),"process_item",this).call(this,e)}},{key:"layout_bld",value:function(){this.layout=new DataListLayout(this.inner),this.layout.init()}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("request-story-dl")}}]),i}());function validation_btns_bld(e,t){var i=Object.assign({accept_text:"Valider",cancel_text:"Annuler"},t),t=document.createElement("div"),e=(t.classList.add("actions"),e.appendChild(t),new(function(){_inherits(t,PushButton);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("filled","primary","validate"),this.inner.innerHTML=i.accept_text}}]),t}())),n=(t.appendChild(e.html()),new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("filled","light","cancel"),this.inner.innerHTML=i.cancel_text}}]),t}()));return t.appendChild(n.html()),{validate:e,cancel:n}}var DataListNavigator=function(){_inherits(n,Molecule);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this)).events.define(["next","previous"]),t.data_list=e,t.auto_build&&t.build(),t}return _createClass(n,[{key:"build",value:function(){var t=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.container.classList.add("data-list-navigator"),this.previous_page=document.createElement("a"),this.previous_page.className="".concat(window.env.APP_CSS_CLASS," atom button icon previous disabled"),this.previous_page.innerHTML='<div class="inner"><span class="fi fi-rr-arrow-small-left"></span></div>',this.previous_page.addEventListener("click",function(e){t.previous_page.classList.contains("disabled")||(t.next_page.classList.remove("disabled"),t.data_list.previous().then(function(){t.data_list.is_first_page&&t.previous_page.classList.add("disabled")}),t.events.trigger("previous"))},!1),this.inner.appendChild(this.previous_page),this.next_page=document.createElement("a"),this.next_page.className="".concat(window.env.APP_CSS_CLASS," atom button icon next disabled"),this.next_page.innerHTML='<div class="inner"><span class="fi fi-rr-arrow-small-right"></span></div>',this.next_page.addEventListener("click",function(e){t.next_page.classList.contains("disabled")||(t.previous_page.classList.remove("disabled"),t.data_list.next().then(function(){t.data_list.is_last_page&&t.next_page.classList.add("disabled")}),t.events.trigger("next"))},!1),this.inner.appendChild(this.next_page),this.refresh(),this.data_list.events.add_listener("loaded",function(){return t.refresh()})}},{key:"refresh_prev",value:function(){this.data_list.is_first_page?this.previous_page.classList.add("disabled"):this.previous_page.classList.remove("disabled")}},{key:"refresh_next",value:function(){this.data_list.is_last_page?this.next_page.classList.add("disabled"):this.next_page.classList.remove("disabled")}},{key:"refresh",value:function(){this.refresh_prev(),this.refresh_next()}}]),n}(),DataListToolbar=function(){_inherits(n,Toolbar);var i=_createSuper(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"data-list-toolbar",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,n),(e=i.call(this,e,!1)).events.define(["add","delete","edit","search","refresh"]),e.actions=Object.assign(n.dflt_actions,t),e.build(),e}return _createClass(n,[{key:"auto_build",get:function(){return!1}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.container.classList.add("data-list-toolbar"),this.id&&this.container.classList.add(this.id),this.actions.search&&(this.searcher=new(function(){_inherits(t,ToolbarItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("searcher");var e=document.createElement("span");e.className="fi fi-rr-search prefix",this.inner.appendChild(e),this.search_fld=new(function(){_inherits(n,ShortText);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"search_str")).events.define("search"),e}return _createClass(n,[{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.input.type="text",this.input.name="searcher",this.input.placeholder="Rechercher"}},{key:"build",value:function(){var i=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.input.addEventListener("keyup",function(e){var t=i.input.value.trim();""===t&&(i.input.value=""),i.events.trigger("search",t)},!1)}}]),n}()),this.inner.appendChild(this.search_fld.html())}},{key:"build",value:function(){_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.search_fld.events.pipe(this.events,["search"])}}]),t}()),this.add_item("searcher",this.searcher),this.searcher.events.pipe(this.events,["search"])),this.actions.add&&(this.add_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("filled","light","icon","toolbar-item","add"),this.inner.innerHTML='<span class="fi fi-rr-plus"></span>'}}]),t}()),this.add_btn.add_event_listener("click",function(e){t.events.trigger("add")},!1),this.add_item("add",this.add_btn)),this.actions.edit&&(this.edit_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("filled","light","icon","toolbar-item","edit"),this.inner.innerHTML='<span class="fi fi-rr-pencil"></span>'}}]),t}()),this.edit_btn.add_event_listener("click",function(e){t.events.trigger("edit")},!1),this.add_item("edit",this.edit_btn)),this.actions.delete&&(this.delete_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("filled","light","icon","toolbar-item","delete"),this.inner.innerHTML='<span class="fi fi-rr-trash"></span>'}}]),t}()),this.delete_btn.add_event_listener("click",function(e){t.events.trigger("delete")},!1),this.add_item("delete",this.delete_btn)),this.actions.refresh&&(this.refresh_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("filled","light","icon","toolbar-item","refresh"),this.inner.innerHTML='<span class="fi fi-rr-refresh"></span>'}}]),t}()),this.refresh_btn.add_event_listener("click",function(e){t.events.trigger("refresh")},!1),this.add_item("refresh",this.refresh_btn))}}],[{key:"dflt_actions",get:function(){return{add:!0,edit:!1,delete:!0,search:!0,refresh:!0}}}]),n}(),LoadableMolecule=function(){_inherits(t,Molecule);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this)}return _createClass(t,[{key:"build",value:function(){var e=this;_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.container.classList.add("loadable"),this.loading_frame=new LoadingFrame,this.container.appendChild(this.loading_frame.html()),this.loading_state=new LoadingState,this.loading_state.events.pipe(this.events,["loaded","unloaded"],{loaded:function(){return e.loading_frame.show()},unloaded:function(){return e.loading_frame.hide()}})}},{key:"load",value:function(){this.loading_state.load()}},{key:"unload",value:function(){this.loading_state.unload()}}]),t}(),SelectorItem=function(){_inherits(n,DataListItem);var i=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=i.call(this,e,t)).build(),e}return _createClass(n,[{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("selector-item"),this.container.addEventListener("click",function(){return e.events.trigger(e.selected?"unselect":"select",e)},!1)}},{key:"select",value:function(){this.selected||(this.selected=!0,this.container.classList.add("selected"))}},{key:"unselect",value:function(){this.selected&&(this.selected=!1,this.container.classList.remove("selected"))}}]),n}(),Selector=function(){_inherits(s,DataList);var a=_createSuper(s);function s(e){var t=e._val_key,i=e._manager,n=e._factor,n=void 0===n?15:n,e=e._opts,e=void 0===e?{}:e;return _classCallCheck(this,s),(i=a.call(this,i,n,Object.assign({mngmt_mode:DataList.mngmt_modes.selector,slct_mode:DataList.slct_modes.single},e))).val_key=t,i.process_item_temp=null,i}return _createClass(s,[{key:"layout_bld",value:function(){this.layout=new DataListLayout(this.inner),this.layout.init()}},{key:"base_bld",value:function(){_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this),this.container.classList.add("selector")}},{key:"load",value:function(e){var t=e._page,e=e._factor,e=void 0===e?this.factor:e;return _get(_getPrototypeOf(s.prototype),"load",this).call(this,{_page:t,_factor:e}).catch(function(e){if("ABORTED"!==e.code)throw e})}},{key:"process_item",value:function(e){var t=_get(_getPrototypeOf(s.prototype),"process_item",this).call(this,e);return this.opts.slct_mode===DataList.slct_modes.single&&this.process_item_temp&&this.process_item_temp[this.val_key]===e[this.val_key]&&(this.process_item_temp=null,t.events.trigger("select",t)),t}},{key:"select",value:function(e){var t=this;return(null!==this.cur_ajax?this.cur_ajax.abort():Promise.resolve()).then(function(){return t.loading_state.load(),t.manager.get(_defineProperty({},t.primary_key,e),function(e){return t.cur_ajax=e}).then(function(e){t.clear(),t.total=1,t.cur_page=1;e=t.process_item(e);t.items[e.oid]=e,t.layout.add_item(e),t.select_item(e),t.events.trigger("loaded")}).finally(function(){t.cur_ajax=null,t.loading_state.unload()})})}}]),s}(),RequestsDLI=function(){_inherits(a,DataListItem);var n=_createSuper(a);function a(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:DataList.mngmt_modes.full;return _classCallCheck(this,a),(e=n.call(this,e,t,i)).events.define("open"),e.build(),e}return _createClass(a,[{key:"lock_state_class",value:function(e){return e?"fi fi-rr-lock":"fi fi-rr-unlock"}},{key:"update",value:function(e){this.data=e,this.set_lock_state(this.data._locked),this.state.set_state(this.data._state),this.update_cur_step()}},{key:"update_cur_step",value:function(){this.cur_step.innerHTML=this.data._cur_step_name,this.steps_graph.clear(),this.steps_graph.update_graph({_cur_step:this.data._cur_step_order,_cur_step_state:this.data._cur_step_state,_steps_count:this.data._steps_count})}},{key:"set_lock_state",value:function(e){this.lock_state.className=this.lock_state_class(e)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("request"),this.inner.innerHTML='\n            <div class="row first">\n                <div class="lock-state">\n                    <span class="'.concat(this.lock_state_class(this.data._locked),'"></span>\n                </div>\n                <div class="type-date">\n                    <span class="type">').concat(this.data._request_type_name,'</span>\n                    <span class="date font-small">').concat(moment(this.data._inserted_at).format("DD MMMM YYYY"),'</span>\n                </div>\n                <div class="field cur-step">\n                    <span class="label font-small">Étape actuelle</span>\n                    <span class="value">__</span> \n                </div>\n                <div class="state-slot"></div>\n            </div>\n            <div class="row second"> \n                <div class="steps-graph"></div>\n                <div class="field uploaded-documents-count"></div>\n                <a class="').concat(env.APP_CSS_CLASS,' atom button filled primary open">\n                    <div class="inner">\n                        <span>Détails</span>\n                        <span class="fi fi-rr-angle-small-right suffix"></span>\n                    </div>\n                </a> \n            </div>\n        '),this.lock_state=this.inner.querySelector(".lock-state span"),this.cur_step=this.inner.querySelector(".field.cur-step .value"),this.state=new State({success:"Approuvée",fail:"Rejettée",progress:"En cours",default:"default"},this.data._state),this.inner.querySelector(".state-slot").appendChild(this.state.html()),this.steps_graph=new RequestStepsGraph(this.data._cur_step_order,this.data._cur_step_state,this.data._steps_count),this.inner.querySelector(".steps-graph").appendChild(this.steps_graph.html()),this.open=Button.from_DOM(this.container.querySelector(".button.open"))}},{key:"build",value:function(){var e=this;_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.cur_step.innerHTML=this.data._cur_step_name,this.open.add_event_listener("click",function(){return e.events.trigger("open",e)})}}]),a}(),DataTableItem=(!function(){var e=DataListLayout.prototype.empty;DataListLayout.prototype.empty=function(){e.apply(this),this.container.innerHTML='\n            <div class="block empty">\n                <div class="img">\n                    <img src="/assets/media/empty_result.webp" alt=""/>\n                </div>\n                <p>'.concat(this.searching?"Aucun résultat pour votre recherche":"Aucune donnée à afficher","</p>\n            </div>\n        ")}}(),function(){_inherits(a,DataListItem);var n=_createSuper(a);function a(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:DataList.mngmt_modes.full;return _classCallCheck(this,a),(e=n.call(this,e,t,i)).selected=!1,e.loading_state=new LoadingState,e.cells_stack=[],e.auto_build&&e.build(),e}return _createClass(a,[{key:"cells",value:function(){}},{key:"base_bld",value:function(){this.container=document.createElement("tr"),Molecule.likefy(this.container),this.container.classList.add("data-table-item");var e,t=document.createElement("td");t.className="checkbox-cell",this.checkbox=new Checkbox({}),t.appendChild(this.checkbox.html()),this.container.appendChild(t),this.cells(),this.mngmt_mode===DataList.mngmt_modes.full&&((t=document.createElement("td")).className="row-dock-cell",this.container.appendChild(t),(e=document.createElement("div")).className="inner",t.appendChild(e),this.dock=new RowDock,e.appendChild(this.dock.html()),this.loading_frame=new LoadingFrame,this.container.appendChild(this.loading_frame.html()))}},{key:"build",value:function(){var t=this;this.base_bld(),this.mngmt_mode!==DataList.mngmt_modes.view&&(this.mngmt_mode===DataList.mngmt_modes.selector?this.container.addEventListener("click",function(e){t.events.trigger("selected",t)}):(this.checkbox.events.map([["checked","select"],["unchecked","unselect"]],this.events,{checked:function(){return t},unchecked:function(){return t}}),this.dock.events.pipe(this.events,["edit","remove"],{edit:function(){return t},remove:function(){return t}}),this.loading_state.events.add_listener("loaded",function(e){t.loading_frame.show()}).add_listener("unloaded",function(e){t.loading_frame.hide()})))}},{key:"cell",value:function(t){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return e[t]},e=new(function(){_inherits(a,Molecule);var n=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=n.call(this)).parent=e,i.data=t,i.parser=s,i.build(),i}return _createClass(a,[{key:"base_bld",value:function(){this.container=document.createElement("td"),Molecule.likefy(this.container)}},{key:"build",value:function(){_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.container.classList.add("cell",t),this.container.innerHTML=this.parser(this.data),this.parent.appendChild(this.container)}},{key:"update",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.data;this.container.innerHTML=this.parser(e)}}]),a}())(this.container,this.data);return this.cells_stack.push(e),e}},{key:"update",value:function(e){var t=this;this.data=e?Object.assign(this.data,e):this.data,this.cells_stack.forEach(function(e){return e.update(t.data)})}},{key:"release",value:function(){this.mngmt_mode===DataList.mngmt_modes.full&&this.loading_state.unload()}},{key:"select",value:function(){this.selected=!0,this.container.classList.add("selected")}},{key:"unselect",value:function(){this.selected=!1,this.container.classList.remove("selected")}}]),a}());function common_cells(e){e.mngmt_mode===DataList.mngmt_modes.full&&e.cell("_code"),e.name=e.cell("_name")}var TableLayout=function(){_inherits(a,Layout);var n=_createSuper(a);function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,a),(e=n.call(this,e)).id="table-"+a.count++,e.constraints=i,e.columns=t,e.build(),e}return _createClass(a,[{key:"init",value:function(){_get(_getPrototypeOf(a.prototype),"init",this).call(this),this.table=document.createElement("table"),this.thead=document.createElement("thead"),this.thead.innerHTML='\n            <tr>\n                <th class="checkbox-cell"></th>\n                '.concat(this.columns.reduce(function(e,t){return"".concat(e,'<th class="cell">').concat(t,"</th>")},""),'\n                <th class="row-dock-cell"></th>\n            </tr>\n        '),this.table.appendChild(this.thead),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.container.appendChild(this.table),this.css()}},{key:"build",value:function(){this.container.classList.add("table-layout",this.id),this.style=document.createElement("style"),this.style.id=this.id,document.head.appendChild(this.style)}},{key:"add_item",value:function(e){this.tbody.appendChild(e.html())}},{key:"update",value:function(){this.css()}},{key:"css",value:function(){}},{key:"clear",value:function(){this.tbody.innerHTML="",this.items={}}}]),a}(),_url_base3=(TableLayout.count=0,"".concat(env.USER.api_url_base,"/towns")),_range3=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base3+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search2=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base3+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get4=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base3+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register=function(e){var t=e._prefecture,i=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base3+"/register",type:"application/json",data:{_prefecture:t,_code:i,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update=function(e){var t=e._id,i=e._prefecture,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base3+"/update",type:"application/json",data:{_id:t,_prefecture:i,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base3+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_url_base4=(project.managers.towns={range:_range3,search:_search2,get:_get4,register:_register,update:update,remove:_remove},"".concat(env.USER.api_url_base,"/requests-steps")),_range4=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base4+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search3=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base4+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get5=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base4+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register2=function(e){var t=e._request_type,i=e._establishment_type,n=e._code,a=e._name,s=e._description,r=e._delay,l=e._delay_unit,e=e._order;return project.managers.ajax.authenticated_request({url:_url_base4+"/register",type:"application/json",data:{_request_type:t,_establishment_type:i,_code:n,_name:a,_description:s,_delay:r,_delay_unit:l,_order:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update=function(e){var t=e._id,i=e._request_type,n=e._establishment_type,a=e._code,s=e._name,r=e._description,l=e._delay,o=e._delay_unit,e=e._order;return project.managers.ajax.authenticated_request({url:_url_base4+"/update",type:"application/json",data:{_id:t,_request_type:i,_establishment_type:n,_code:a,_name:s,_description:r,_delay:l,_delay_unit:o,_order:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove2=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base4+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_url_base5=(project.managers.requests_steps={range:_range4,get:_get5,search:_search3,register:_register2,update:_update,remove:_remove2},"".concat(env.USER.api_url_base,"/towns-ships")),_range5=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base5+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search4=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base5+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get6=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base5+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register3=function(e){var t=e._town,i=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base5+"/register",type:"application/json",data:{_town:t,_code:i,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update2=function(e){var t=e._id,i=e._town,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base5+"/update",type:"application/json",data:{_id:t,_town:i,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove3=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base5+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_url_base6=(project.managers.towns_ships={range:_range5,get:_get6,search:_search4,register:_register3,update:_update2,remove:_remove3},"".concat(env.USER.api_url_base,"/prefectures")),_range6=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base6+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search5=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base6+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get7=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base6+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register4=function(e){var t=e._administration_region,i=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base6+"/register",type:"application/json",data:{_administration_region:t,_code:i,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update3=function(e){var t=e._id,i=e._administration_region,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base6+"/update",type:"application/json",data:{_id:t,_administration_region:i,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove4=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base6+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_url_base7=(project.managers.prefectures={range:_range6,get:_get7,search:_search5,register:_register4,update:_update3,remove:_remove4},"".concat(env.USER.api_url_base,"/required-documents")),_range7=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base7+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search6=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base7+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get8=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base7+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register5=function(e){var t=e._request_type,i=e._establishment_type,n=e._request_step,a=e._name,e=e._description;return project.managers.ajax.authenticated_request({url:_url_base7+"/register",type:"application/json",data:{_request_type:t,_establishment_type:i,_request_step:n,_name:a,_description:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update4=function(e){var t=e._id,i=e._request_type,n=e._establishment_type,a=e._request_step,s=e._name,e=e._description;return project.managers.ajax.authenticated_request({url:_url_base7+"/update",type:"application/json",data:{_id:t,_request_type:i,_establishment_type:n,_request_step:a,_name:s,_description:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove5=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base7+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_url_base8=(project.managers.required_documents={range:_range7,get:_get8,search:_search6,register:_register5,update:_update4,remove:_remove5},"".concat(env.USER.api_url_base,"/health-districts")),_range8=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base8+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search7=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base8+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get9=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base8+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register6=function(e){var t=e._health_region,i=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base8+"/register",type:"application/json",data:{_health_region:t,_code:i,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update5=function(e){var t=e._id,i=e._health_region,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:_url_base8+"/update",type:"application/json",data:{_id:t,_health_region:i,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove6=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base8+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_url_base9=(project.managers.health_districts={range:_range8,get:_get9,search:_search7,register:_register6,update:_update5,remove:_remove6},"".concat(env.USER.api_url_base,"/administrators")),_range9=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base9+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search8=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base9+"/search",type:"application/json",data:{_str:t,_factor:void 0===i?10:i,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get10=function(e){var e=e._id,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return null};return project.managers.ajax.authenticated_request({url:_url_base9+"/get",type:"application/json",data:{_id:e},ajax_basket:t},t)},_register7=function(e){var t=e._last_name,i=e._first_name,n=e._identifier,a=e._password,s=e._dial_code,r=e._telephone,e=e._email;return project.managers.ajax.authenticated_request({url:_url_base9+"/register",type:"application/json",data:{_last_name:t,_first_name:i,_identifier:n,_password:a,_dial_code:s,_telephone:r,_email:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update6=function(e){var t=e._id,i=e._last_name,n=e._first_name,a=e._identifier,s=e._dial_code,r=e._telephone,e=e._email;return project.managers.ajax.authenticated_request({url:_url_base9+"/update",type:"application/json",data:{_id:t,_last_name:i,_first_name:n,_identifier:a,_dial_code:s,_telephone:r,_email:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return null})},_remove7=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base9+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return null})},spr_process_item=(project.managers.administrators={get:_get10,range:_range9,search:_search8,register:_register7,update:_update6,remove:_remove7},RequestStoryDL.prototype.process_item),_spr_build2=RequestStoryDL.prototype.build,RequestValidationPopup=(RequestStoryDL.prototype.process_item=function(e){e=spr_process_item.apply(this,[e]);return e.events.pipe(this.events,["cur_step_changed"]),e},RequestStoryDL.prototype.build=function(){this.events.define(["cur_step_changed"]),_spr_build2.apply(this)},function(){_inherits(n,Popup);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this,"request-validation-popup",{closer:!1})).events.define(["confirmed","cancelled"]),e}return _createClass(n,[{key:"release",value:function(){this.validate_btn.release(),this.form_mgr.enable()}},{key:"mount",value:function(){var t=this;this.treatment_date=new DateField("_treatment_date"),this.form.appendChild(this.treatment_date.html()),this.form_mgr.add_field("_treatment_date",this.treatment_date),this.lic_acquisition_date=new DateField("_lic_acquisition_date"),this.form.appendChild(this.lic_acquisition_date.html()),this.form_mgr.add_field("_lic_acquisition_date",this.lic_acquisition_date),this.lic_life_time=new Checkbox({_name:"_lic_life_time",_label:"Licence à vie",_unchecked_value:!1}),this.lic_life_time.events.add_listener("state_changed",function(e){e?t.lic_expiration_date.lock(!1):t.lic_expiration_date.unlock(!0)}),this.form.appendChild(this.lic_life_time.html()),this.form_mgr.add_field("_lic_life_time",this.lic_life_time),this.lic_expiration_date=new DateField("_lic_expiration_date"),this.form.appendChild(this.lic_expiration_date.html()),this.form_mgr.add_field("_lic_expiration_date",this.lic_expiration_date),this.lic_number=new ShortText("_lic_number"),this.lic_number.placeholder="N° de licence",this.lic_number.add_rule(new LengthRule({min:3,max:50})),this.form.appendChild(this.lic_number.html()),this.form_mgr.add_field("_lic_number",this.lic_number),this.observation=new LongText("_observation"),this.observation.placeholder="Vos observations",this.form.appendChild(this.observation.html()),this.observation.add_rule(new LengthRule({max:2e3})),this.form_mgr.add_field("_observation",this.observation)}},{key:"base_bld",value:function(){var e=this,t=(_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.inner.innerHTML='\n            <div class="title">Acceptation de demande</div>\n            <div class="form"></div>\n        ',this.form=document.createElement("form"),this.inner.querySelector(".form").appendChild(this.form),this.form_mgr=new FormManager(this.form),this.mount(),validation_btns_bld(this.inner)),i=t.validate,t=t.cancel;(this.validate_btn=i).events.add_listener("pushed",function(){if(!e.form_mgr.is_valid())return e.validate_btn.release();e.form_mgr.disable(),e.events.trigger("confirmed",{values:e.form_mgr.values(),popup:e})}),t.add_event_listener("click",function(){return e.events.trigger("cancelled",{popup:e})})}}]),n}()),RequestViewer=function(){_inherits(i,LoadableMolecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).item=null,e.events.define("request_updated"),e.build(),e}return _createClass(i,[{key:"show",value:function(e){this.item=e,this.update(),this.story.set_request(this.item),_get(_getPrototypeOf(i.prototype),"show",this).call(this)}},{key:"update",value:function(){if(!this.item)return this.clear();this.parse_lock_state(),this.request_type.innerHTML=this.item.data._request_type_name,this.date.innerHTML=moment(this.item.data._inserted_at).format(env.H_DATE_FORMAT),this.state.set_state(this.item.data._state),this.update_cur_step()}},{key:"update_cur_step",value:function(){this.cur_step_name.innerHTML=this.item.data._cur_step_name,this.steps_graph.clear(),this.steps_graph.update_graph({_cur_step:this.item.data._cur_step_order,_cur_step_state:this.item.data._cur_step_state,_steps_count:this.item.data._steps_count})}},{key:"clear",value:function(){this.parse_lock_state(),this.request_type.innerHTML="",this.date.innerHTML="",this.steps_graph.clear(),this.cur_step_name.innerHTML="",this.state.set_state()}},{key:"parse_state",value:function(e){switch(e){case"progress":return"En cours";case"fail":return"Rejettée";case"success":return"Approuvée";default:return"__"}}},{key:"parse_lock_state",value:function(){this.item&&this.item.data._locked?this.container.classList.add("locked"):this.container.classList.remove("locked")}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("request-viewer"),this.closer=document.createElement("a"),this.closer.className="closer",this.container.appendChild(this.closer),this.inner.innerHTML='\n            <div class="header">\n                <div class="block top">\n                    <div class="left">\n                        <div class="lock-state">\n                            <span class="fi fi-rr-lock locked"></span>\n                            <span class="fi fi-rr-unlock unlocked"></span>\n                        </div>\n                        <div class="type-date"> \n                            <span class="field request-type"></span>\n                            <span class="field date font-small"></span>\n                        </div>\n                    </div> \n                    <div class="right">\n                        <div class="request-state-slot">\n                        </div>\n                    </div>\n                </div>\n                <div class="steps-summary">\n                    <div class="graph-slot"></div>\n                    <div class="right">\n                        <div class="font-small">Etape actuelle</div>\n                        <div class="field cur-step-name"></div>\n                    </div>\n                </div>\n            </div>\n            <div class="story">\n                <div class="story-toolbar-slot"></div>\n                <div class="story-slot"></div>\n            </div>\n        ',this.request_type=this.inner.querySelector(".field.request-type"),this.date=this.inner.querySelector(".field.date"),this.cur_step_name=this.inner.querySelector(".field.cur-step-name"),this.state=new State({progress:"En cours",success:"Validée",fail:"Rejetée"},"progress",{has_label:!1}),this.inner.querySelector(".request-state-slot").appendChild(this.state.html()),this.steps_graph=new RequestStepsGraph,this.inner.querySelector(".steps-summary .graph-slot").appendChild(this.steps_graph.html()),this.story=new RequestStoryDL,this.inner.querySelector(".story-slot").appendChild(this.story.html()),this.story_toolbar=new DataListToolbar("request-story",{add:!1,edit:!1,delete:!1}),this.inner.querySelector(".story-toolbar-slot").appendChild(this.story_toolbar.html()),this.story_navigator=new DataListNavigator(this.story),ToolbarItem.likefy(this.story_navigator.html()),this.story_toolbar.add_item("navigator",this.story_navigator)}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.closer.addEventListener("click",function(){return t.hide()},!1),this.story.init(),this.story_toolbar.events.add_listener("search",function(e){return t.story.search(e)}).add_listener("refresh",function(e){return t.story.refresh()})}}]),i}(),SelectorPopup=(project.managers.read_only=function(e){var a="".concat(env.API_URL_BASE,"/api/").concat(env.USER.url_node,"/").concat(e);return{get:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:a+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){return null})},range:function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:a+"/range",type:"application/json",data:{_factor:void 0===t?10:t,_page:void 0===i?1:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:a+"/search",type:"application/json",data:{_str:t,_factor:void 0===i?10:i,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)}}},function(){_inherits(n,Popup);var t=_createSuper(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(e=t.call(this,"selector-popup",Object.assign(n.dflt_opts,e),!1)).cur_reso=null,e.cur_rej=null,e.build(),e}return _createClass(n,[{key:"selector_bld",value:function(){}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.loading_frame=new LoadingFrame,this.wrapper.appendChild(this.loading_frame.html()),this.toolbar=new DataListToolbar("selector-popup",{add:!1,delete:!1}),this.inner.appendChild(this.toolbar.html()),this.selector_bld(),this.navigator=new DataListNavigator(this.selector),ToolbarItem.likefy(this.navigator.container),this.toolbar.add_item("navigator",this.navigator);var e=validation_btns_bld(this.inner);this.validate_btn=e.validate,this.cancel_btn=e.cancel}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.toolbar.events.add_listener("search",function(e){return t.selector.search(e)}).add_listener("refresh",function(e){return t.selector.refresh()}),this.validate_btn.add_event_listener("click",function(){return t.validate()}),this.cancel_btn.add_event_listener("click",function(){return t.cancel()}),this.loading_state=this.validate_btn.loading_state,this.loading_state.events.add_listener("loaded",function(){return t.loading_frame.show()}).add_listener("unloaded",function(){return t.loading_frame.hide()})}},{key:"validate",value:function(){this.done()}},{key:"reset",value:function(){this.selector.reset()}},{key:"release",value:function(){this.validate_btn.release()}},{key:"cancel",value:function(){this.cur_rej({code:"SELECTOR_REJECTED"}),this.hide()}},{key:"done",value:function(){this.release(),this.hide()}},{key:"error",value:function(){new Notification(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Une erreur lors de la validation").notify(),this.release()}},{key:"show",value:function(e){var i=this;return new Promise(function(e,t){i.cur_reso=e,i.cur_rej=t,i.reset(),_get(_getPrototypeOf(n.prototype),"show",i).call(i)})}},{key:"promise",value:function(){var i=this;return new Promise(function(e,t){i.cur_reso=e,i.cur_rej=t})}}],[{key:"slct_modes",get:function(){return{single:"single",multiple:"multiple"}}},{key:"dflt_opts",get:function(){return{slct_mode:n.slct_modes.multiple,closer:!1}}}]),n}()),CommonSelector=function(){_inherits(s,Selector);var a=_createSuper(s);function s(e){var t=e._manager,i=e._factor,n=e._val_key,n=void 0===n?"_id":n,e=e._opts,e=void 0===e?{}:e;return _classCallCheck(this,s),a.call(this,{_manager:t,_factor:i,_val_key:n,_opts:e})}return _createClass(s,[{key:"item_class",get:function(){return function(){_inherits(n,SelectorItem);var i=_createSuper(n);function n(e,t){return _classCallCheck(this,n),i.call(this,e,t)}return _createClass(n,[{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.inner.innerHTML=this.data._name}}]),n}()}}]),s}(),RequestsDL=function(){_inherits(n,DataList);var i=_createSuper(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:DataList.mngmt_modes.full;return _classCallCheck(this,n),(e=i.call(this,project.managers.requests,e,t)).events.define("open"),e}return _createClass(n,[{key:"remove_item",value:function(e){return Promise.reject({code:"UNAVAILABLE"})}},{key:"update_item",value:function(e){return Promise.reject({code:"UNAVAILABLE"})}},{key:"item_class",get:function(){return RequestsDLI}},{key:"layout_bld",value:function(){this.layout=new DataListLayout(this.inner),this.layout.init()}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("requests")}},{key:"process_item",value:function(e){e=_get(_getPrototypeOf(n.prototype),"process_item",this).call(this,e);return e.events.pipe(this.events,["open"]),e}}]),n}(),TabPane=function(){_inherits(n,Molecule);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"tab-pane";return _classCallCheck(this,n),(e=i.call(this)).id=t,e.toolbar=null,e}return _createClass(n,[{key:"base_bld",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("tab-pane","".concat(this.id))}}]),n}(),_url_base10="".concat(env.USER.api_url_base,"/establishments"),_get11=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base10+"/get",method:"POST",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_range10=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base10+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search9=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base10+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},EstablishmentsDLI=(project.managers.establishments={get:_get11,range:_range10,search:_search9},function(){_inherits(a,DataListItem);var n=_createSuper(a);function a(e,t,i){return _classCallCheck(this,a),(e=n.call(this,e,t,i)).build(),e}return _createClass(a,[{key:"parse_exploitation",value:function(){return _parse_exploitation(this.data)}},{key:"base_bld",value:function(){var e=this,t=(_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("establishments-dli"),this.parse_exploitation());this.inner.innerHTML='\n            <div class="naming">\n                <div class="name">'.concat(this.data._name,'</div>\n                <div class="denomination">').concat(this.data._denomination,'</div>\n            </div>\n            <div class="tags">\n                <div class="tag establishment-type">').concat(this.data._establishment_type_name,"</div>\n                ").concat(this.data._wholesaler_type?'<div class="tag wholesaler-type"></div>':"",'\n                <div class="tag legal-form">').concat(this.data._legal_form_name,'</div>\n            </div>\n            <div class="exploitation-expiration ').concat(t.state,'">').concat(t.str,'</div>\n            <div class="contacts">\n                <div class="item">\n                    <div class="label">\n                        <span class="fi fi-rr-user prefix"></span>\n                        <span>Applicant principal</span>\n                    </div>\n                    <div class="value">').concat(this.data._main_applicant_last_name," ").concat(this.data._main_applicant_first_name,'</div>\n                </div>\n                <div class="item">\n                    <div class="label">\n                        <span class="fi fi-rr-phone-call prefix"></span>\n                        <span>Téléphone</span>\n                    </div>\n                    <div class="value">').concat(this.data._telephone,'</div>\n                </div>\n                <div class="item">\n                    <div class="label">\n                        <span class="fi fi-rr-map-marker prefix"></span>\n                        <span>Adresse</span>\n                    </div>\n                    <div class="value">').concat(this.data._address,'</div>\n                </div>\n            </div>\n            <div class="actions"></div>\n        '),this.open_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("open-establishment","filled","primary"),this.inner.innerHTML='\n                    <span>Ouvrir</span>\n                    <span class="fi fi-rr-angle-small-right suffix"></span>\n                '}}]),t}()),this.open_btn.add_event_listener("click",function(){app.instance.estab_viewer.show({data:e.data})}),this.inner.querySelector(".actions").appendChild(this.open_btn.html())}}]),a}()),RequestTypeDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_group",function(e){return"opening"===e._group?"Ouverture":"Exploitation"}),common_cells(this)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("requests-types")}}]),t}(),DataTable=function(){_inherits(a,DataList);var n=_createSuper(a);function a(e){var t=e._manager,i=e._factor,i=void 0===i?30:i,e=e._opts;return _classCallCheck(this,a),n.call(this,t,i,e)}return _createClass(a,[{key:"columns",get:function(){return[]}},{key:"constraints",get:function(){}},{key:"item_class",get:function(){return DataTableItem}},{key:"layout_bld",value:function(){this.layout=new TableLayout(this.inner,this.columns,this.constraints),this.layout.init()}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(a.prototype),"build",this).call(this),this.container.classList.add("data-table"),window.app.events.add_listener("horizontal_resize",function(e){t.layout.update()}),project.events.add_listener("main_menu_shown",function(e){t.layout.update()}).add_listener("main_menu_hidden",function(e){t.layout.update()})}}]),a}(),Editor=(!function(){var a=window.env.API_URL_BASE+"/api/admin/requests-types";project.managers.requests_types={range:function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:a+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},get:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:a+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},search:function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:a+"/search",type:"application/json",data:{_str:t,_factor:i,_page:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},register:function(e){var t=e._group,i=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:a+"/register",type:"application/json",data:{_group:t,_code:i,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},update:function(e){var t=e._id,i=e._group,n=e._code,e=e._name;return project.managers.ajax.authenticated_request({url:a+"/update",type:"application/json",data:{_id:t,_group:i,_code:n,_name:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},remove:function(e){e=e._id;return project.managers.ajax.authenticated_request({url:a+"/remove",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)}}}(),function(){_inherits(s,Popup);var n=_createSuper(s);function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return _classCallCheck(this,s),(e=n.call(this,"editor_"+e,t,!1)).events.define(["saved","cancelled"]),i&&e.build(),e}return _createClass(s,[{key:"title",get:function(){return"Editeur"}},{key:"manager",get:function(){return null}},{key:"confirm",value:function(){var t=this;return this.confirm_blk.classList.add("active"),this.confirmer.promise().then(function(e){return t.confirm_blk.classList.remove("active")||e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this),this.container.classList.add("editor"),this.badge.innerHTML='\n            <div class="mode-icon">\n                <span class="fi fi-rr-plus add"></span>\n                <span class="fi fi-rr-pencil edit"></span>\n            </div>\n            <span class="title">'.concat(this.title,"</spantitle>\n        ");var e=document.createElement("div");e.className="form",this.inner.appendChild(e),this.form=document.createElement("form"),this.form_mgr=new FormManager(this.form),e.appendChild(this.form),this.buttons=document.createElement("div"),this.buttons.className="buttons",this.inner.appendChild(this.buttons),this.save_btn=new(function(){_inherits(t,PushButton);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"Enregistrer")}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("save","filled","primary")}}]),t}()),this.buttons.appendChild(this.save_btn.html()),this.cancel_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("filled","primary-light"),this.inner.classList.add("cancel"),this.inner.innerHTML="Annuler"}}]),t}()),this.buttons.appendChild(this.cancel_btn.html()),this.confirmer=new Confirm("Veuillez confirmer l'enregistrement"),this.confirm_blk=document.createElement("div"),this.confirm_blk.className="confirm-block",this.inner.appendChild(this.confirm_blk),this.confirm_blk.appendChild(this.confirmer.html()),this.mount()}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(s.prototype),"build",this).call(this),this.loading_state=this.save_btn.loading_state,this.save_btn.events.add_listener("pushed",function(e){t.save()}),this.cancel_btn.add_event_listener("click",function(e){t.cancel()})}},{key:"mount",value:function(){}},{key:"cancel",value:function(){this.hide(),this.loading_state.busy||(this.confirm_blk.classList.remove("active"),this.cur_rej({code:"EDITOR_REJECTED_ERROR"}))}},{key:"reset",value:function(){this.loading_state.busy||(this.form.scrollTo({top:0,behavior:"smooth"}),this.form_mgr.reset())}},{key:"fill",value:function(e){this.loading_state.busy||(this.cur_data=e,this.form_mgr.fill(this.cur_data))}},{key:"release",value:function(){this.loading_state.unload(),this.form_mgr.enable()}},{key:"error",value:function(e){new Notification("Une erreur est survenue lors de l'enregistrement").notify(),this.release()}},{key:"done",value:function(){new Notification("Enregistrement réussi!").notify(),this.release(),this.hide()}},{key:"save",value:function(){var n=this;this.form_mgr.is_valid()?(this.form_mgr.disable(),this.confirm().then(function(e){if(!e)return n.loading_state.unload();var t,i=n.form_mgr.values();if(!n.manager)return n.cur_reso({editor:n,data:i});if(n.cur_mode===s.modes.ADD)t=n.manager.register(i).then(function(e){return{response:e,data:i}});else{if(n.cur_mode!==s.modes.EDIT)throw{code:"UNKNOWN_MODE"};i._id=n.cur_data._id,t=n.manager.update(i).then(function(e){return{response:e,data:Object.assign(n.cur_data,i)}})}return t.then(function(e){n.cur_reso(e),n.events.trigger("saved",_objectSpread({mode:n.cur_mode},e)),n.done()}).catch(function(e){return n.error()})}).finally(function(){return n.form_mgr.enable()})):this.loading_state.unload()}},{key:"show",value:function(){var i=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s.modes.ADD,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!this.is_shown)return this.is_shown=!0,this.cur_mode=n,new Promise(function(e,t){i.cur_reso=e,i.cur_rej=t,i.container.setAttribute("data-mode",n),n===s.modes.EDIT?i.fill(a):i.reset(),_get(_getPrototypeOf(s.prototype),"show",i).call(i)})}},{key:"hide",value:function(){if(this.loading_state.busy)return new Notification("Veuillez patientez, Une opération est en cours").notify();_get(_getPrototypeOf(s.prototype),"hide",this).call(this)}},{key:"remove",value:function(){if(this.loading_state.busy)return new Notification("Veuillez patientez, Une opération est en cours").notify();_get(_getPrototypeOf(s.prototype),"remove",this).call(this)}},{key:"promise",value:function(){var i=this;return new Promise(function(e,t){i.cur_reso=e,i.cur_rej=t})}}],[{key:"modes",get:function(){return{ADD:"ADD",EDIT:"EDIT"}}}]),s}()),TextRule=function(){_inherits(n,LengthRule);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{min:3,max:5e3};return _classCallCheck(this,n),(e=i.call(this,t)).constraints=t,e._message="Votre texte doit avoir une longueur comprise entre "+e.constraints.min+" et "+e.constraints.max+" caractères",e}return n}(),CommonDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_code"),this.cell("_name")}},{key:"build",value:function(){_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.container.classList.add("common")}}]),t}(),TownDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_prefecture_name"),common_cells(this)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("towns")}}]),t}(),RequestStepDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_request_type_name"),this.cell("_establishment_type_name"),this.cell("_order"),common_cells(this),this.cell("_description"),this.cell("_delay"),this.cell("_delay_unit",function(e){switch(e._delay_unit){case"hour":return"Heure";case"day":return"Jour";case"month":return"Mois";case"year":return"Année";case"week":return"Semaine"}}),this.cell("_required_documents")}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("requests-steps")}}]),t}(),SelectRule=function(){_inherits(n,FormRule);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new Set;return _classCallCheck(this,n),(e=i.call(this)).unavailable_indexes=t,e.unavailable_indexes.add(-1),e.message="Veuillez sélectionner une option valide",e}return _createClass(n,[{key:"validate",value:function(e,t){return!this.unavailable_indexes.has(t.selected_index)}}]),n}(),TownShipDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_town_name"),common_cells(this)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("towns-ships")}}]),t}(),PrefectureDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_administration_region_name"),common_cells(this)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("prefectures")}}]),t}(),RequiredDocumentDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_request_type_name"),this.cell("_establishment_type_name"),this.cell("_request_step_name"),this.cell("_name"),this.cell("_description")}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("required-documents")}}]),t}(),HealthDistrictDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_health_region_name"),common_cells(this)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("health-districts")}}]),t}(),AdministratorDTI=function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_last_name"),this.cell("_first_name"),this.cell("_identifier"),this.cell("_telephone"),this.cell("_email")}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("administrator")}}]),t}(),_url_base11="".concat(env.API_URL_BASE,"/api/public/countries"),_range11=function(e){var t=e._factor,e=e._page;return project.managers.ajax.request({url:_url_base11+"/range",type:"application/json",data:{_factor:void 0===t?10:t,_page:void 0===e?1:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search10=function(e){var t=e._str,i=e._factor,e=e._page;return project.managers.ajax.request({url:_url_base11+"/search",type:"application/json",data:{_str:t,_factor:void 0===i?10:i,_page:void 0===e?1:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_get12=function(e){e=e._id;return project.managers.ajax.request({url:_url_base11+"/get",type:"application/json",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},DynamicSelect=(project.managers.countries={get:_get12,range:_range11,search:_search10},function(){_inherits(s,FormField);var i=_createSuper(s);function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,s),(e=i.call(this,e,Object.assign(s.dflt_opts,t))).cur_item=null,e.owned_groups=new Set,e.build(),e}return _createClass(s,[{key:"placeholder",get:function(){return this.label_input.placeholder},set:function(e){this.label_input.placeholder=e}},{key:"value",get:function(){return this.cur_item?this.cur_item.data[this.opts.value_key]:null},set:function(e){var t=this;if(this.cur_item&&this.selector.unselect_item(this.cur_item),null===e)return this.null();this.selector&&(this.loading_frame.show(),this.selector.select(e).catch(function(e){return t.null()}).finally(function(){return t.loading_frame.hide()}))}},{key:"process_value",value:function(e){if(!this.selector)return this.null();var t,i=this.value;null===e?(this.null(),null!==i&&this.is_enabled&&this.events.trigger("change",null)):this.cur_item&&e.data[this.opts.primary_key]===this.cur_item.data[this.opts.primary_key]||(t=e.data[this.opts.value_key],this.last_err=this.validate(t),this.last_err?(this.null(),this.error(this.last_err),this.is_enabled&&this.events.trigger("change",this.value)):(this.cur_item=e,this.label_input.value=this.label(),_set(_getPrototypeOf(s.prototype),"_value",t,this,!0),this.hidden.value=t,this.is_enabled&&this.show_cleaner(),i!==t&&this.is_enabled&&this.events.trigger("change",this.value)))}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(s.prototype),"enable",this).call(this),this.container.classList.remove("disabled"),this.label_input.disabled=!1,""!==this.label_input.value&&this.show_cleaner())}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(s.prototype),"disable",this).call(this),this.container.classList.add("disabled"),this.label_input.disabled=!0,this.hide_cleaner(),this.selector_blk.collapse())}},{key:"focus",value:function(){_get(_getPrototypeOf(s.prototype),"focus",this).call(this),this.label_input.focus(),this.events.trigger("focus")}},{key:"blur",value:function(){_get(_getPrototypeOf(s.prototype),"blur",this).call(this),this.label_input.blur(),this.events.trigger("blur")}},{key:"reset",value:function(){this.value=null,this.error_messenger.leave(),this.is_enabled&&this.selector&&this.selector.leave_search(),this.selector_blk.collapse()}},{key:"erase",value:function(){this.is_enabled&&(this.value=null,this.selector)&&this.selector.leave_search()}},{key:"fill",value:function(e){var t=this;return!e||!this.selector||this.selector&&!e.hasOwnProperty(this.name)?Promise.resolve():(this.loading_frame.show(),void this.selector.select(e[this.name]).catch(function(e){return t.value=null}).finally(function(){return t.loading_frame.hide()}))}},{key:"show_cleaner",value:function(){this.cleaner.classList.add("active")}},{key:"hide_cleaner",value:function(){this.cleaner.classList.remove("active")}},{key:"type_parser",value:function(e){return e}},{key:"label",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.cur_item.data)[this.opts.label_key]}},{key:"add_group",value:function(e){this.owned_groups.add(e)}},{key:"remove_group",value:function(e){this.owned_groups.delete(e)}},{key:"null",value:function(){this.cur_item=null,this._value=null,this.hidden.value="",this.label_input.value="",this.hide_cleaner()}},{key:"attach_selector",value:function(e){var t=this;this.selector=e,this.list_nav=new DataListNavigator(this.selector),this.navigator_blk.appendChild(this.list_nav.html()),this.selector_blk.inner.appendChild(this.selector.html()),this.selector.events.add_listener("selected",function(){t.selector_blk.collapse()}).add_listener("selection_change",function(e){t.process_value(e)}),this.selector.events.add_listener("loaded",function(e){t.selector_blk.collapsed||t.selector_blk.expand()}),this.selector.init()}},{key:"loading_frame_bld",value:function(){this.loading_frame=new(function(){_inherits(i,HTML);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).build(),e}return _createClass(i,[{key:"base_bld",value:function(){this.container=document.createElement("div"),this.container.className="loading-frame",this.container.innerHTML='\n                    <div class="ball"></div>\n                    <div class="ball"></div>\n                    <div class="ball"></div>\n                '}},{key:"html",value:function(){return this.container}},{key:"show",value:function(){this.container.classList.add("active")}},{key:"hide",value:function(){this.container.classList.remove("active")}}]),i}()),this.container.appendChild(this.loading_frame.html())}},{key:"selector_blk_bld",value:function(){var e,t=this;this.selector_blk=new Collapsible(((e=document.createElement("div")).className="selector-block",e.innerHTML='<div class="inner"><div class="navigator-block"></div></div>',e)),this.selector_blk.events.add_listener("expanded",function(){return t.container.classList.add("expanded")}),this.selector_blk.events.add_listener("collapsed",function(){return t.container.classList.remove("expanded")}),this.inner.appendChild(this.selector_blk.html()),this.navigator_blk=this.selector_blk.inner.querySelector(".navigator-block")}},{key:"base_bld",value:function(){_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this),this.container.classList.add("field","dynamic-select",this.name),this.inner.innerHTML='\n            <input type="hidden" class="hidden-input" name="'.concat(this.name,'" value=""/>\n            <div class="base">\n                <div class="edition-block">\n                    <input type="text" class="label" placeholder="').concat(this.opts.placeholder,'"/>\n                    <a class="').concat(env.APP_CSS_CLASS,' button icon filled light cleaner">\n                        <div class="inner">\n                            <span class="fi fi-rr-delete"></span>\n                        </div>\n                    </a>\n                </div>\n                <a class="').concat(env.APP_CSS_CLASS,' button icon filled light list-rocker expand">\n                    <div class="inner">\n                        <div class="collapse-icon">\n                            <span class="fi fi-rr-angle-up"></span>\n                        </div>\n                        <div class="expand-icon">\n                            <span class="fi fi-rr-angle-down"></span>\n                        </div>\n                    </div>\n                </a>\n            </div>\n        '),this.hidden=this.inner.querySelector(".hidden-input"),this.label_input=this.inner.querySelector("input.label"),this.cleaner=this.inner.querySelector(".cleaner"),this.list_rocker=this.inner.querySelector(".list-rocker"),this.loading_frame_bld(),this.selector_blk_bld(),this.error_messenger_bld()}},{key:"build",value:function(){var i=this;_get(_getPrototypeOf(s.prototype),"build",this).call(this),this.cleaner.addEventListener("click",function(e){return i.is_enabled&&(i.erase()||i.focus())},!1),this.label_input.addEventListener("focus",function(e){i._has_focus=!0,""!==i.label_input.value&&i.cleaner.classList.add("active"),i.events.trigger("focus")},!1),this.label_input.addEventListener("blur",function(e){i._has_focus=!1,setTimeout(function(){i.has_focus||(i.events.trigger("blur"),i.is_valid)},200)},!1),this.label_input.addEventListener("keyup",function(e){var t;i.selector&&(t=i.label_input.value.trim(),i.cur_item&&i.selector.unselect_item(i.cur_item),""!==t?i.cleaner.classList.add("active"):(i.label_input.value="",i.cleaner.classList.remove("active")),i.selector_blk.expand(),i.selector.search(t))},!1),this.list_rocker.addEventListener("click",function(e){i.is_enabled&&(i.label_input.focus(),i.list_rocker.classList.contains("expand")?i.selector_blk.expand():i.selector_blk.collapse())},!1),this.selector_blk.events.add_listener("collapsed",function(){i.list_rocker.classList.add("expand")}).add_listener("expanded",function(){i.list_rocker.classList.remove("expand")}),this.events.add_listener("focus",function(){i.owned_groups.forEach(function(e){s.groups.focused(e,i)})})}}],[{key:"groups",get:function(){return project.dynamic_select_groups||(project.dynamic_select_groups=new(function(){function e(){_classCallCheck(this,e),this.groups=new Map}return _createClass(e,[{key:"register",value:function(e,t){this.groups.has(e)||this.groups.set(e,new Map),t.add_group(e),this.groups.get(e).set(t.name,t)}},{key:"unregister",value:function(e,t){this.groups.has(e)&&this.groups.get(e).has(t.name)&&(t.remove_group(e),this.groups.get(e).delete(t.name))}},{key:"focused",value:function(e,t){this.groups.get(e).forEach(function(e){e!==t&&e.selector_blk.collapse()})}}]),e}())),project.dynamic_select_groups}},{key:"from_DOM",value:function(i,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new(function(){_inherits(t,s);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,n,a)}return _createClass(t,[{key:"base_bld",value:function(){this.container=i,this.container.classList.add(env.APP_CSS_CLASS,"atom","field","dynamic-select",this.name),this.inner=this.container.children[0],this.hidden=this.inner.querySelector("input.hidden-input"),this.label_input=this.inner.querySelector("input.label"),this.cleaner=this.inner.querySelector(".cleaner"),this.list_rocker=this.inner.querySelector(".list-rocker"),this.loading_frame_bld(),this.selector_blk_bld(),this.error_messenger_bld()}}]),t}())}},{key:"dflt_opts",get:function(){return _objectSpread(_objectSpread({},_get(_getPrototypeOf(s),"dflt_opts",this)),{},{primary_key:"_id",label_key:"_name",value_key:"_id",placeholder:""})}}]),s}()),TelephoneRule=function(){_inherits(i,FormRule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this))._message="Veuillez entrer un numéro de téléphone correct. ex: +22877663301",e}return _createClass(i,[{key:"validate",value:function(e){return RegexCollection.patterns.telephone.test(e)}}]),i}(),EmailRule=function(){_inherits(i,FormRule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this))._message="Entrez un email correct. ex: example@domaine.com",e}return _createClass(i,[{key:"validate",value:function(e){return RegexCollection.patterns.email.test(e)}}]),i}(),NameRule=function(){_inherits(i,FormRule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this))._message="Seuls les caratères alphabetiques, les espaces, apostrophes et tirets sont autorisés",e}return _createClass(i,[{key:"validate",value:function(e){return RegexCollection.patterns.name.test(e)}}]),i}(),_url_base12="".concat(env.USER.api_url_base,"/applicants"),_get13=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base12+"/get",method:"POST",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_range12=function(e){var t=e._factor,i=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base12+"/range",type:"application/json",data:{_factor:t,_page:i,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_search11=function(e){var t=e._str,i=e._factor,n=e._page,e=e.filter;return project.managers.ajax.authenticated_request({url:_url_base12+"/search",type:"application/json",data:{_str:t,_factor:void 0===i?10:i,_page:void 0===n?1:n,filter:void 0===e?[]:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_register8=function(e){var t=e._last_name,i=e._first_name,n=e._gender,a=e._birthday,s=e._diploma,r=e._function,l=e._onpt_number,o=e._email,c=e._telephone,e=e._nationality;return project.managers.ajax.authenticated_request({url:_url_base12+"/register",method:"POST",data:{_last_name:t,_first_name:i,_gender:n,_birthday:a,_diploma:s,_function:r,_onpt_number:l,_email:o,_telephone:c,_nationality:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_update7=function(e){var t=e._id,i=e._last_name,n=e._first_name,a=e._gender,s=e._birthday,r=e._diploma,l=e._function,o=e._onpt_number,c=e._email,u=e._telephone,e=e._nationality;return project.managers.ajax.authenticated_request({url:_url_base12+"/update",method:"POST",data:{_id:t,_last_name:i,_first_name:n,_gender:a,_birthday:s,_diploma:r,_function:l,_onpt_number:o,_email:c,_telephone:u,_nationality:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_remove8=function(e){e=e._id;return project.managers.ajax.authenticated_request({url:_url_base12+"/delete",method:"POST",data:{_id:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},ApplicantDTI=(project.managers.applicants={get:_get13,range:_range12,search:_search11,register:_register8,update:_update7,remove:_remove8},function(){_inherits(t,DataTableItem);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"cells",value:function(){this.cell("_last_name"),this.cell("_first_name"),this.cell("_birthday",function(e){return moment(e._birthday).format("DD / MM / YYYY")}),this.cell("_gender",function(e){return"male"===e._gender?"Masculin":"Féminin"}),this.cell("_onpt_number"),this.cell("_telephone"),this.cell("_email"),this.cell("_diploma",function(e){return e._diploma_name}),this.cell("_function",function(e){return e._function_name}),this.cell("_nationality",function(e){return e._nationality_country})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("applicants"),this.data._is_main&&this.container.classList.add("is_main")}},{key:"build",value:function(){_get(_getPrototypeOf(t.prototype),"build",this).call(this)}}]),t}()),CardsLayout=function(){_inherits(n,Layout);var i=_createSuper(n);function n(e){var t;if(_classCallCheck(this,n),(t=i.call(this)).events.define(["shown","hidden"]),t.cards=new Map,t.shown=null,e instanceof HTMLElement)return t.container=e,t;throw"Bad container type given for cards layout building"}return _createClass(n,[{key:"init",value:function(){this.container.classList.add("cards-layout")}},{key:"add_item",value:function(e){this.cards.has(e.id)||(this.cards.set(e.id,e),this.container.appendChild(e.html()))}},{key:"remove_item",value:function(e){var t=this.cards.get(e);t&&(t.remove(),this.cards.delete(e))}},{key:"get",value:function(e){return this.cards.get(e)}},{key:"clear",value:function(){this.cards.clear(),this.container.innerHTML=""}},{key:"show",value:function(e){e=this.cards.get(e);if(e)return null!==this.shown&&(this.shown.hide(),this.events.trigger("hidden",this.shown)),this.shown=e,this.shown.show(),this.events.trigger("shown",this.shown),this.shown}}]),n}(),ToolbarVwprt=function(){_inherits(i,Molecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).current_toolbar=null,e.toolbars={},e.build(),e}return _createClass(i,[{key:"build",value:function(){_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.classList.add("toolbar-viewport")}},{key:"registerToolbar",value:function(e,t){t&&e&&(this.toolbars[e]=t,this.inner.appendChild(t.html()))}},{key:"show",value:function(e){this.current_toolbar&&this.current_toolbar.hide(),e&&this.toolbars.hasOwnProperty(e)&&this.toolbars[e].show()}},{key:"hide",value:function(e){this.toolbars.hasOwnProperty(e)&&this.toolbars[e].hide()}}]),i}(),VwprtStaticToolbar=function(){_inherits(t,Toolbar);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"viewport-static")}return _createClass(t,[{key:"build",value:function(){_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.events.define(["notifications_show","notifications_hide"])}}]),t}(),App=function(){function e(){_classCallCheck(this,e),this.events=new Events,project.instance=this}return _createClass(e,[{key:"init",value:function(){var t=this;this.updateBodyHeight(),window.addEventListener("resize",function(e){t.updateBodyHeight(),t.updateVhProperty()},!1)}},{key:"run",value:function(){var t=this;window.addEventListener("DOMContentLoaded",function(e){t.init()},!1)}},{key:"updateBodyHeight",value:function(){document.body.style.height="".concat(window.innerHeight,"px"),document.documentElement.style.setProperty("--body-height","".concat(window.innerHeight,"px"))}},{key:"updateVhProperty",value:function(){document.documentElement.style.setProperty("--vh","".concat(window.innerHeight/100,"px"))}}]),e}(),_spr_base_bld=RequestViewer.prototype.base_bld,_spr_build3=RequestViewer.prototype.build,RequestsTP=(RequestViewer.prototype.base_bld=function(){var i=this;_spr_base_bld.apply(this),this.menu_btn=new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("icon","menu-rocker"),this.inner.innerHTML='\n                    <span class="fi fi-rr-menu-dots-vertical"></span>\n                '}}]),t}()),this.inner.querySelector(".block.top > .right").appendChild(this.menu_btn.html()),this.menu=new ScalableMenu([{class:"validate-btn",event:"validate_request",label:"Valider la demande"},{class:"invalidate-btn",event:"invalidate_request",label:"Invalider la demande"},{class:"inspection-reports",event:"inspection-reports",label:"Rapports d'inspections"},{class:"activities",event:"activities",label:"Voir les activités"}]),this.menu.events.add_listener("validate_request",function(){var t=new RequestValidationPopup;t.events.add_listener("confirmed",function(e){e=e.values;project.managers.requests.accept(_objectSpread({_request:i.item.data._id},e)).then(function(e){t.remove(),new Notification("Requête acceptée!").notify(),i.events.trigger("request_state_changed",e)}).catch(function(e){t.release(),e="UNCOMPLETED_REQUEST_ERROR"===e.code?"Veuillez valider toutes les étapes pour pouvoir accepter la demande":"REQUEST_ACCEPTING_REQUIRES_EXPIRATION_DATE_ERROR"===e.code?"Veuillez définir une date d'expiration ou cocher la case de licence à vie":"Une erreur est survénue lors de l'opération",new Notification(e).notify()})}).add_listener("cancelled",function(){return t.remove()}),t.show()}).add_listener("invalidate_request",function(){var t=new ValidationFormPopup({title:"Rejet de demande"});t.events.add_listener("confirmed",function(e){e=e.values;project.managers.requests.reject(_objectSpread({_request:i.item.data._id},e)).then(function(e){t.remove(),new Notification("Requête rejetée!").notify(),i.events.trigger("request_state_changed",e)}).catch(function(e){t.release(),new Notification("Une erreur est survénue lors de l'opération").notify()})}).add_listener("cancelled",function(){return t.remove()}),t.show()}),this.container.querySelector(".header > .block.top > .right").appendChild(this.menu.html()),this.menu_btn.add_event_listener("click",function(){i.menu.show()})},RequestViewer.prototype.build=function(){var t=this;this.events.define("request_state_changed"),_spr_build3.apply(this),this.events.add_listener("request_state_changed",function(e){Object.assign(t.item.data,e),t.state.set_state(t.item.data._state),t.item.state.set_state(t.item.data._state),t.item.set_lock_state(t.item.data._locked),t.story.refresh()}),this.story.events.add_listener("cur_step_changed",function(e){t.item.data._cur_step=e.step,t.item.data._cur_step_name=e.name,t.item.data._cur_step_order=e.order,t.item.data._cur_step_state=e.state,t.update_cur_step(),t.item.update_cur_step(),t.story.refresh()})},function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"requests")).build(),e}return _createClass(i,[{key:"add",value:function(){return this.selector.show()}},{key:"open_request",value:function(e){this.request_viewer.show(e)}},{key:"request_viewer_bld",value:function(){var t=this;this.request_viewer=new RequestViewer,this.container.appendChild(this.request_viewer.html()),this.data_list.events.add_listener("open",function(e){return t.open_request(e)})}},{key:"selector_bld",value:function(){var n=this.data_list;this.selector=new(function(){_inherits(t,SelectorPopup);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"selector_bld",value:function(){this.selector=new CommonSelector({_manager:project.managers.read_only("requests-types"),_opts:{slct_mode:DataList.slct_modes.single}}),this.inner.appendChild(this.selector.html())}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this)}},{key:"build",value:function(){_get(_getPrototypeOf(t.prototype),"build",this).call(this),this.selector.init()}},{key:"validate",value:function(){var i=this;if(this.selector.selected)return n.add_item({_request_type:this.selector.selected.data._id}).then(function(e){return i.done()}).catch(function(e){var t;"ESTABLISHMENT_INFO_NOT_REGISTERED_ERROR"===e.code&&(t="Veuillez enregistrer les informations d'établissement avant de lancer une demande"),"REQUEST_STEP_NOT_FOUND_ERROR"===e.code&&(t="Désolé ce type de requête ne dispose pas encore d'étape"),console.log(e),i.error(t)});this.release(),this.error("Veuillez sélectionner un type de demande")}}]),t}())}},{key:"toolbar_bld",value:function(){this.toolbar=new DataListToolbar("requests",{search:!1,delete:!1,edit:!1}),this.toolbar.add_item("navigator",new(function(){_inherits(n,ToolbarItem);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this,"navigator",!1)).navigator=e,t.build(),t}return _createClass(n,[{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.inner.appendChild(this.navigator.html())}}]),n}())(this.navigator))}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.data_list=new RequestsDL,this.navigator=new DataListNavigator(this.data_list),this.inner.appendChild(this.data_list.html()),this.container.appendChild(this.data_list.loading_frame.html()),this.toolbar_bld(),this.selector_bld(),this.request_viewer_bld()}},{key:"build",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.toolbar.events.add_listener("refresh",function(){return e.data_list.refresh()}).add_listener("add",function(){return e.add()})}},{key:"show",value:function(){_get(_getPrototypeOf(i.prototype),"show",this).call(this),this.data_list.initialized||this.data_list.init()}}]),i}()),_url_base13="".concat(env.USER.api_url_base,"/requests/required-documents"),mgr=project.managers.requests.required_documents,_url_base14=(mgr.validate=function(e){var t=e._request,i=e._request_step,n=e._required_document,e=e._observation;return project.managers.ajax.authenticated_request({url:_url_base13+"/validate",method:"POST",data:{_request:t,_request_step:i,_required_document:n,_observation:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},mgr.invalidate=function(e){var t=e._request,i=e._request_step,n=e._required_document,a=e._observation,s=e._use_obsvt_as_cmt,e=e._comment;return project.managers.ajax.authenticated_request({url:_url_base13+"/invalidate",method:"POST",data:{_request:t,_request_step:i,_required_document:n,_observation:a,_use_obsvt_as_cmt:s,_comment:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},project.managers.requests.url_base),_mgr=project.managers.requests,EstablishmentsDL=(_mgr.accept=function(e){var t=e._request,i=e._treatment_date,n=e._lic_acquisition_date,a=e._lic_expiration_date,s=e._lic_life_time,r=e._lic_number,e=e._observation;return project.managers.ajax.authenticated_request({url:_url_base14+"/accept",method:"POST",data:{_request:t,_treatment_date:i,_lic_acquisition_date:n,_lic_expiration_date:a,_lic_life_time:s,_lic_number:r,_observation:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},_mgr.reject=function(e){var t=e._request,i=e._treatment_date,n=e._observation,a=e._use_obsvt_as_cmt,e=e._comment;return project.managers.ajax.authenticated_request({url:_url_base14+"/reject",method:"POST",data:{_request:t,_treatment_date:i,_observation:n,_use_obsvt_as_cmt:a,_comment:e}},1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0)},function(){_inherits(t,DataList);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,project.managers.establishments,20)}return _createClass(t,[{key:"item_class",get:function(){return EstablishmentsDLI}},{key:"layout_bld",value:function(){this.layout=new DataListLayout(this.inner),this.layout.init()}},{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("establishments-dl")}}]),t}()),RequestsTypesDT=function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.requests_types})}return _createClass(n,[{key:"item_class",get:function(){return RequestTypeDTI}},{key:"columns",get:function(){return["Groupe de demande","Code","Nom"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("requests-types")}}]),n}(),DataTableTP=function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"data-table-tp";return _classCallCheck(this,i),(e=t.call(this,e)).data_list=null,e}return _createClass(i,[{key:"add",value:function(){var i=this;return this.editor?this.editor.show(Editor.modes.ADD).then(function(e){var t=e.editor,e=e.data;return i.data_list.add_item(e).then(function(){return t.done()}).catch(function(e){return t.error(e)})}):Promise.resolve()}},{key:"edit",value:function(i){var n=this;return this.editor?this.editor.show(Editor.modes.EDIT,i.data).then(function(e){var t=e.editor,e=e.data;return n.data_list.update_item(i,e).then(function(){return t.done()}).catch(function(e){return t.error(e)})}):Promise.resolve()}},{key:"remove",value:function(){if(0===this.data_list.selected.length)return new Notification("Veuillez sélectionner au moins un élément à supprimer").notify();this.data_list.remove_selected().catch(function(e){new Notification("Une erreur lors de la suppression").notify()})}},{key:"datalist_bld",value:function(){this.data_list&&this.inner.appendChild(this.data_list.html())}},{key:"toolbar_bld",value:function(){this.toolbar=new(function(){_inherits(i,DataListToolbar);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e)}return i}())(this.id),this.navigator=new DataListNavigator(this.data_list),this.toolbar.add_item("navigator",this.navigator)}},{key:"editor_bld",value:function(){}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("data-table-pane"),this.container.appendChild(this.data_list.loading_frame.html()),this.datalist_bld(),this.editor_bld(),this.toolbar_bld()}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.data_list&&this.data_list.events.add_listener("edit",function(e){t.edit(e)}),this.toolbar.events.add_listener("search",function(e){t.data_list.search(e)}),this.toolbar.events.add_listener("refresh",function(e){t.data_list.refresh()}),this.toolbar.events.add_listener("add",function(e){t.add()}),this.toolbar.events.add_listener("delete",function(){t.remove()})}},{key:"show",value:function(){_get(_getPrototypeOf(i.prototype),"show",this).call(this),this.data_list.initialized||this.data_list.init()}}]),i}();function common_editor_fld(e,t){var i=new ShortText("_code"),i=(i.placeholder="Code",e.appendChild(i.html()),i.add_rule(new TextRule({min:1,max:20})),t.add_field("_code",i),new ShortText("_name"));i.placeholder="Nom",e.appendChild(i.html()),i.add_rule(new TextRule({min:1,max:160})),t.add_field("_name",i)}var CommonDT=function(){_inherits(a,DataTable);var n=_createSuper(a);function a(e){var t=e._manager,i=e._factor,i=void 0===i?25:i,e=e._opts,e=void 0===e?{}:e;return _classCallCheck(this,a),n.call(this,{_manager:t,_factor:i,_opts:e})}return _createClass(a,[{key:"item_class",get:function(){return CommonDTI}},{key:"columns",get:function(){return["Code","Nom"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(a.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(a.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(a.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(a.prototype),"base_bld",this).call(this),this.container.classList.add("common")}}]),a}(),TownsDT=function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.towns})}return _createClass(n,[{key:"item_class",get:function(){return TownDTI}},{key:"columns",get:function(){return["Préfecture","Code","Nom"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("towns")}}]),n}(),RequestsStepsDT=function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.requests_steps})}return _createClass(n,[{key:"item_class",get:function(){return RequestStepDTI}},{key:"columns",get:function(){return["Type de requête","Type d'établissment","Position d'ordre","Code","Nom","Description","Délai","Unité du délai","Nombre de documents requis"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"remove_selected",value:function(){}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("requests-steps")}}]),n}(),Select=(project.managers.establishments_types=common_mgr("establishments_types"),function(){_inherits(r,FormField);var n=_createSuper(r);function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck(this,r),(e=n.call(this,e,Object.assign(r.dflt_opts,i))).selected_index=e.opts.dflt_index,e.options=t,e.build(),e}return _createClass(r,[{key:"placeholder",get:function(){return this.select.placeholder},set:function(e){this.select.placeholder=e}},{key:"value",get:function(){return _get(_getPrototypeOf(r.prototype),"value",this)},set:function(e){this.process_value(e),this.select.selectedIndex=this.selected_index,this.last_err&&this.error(this.last_err)}},{key:"process_value",value:function(t){var e=this.options.findIndex(function(e){return e.value===t});return this.selected_index=e,this._value=0<=e?this.options[e].value:null,this.last_err=this.validate(t),this.last_err}},{key:"enable",value:function(){this.is_locked||(_get(_getPrototypeOf(r.prototype),"enable",this).call(this),this.select.disabled=!1)}},{key:"disable",value:function(){this.is_locked||(_get(_getPrototypeOf(r.prototype),"disable",this).call(this),this.select.disabled=!0)}},{key:"focus",value:function(){_get(_getPrototypeOf(r.prototype),"focus",this).call(this),this.select.focus()}},{key:"blur",value:function(){_get(_getPrototypeOf(r.prototype),"blur",this).call(this),this.select.blur()}},{key:"reset",value:function(){this.value=(this.options.find(function(e){return e.selected})||(this.opts.dflt_index<0?{value:null}:this.options[this.opts.dflt_index])).value}},{key:"base_bld",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"base_bld",this).call(this,e,t),this.container.classList.add("select",this.name),this.select=document.createElement("select"),this.select.name=this.name,this.select.selectedIndex=this.selected_index,this.select.innerHTML=this.options.reduce(function(e,t,i){return e+'\n            <option value="'.concat(t.value,'" ').concat(t.selected||i===n.opts.dflt_index?" selected":"",">").concat(t.label||t.value,"</option>\n        ")},""),this.inner.appendChild(this.select),this.error_messenger_bld()}},{key:"build",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(r.prototype),"build",this).call(this,e,t),this.select.addEventListener("change",function(e){var t=i.value;i.process_value(i.select.value)&&i.error(i.last_err),i.value!==t&&i.events.trigger("change",i.value)},!1),this.select.addEventListener("blur",function(e){i.is_valid},!1),this.value=(this.options.find(function(e){return e.selected})||(this.opts.dflt_index<0?{value:null}:this.options[this.opts.dflt_index])).value}}],[{key:"from_DOM",value:function(i,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Set,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return new(function(){_inherits(t,r);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,n,a,s)}return _createClass(t,[{key:"base_bld",value:function(){this.container=HTML.parse_element(i),this.inner=this.container.children[0],this.select=this.container.querySelector("select"),this.error_messenger_bld(this.container.querySelector(".error-messenger"))}}]),t}())}},{key:"dflt_opts",get:function(){return{dflt_index:0}}}]),r}()),TownsShipsDT=function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.towns_ships})}return _createClass(n,[{key:"item_class",get:function(){return TownShipDTI}},{key:"columns",get:function(){return["Commune","Code","Nom"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("towns-ships")}}]),n}(),PrefecturesDT=function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.prefectures})}return _createClass(n,[{key:"item_class",get:function(){return PrefectureDTI}},{key:"columns",get:function(){return["Région administrative","Code","Nom"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("prefectures")}}]),n}(),RequiredDocumentsDT=(project.managers.administration_regions=common_mgr("administration_regions"),function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.required_documents})}return _createClass(n,[{key:"item_class",get:function(){return RequiredDocumentDTI}},{key:"columns",get:function(){return["Type de demande","Type d'établissement","Étape","Nom","Description"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("required-documents")}}]),n}()),NotNull=function(){_inherits(n,FormRule);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this))._message=e,t}return _createClass(n,[{key:"validate",value:function(e){return null!==e}}]),n}(),HealthDistrictsDT=function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.health_districts})}return _createClass(n,[{key:"item_class",get:function(){return HealthDistrictDTI}},{key:"columns",get:function(){return["Région sanitaire","Code","Nom"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("health-districts")}}]),n}(),AdministratorsDT=(project.managers.health_regions=common_mgr("health_regions"),function(){_inherits(n,DataTable);var e=_createSuper(n);function n(){return _classCallCheck(this,n),e.call(this,{_manager:project.managers.administrators})}return _createClass(n,[{key:"item_class",get:function(){return AdministratorDTI}},{key:"columns",get:function(){return["Nom","Prénom","Identifiant","Téléphone","Email"]}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw/^FK_/.test(e.code)&&(t="Impossible de supprimer, ces données sont utilisées"),new Notification(t).notify(8e3),e})}},{key:"base_bld",value:function(){_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("administrators")}}]),n}()),IdentifierRule=function(){_inherits(i,FormRule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this))._message="Veuillez entrer un identifiant correct",e}return _createClass(i,[{key:"validate",value:function(e){return RegexCollection.patterns.identifier.test(e)}}]),i}(),HiddenField=function(){_inherits(a,FormField);var n=_createSuper(a);function a(e,t){var i;return _classCallCheck(this,a),(i=n.call(this)).input=HTML.parse_element(e),i.name=t,i.events.define("error"),i.build(),i}return _createClass(a,[{key:"build",value:function(){}},{key:"value",get:function(){return _get(_getPrototypeOf(a.prototype),"_value",this)},set:function(e){this.input.value=e,_set(_getPrototypeOf(a.prototype),"value",e,this,!0)}},{key:"error",value:function(e){this.events.trigger("error",e)}},{key:"reset",value:function(){this.value=""}}],[{key:"builder",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){},i=document.createElement("input");return i.className="".concat(window.env.APP_CSS_CLASS," field hidden ").concat(e),i.type="hidden",i.name=e,t(i),i}}]),a}(),PasswordRule=function(){_inherits(i,LengthRule);var t=_createSuper(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{min:6,max:32};return _classCallCheck(this,i),(e=t.call(this,e))._message="Votre mot de passe doit contenir au moins une lettre majuscule et minuscule, un chiffre et avoir une longueur comprise entre "+e.constraints.min+" et "+e.constraints.max+" caractères",e}return _createClass(i,[{key:"validate",value:function(e){return _get(_getPrototypeOf(i.prototype),"validate",this).call(this,e)&&RegexCollection.patterns.password.test(e)&&/[A-Z]/.test(e)&&/[a-z]/.test(e)&&/[0-9]/.test(e)}}]),i}(),PersonalInfoMgr=function(){_inherits(i,FormManager);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),(e=t.call(this,e)).mount(),e}return _createClass(i,[{key:"mount",value:function(){var e=ShortText.from_DOM(this.form.querySelector("._last_name"),"_last_name"),e=(e.add_rule(new NameRule),e.add_rule(new LengthRule({min:2,max:160})),this.add_field("_last_name",e),ShortText.from_DOM(this.form.querySelector("._first_name"),"_first_name")),e=(e.add_rule(new NameRule),e.add_rule(new LengthRule({min:2,max:160})),this.add_field("_first_name",e),ShortText.from_DOM(this.form.querySelector("._email"),"_email")),e=(e.add_rule(new EmailRule),this.add_field("_email",e),this._fld_country=DynamicSelect.from_DOM(this.form.querySelector("._country"),"_country"),this._fld_country.attach_selector(new CommonSelector({_manager:project.managers.countries})),this.add_field("_country",this._fld_country),ShortText.from_DOM(this.form.querySelector("._telephone"),"_telephone")),e=(e.add_rule(new TelephoneRule({min:2,max:160})),this.add_field("_telephone",e),ShortText.from_DOM(this.form.querySelector("._city"),"_city")),e=(e.add_rule(new TextRule({min:2,max:160})),this.add_field("_city",e),ShortText.from_DOM(this.form.querySelector("._address"),"_address"));e.add_rule(new TextRule({min:2,max:160})),this.add_field("_address",e)}}]),i}(),ApplicantsDT=function(){_inherits(n,DataTable);var t=_createSuper(n);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:DataList.mngmt_modes.full;return _classCallCheck(this,n),t.call(this,{_manager:project.managers.applicants,_factor:20,_opts:{mngmt_mode:e,slct_mode:DataList.slct_modes.multiple}})}return _createClass(n,[{key:"columns",get:function(){return["Nom","Prénom","Date de naissance","Sexe","N° ONPT","Téléphone","Email","Diplôme","Fonction","Nationalité"]}},{key:"item_class",get:function(){return ApplicantDTI}},{key:"add_item",value:function(e){var t=this;return _get(_getPrototypeOf(n.prototype),"add_item",this).call(this,e).then(function(){return t.refresh()})}},{key:"update_item",value:function(e,t){var i=this;return _get(_getPrototypeOf(n.prototype),"update_item",this).call(this,e,t).then(function(){return i.refresh()})}},{key:"remove_item",value:function(e){return _get(_getPrototypeOf(n.prototype),"remove_item",this).call(this,e).catch(function(e){var t="Une erreur a été rencrontrée lors de la suppression!";throw"APPLICANT_DELETION_FORBIDDEN_ERROR"===e.code&&(t="Désolé vous devez désigner un autre comme postulant principal pour rendre la suppression possible"),new Notification(t).notify(8e3),e})}},{key:"process_item",value:function(e){return e._birthday=moment(e._birthday).format("YYYY-MM-DD"),_get(_getPrototypeOf(n.prototype),"process_item",this).call(this,e)}},{key:"build",value:function(){_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.container.classList.add("applicants")}}]),n}(),CardsLayoutItem=function(){_inherits(i,Molecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,{})).id=null,e.shown=!1,e}return _createClass(i,[{key:"show",value:function(){_get(_getPrototypeOf(i.prototype),"show",this).call(this),this.shown=!0}},{key:"hide",value:function(){_get(_getPrototypeOf(i.prototype),"hide",this).call(this),this.shown=!1}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.classList.add("cards-layout-item",this.id)}}]),i}(),Tab=function(){_inherits(s,Atom);var a=_createSuper(s);function s(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return _classCallCheck(this,s),(i=a.call(this,i)).id=e,i.label=t,i.events.define("show"),i.selected=!1,n&&i.build(),i}return _createClass(s,[{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(s.prototype),"base_bld",this).call(this),this.container.classList.add("tab",this.id),this.inner.innerHTML=this.label,this.container.addEventListener("click",function(){e.events.trigger("show",e.id)})}},{key:"select",value:function(){this.selected=!0,this.container.classList.add("selected")}},{key:"unselect",value:function(){this.selected=!1,this.container.classList.remove("selected")}}]),s}(),TabsLayout=function(){_inherits(n,Layout);var i=_createSuper(n);function n(e){var t;if(_classCallCheck(this,n),(t=i.call(this)).events.define(["shown","hidden"]),t.tabs=new Map,t.cur_tab=null,t.tab_callback=function(e){return t.show(e)},e instanceof HTMLElement)return t.container=e,t;throw"Bad container type given for tabs layout building"}return _createClass(n,[{key:"init",value:function(){this.container.classList.add("tabs-layout"),this.tabs_container=document.createElement("div"),this.tabs_container.className="tabs-layout tabs",this.container.appendChild(this.tabs_container),this.cards_container=document.createElement("div"),this.cards_container.className="tabs-layout cards",this.cards=new CardsLayout(this.cards_container),this.container.appendChild(this.cards_container),this.cards.init()}},{key:"get",value:function(e){return{tab:this.tabs.get(e),card:this.cards.get(e)}}},{key:"add_item",value:function(e,t){this.tabs.has(e.id)||e.id!==t.id||(this.tabs.set(e.id,e),e.events.add_listener("show",this.tab_callback),this.tabs_container.appendChild(e.html()),this.cards.add_item(t))}},{key:"remove_item",value:function(e){var t=this.tabs.get(e);t&&(t.remove(),t.events.remove_listener(this.tab_callback),this.tabs.delete(e),this.cards.remove_item(e))}},{key:"clear",value:function(){var t=this;this.tabs_container.innerHTML="",this.tabs.forEach(function(e){return e.events.remove_listener(t.tab_callback)}),this.tabs.clear(),this.cards.clear()}},{key:"show",value:function(e){var t;this.cur_tab&&e===this.cur_tab.id||(t=this.tabs.get(e))&&(this.cur_tab&&this.cur_tab.unselect(),t.select(),this.cur_tab=t,this.events.trigger("shown",{card:this.cards.show(e)}))}}]),n}(),FileViewer=function(){_inherits(n,Molecule);var i=_createSuper(n);function n(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(e=i.call(this)).opts=Object.assign(n.dflt_opts,t),e.toolbar_width=64,e.cur_state={ctrls:{}},e.information={},e.task_events=null,e.events.define(["file_loaded","new_task"]),e.build(),e}return _createClass(n,[{key:"show",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return this.loading_frame.show(),this.cur_state.ctrls=Object.assign(n.ctrls,i),this.task_events=new Events,this.information=t,this.events.trigger("new_task"),_get(_getPrototypeOf(n.prototype),"show",this).call(this),this.container.style.zIndex=env.page_overlay_z_index+2*project.page_overlay_count+++1,this.object.data=e,this.task_events}},{key:"hide",value:function(){_get(_getPrototypeOf(n.prototype),"hide",this).call(this),project.page_overlay_count--}},{key:"remove",value:function(){project.page_overlay_count--,_get(_getPrototypeOf(n.prototype),"remove",this).call(this)}},{key:"show_ctrls",value:function(){}},{key:"sizing",value:function(){this.object.width="".concat(window.innerWidth-this.toolbar_width,"px"),this.object.height="".concat(window.innerHeight,"px")}},{key:"base_bld",value:function(){var e=this,t=(_get(_getPrototypeOf(n.prototype),"base_bld",this).call(this),this.container.classList.add("file-viewer"),this.object_wrapper=document.createElement("div"),this.object_wrapper.className="object-wrapper",this.inner.appendChild(this.object_wrapper),document.createElement("div"));t.className="toolbar-slot",this.inner.appendChild(t),this.toolbar=new(function(){_inherits(t,Toolbar);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"file-viewer-toolbar")}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this);var e=new(function(){_inherits(i,ToolbarItem);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"closer")).events.define("close"),e}return _createClass(i,[{key:"base_bld",value:function(){var e=this;_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this,document.createElement("a")),this.container.classList.add("closer"),this.container.addEventListener("click",function(){return e.events.trigger("close")},!1)}}]),i}());this.add_item("closer",e),e.events.pipe(this.events,["close"])}}]),t}()),this.toolbar.events.add_listener("close",function(){return e.hide()}),t.appendChild(this.toolbar.html()),this.object=document.createElement("object"),this.object_wrapper.appendChild(this.object),this.loading_frame=new LoadingFrame,this.container.appendChild(this.loading_frame.html())}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.sizing(),this.object.addEventListener("load",function(){t.events.trigger("file_loaded"),t.loading_frame.hide()}),window.addEventListener("resize",function(e){return t.sizing()})}}],[{key:"dflt_opts",get:function(){return{}}},{key:"ctrls",get:function(){return{}}}]),n}(),Viewport=function(){_inherits(i,Molecule);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this)).current_pane=null,e.tabs_panes={},e.build(),e}return _createClass(i,[{key:"build",value:function(){var t=this;this.container=document.querySelector(".".concat(env.APP_CSS_CLASS,".viewport")),this.inner=document.querySelector(".".concat(env.APP_CSS_CLASS,".viewport > .inner")),this.header=this.inner.querySelector("header > .inner"),this.contextual_toolbar_vwprt=new ToolbarVwprt,this.header.insertBefore(this.contextual_toolbar_vwprt.html(),this.header.querySelector(".block.menu-rocker")),this.static_toolbar=new VwprtStaticToolbar,this.header.insertBefore(this.static_toolbar.html(),this.header.querySelector(".block.menu-rocker")),this.central_pane_inner=document.querySelector(".".concat(env.APP_CSS_CLASS,".viewport > .inner > .central-pane > .inner")),project.events.add_listener("main_menu_item_changed",function(e){t.show(e)})}},{key:"rgstr_tab_pane",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];t&&e&&(this.tabs_panes[e]=t,this.central_pane_inner.appendChild(t.html()),t.toolbar instanceof Toolbar&&this.contextual_toolbar_vwprt.registerToolbar(e,t.toolbar),i)&&this.show(e)}},{key:"show",value:function(e){this.tabs_panes.hasOwnProperty(e)&&(this.current_pane&&(this.current_pane.hide(),this.current_pane.toolbar instanceof Toolbar)&&this.contextual_toolbar_vwprt.hide(this.current_pane.id),this.current_pane=this.tabs_panes[e],this.current_pane.show(),this.current_pane.toolbar instanceof Toolbar)&&this.contextual_toolbar_vwprt.show(e)}}]),i}(),MainMenu=function(){_inherits(n,Molecule);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).events.define(["item_changed"]),project.events.define(["main_menu_item_changed","main_menu_shown","main_menu_hidden"]),e.current_item=null,e.build(),e}return _createClass(n,[{key:"build",value:function(){var i=this;_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.container=document.querySelector(".".concat(env.APP_CSS_CLASS,".main-menu")),this.container.addEventListener("transitionend",function(e){e.target===i.container&&(i.container.classList.contains("collapsed")?project.events.trigger("main_menu_hidden"):project.events.trigger("main_menu_shown"))},!1),this.container.querySelector(".logout").addEventListener("click",function(e){project.events.trigger("logout")}),this.rocker=document.querySelector("header.".concat(env.APP_CSS_CLASS," .menu-rocker")),this.rocker.addEventListener("click",function(e){i.rocker.classList.contains("expand")?i.show():i.hide()},!1),this.current_item=this.container.querySelector(".menu-item.selected"),this.menu_items=this.container.querySelectorAll(".menu-items .menu-item"),this.menu_items.forEach(function(t){t.addEventListener("click",function(e){i.current_item!==t&&(i.current_item&&i.current_item.classList.remove("selected"),t.classList.add("selected"),i.current_item=t,i.events.trigger("item_changed",t.dataset.target),project.events.trigger("main_menu_item_changed",t.dataset.target))},!1)})}},{key:"show",value:function(){this.container.classList.remove("collapsed"),this.rocker.classList.remove("expand")}},{key:"hide",value:function(){this.container.classList.add("collapsed"),this.rocker.classList.add("expand")}}]),n}(),Dpml=function(){_inherits(t,App);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this)}}]),t}(),_url_base15="".concat(env.API_URL_BASE,"/api/user"),_mgr2=(project.managers.auth={},project.managers.auth),NotificationsTP=(_mgr2.login=function(e){var t=e._identifier,e=e._password;return project.managers.ajax.request({method:"POST",url:"".concat(_url_base15,"/auth/login"),data:{_email:t,_password:e},type:"application/json",with_credentials:!0})},_mgr2.logout=function(){return project.managers.ajax.authenticated_request({method:"POST",url:"".concat(_url_base15,"/auth/logout")})},project.managers.inspections_types=common_mgr("inspections_types"),project.managers.legal_forms=common_mgr("legal_forms"),project.managers.functions=common_mgr("functions"),project.managers.diplomas=common_mgr("diplomas"),function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"notifications")).build(),e}return i}()),EstablishmentsTP=function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"establishments")).build(),e}return _createClass(i,[{key:"show",value:function(){_get(_getPrototypeOf(i.prototype),"show",this).call(this),this.data_list.initialized||this.data_list.init()}},{key:"data_list_bld",value:function(){this.data_list=new EstablishmentsDL,this.inner.appendChild(this.data_list.html()),this.data_list_nav=new DataListNavigator(this.data_list)}},{key:"toolbar_bld",value:function(){this.toolbar=new DataListToolbar("establishments-tp-toolbar",{add:!1,delete:!1}),this.toolbar.add_item("data-list-nav",this.data_list_nav)}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.data_list_bld(),this.toolbar_bld()}},{key:"build",value:function(){var t=this;_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.toolbar.events.add_listener("refresh",function(){return t.data_list.refresh()}).add_listener("search",function(e){return t.data_list.search(e)})}}]),i}(),RequestsTypesTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"requests_types")).data_list=new RequestsTypesDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"requests_types")}return _createClass(t,[{key:"title",get:function(){return"Type de demande"}},{key:"mount",value:function(){var e=new Select("_group",[{value:"opening",label:"Licence d'ouverture",selected:!0},{value:"exploitation",label:"Licence d'exploitation"}],{dflt_index:0});this.form.appendChild(e.html()),this.form_mgr.add_field("_group",e),common_editor_fld(this.form,this.form_mgr)}}]),t}())}}]),i}(),CommonTP=function(){_inherits(n,DataTableTP);var i=_createSuper(n);function n(e,t){return _classCallCheck(this,n),(e=i.call(this,e)).options=t,e.data_list=new CommonDT({_manager:e.options.manager}),e.build(),e}return _createClass(n,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(n,Editor);var i=_createSuper(n);function n(e){var t;return _classCallCheck(this,n),(t=i.call(this,"common",{},!1)).options=e,t.build(),t}return _createClass(n,[{key:"title",get:function(){return this.options.editor.title}},{key:"mount",value:function(){common_editor_fld(this.form,this.form_mgr)}}]),n}())(this.options)}}]),n}(),TownsTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"towns")).data_list=new TownsDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"towns")}return _createClass(t,[{key:"title",get:function(){return"Commune"}},{key:"mount",value:function(){this.prefecture_fld=new DynamicSelect("_prefecture",{label_key:"_name",label_name:"_prefecture_name",value_key:"_id"}),this.prefecture_fld.placeholder="Préfecture",this.prefecture_fld.attach_selector(new CommonSelector({_manager:project.managers.prefectures})),this.form.appendChild(this.prefecture_fld.html()),this.form_mgr.add_field("_prefecture",this.prefecture_fld),common_editor_fld(this.form,this.form_mgr)}}]),t}())}}]),i}(),RequestsStepsTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"requests_steps")).data_list=new RequestsStepsDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"requests_steps")}return _createClass(t,[{key:"title",get:function(){return"Étape de demande"}},{key:"mount",value:function(){this.request_type_fld=new DynamicSelect("_request_type",{label_key:"_name",label_name:"_request_type_name",value_key:"_id"}),this.request_type_fld.placeholder="Type de demande",this.request_type_fld.attach_selector(new CommonSelector({_manager:project.managers.requests_types})),this.form.appendChild(this.request_type_fld.html()),this.form_mgr.add_field("_request_type",this.request_type_fld),this.establishment_type_fld=new DynamicSelect("_establishment_type",{label_key:"_name",label_name:"_establishment_type_name",value_key:"_id"}),this.establishment_type_fld.placeholder="Type d'établissement",this.establishment_type_fld.attach_selector(new CommonSelector({_manager:project.managers.establishments_types})),this.form.appendChild(this.establishment_type_fld.html()),this.form_mgr.add_field("_establishment_type",this.establishment_type_fld),common_editor_fld(this.form,this.form_mgr);var e=new LongText("_description"),e=(e.placeholder="Description",this.form.appendChild(e.html()),e.add_rule(new TextRule({min:1,max:2e3})),this.form_mgr.add_field("_description",e),new ShortText("_delay")),e=(e.set_type("number"),e.placeholder="Délai",this.form.appendChild(e.html()),e.add_rule(new TextRule({min:1,max:0})),this.form_mgr.add_field("_delay",e),new Select("_delay_unit",[{value:"day",label:"Jour",selected:!0},{value:"week",label:"Semaine"},{value:"month",label:"Mois"},{value:"year",label:"Année"}]));this.form.appendChild(e.html()),this.form_mgr.add_field("_delay_unit",e),this.order_fld=new ShortText("_order"),this.order_fld.set_type("number"),this.order_fld.placeholder="Position d'ordre",this.form.appendChild(this.order_fld.html()),this.order_fld.add_rule(new TextRule({min:1,max:20})),this.form_mgr.add_field("_order",this.order_fld)}}]),t}())}}]),i}(),TownsShipsTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"towns_ships")).data_list=new TownsShipsDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"towns_ships")}return _createClass(t,[{key:"title",get:function(){return"Canton"}},{key:"mount",value:function(){this.town_fld=new DynamicSelect("_town",{label_key:"_name",label_name:"_town_name",value_key:"_id"}),this.town_fld.placeholder="Canton",this.town_fld.attach_selector(new CommonSelector({_manager:project.managers.towns})),this.form.appendChild(this.town_fld.html()),this.form_mgr.add_field("_town",this.town_fld),common_editor_fld(this.form,this.form_mgr)}}]),t}())}}]),i}(),PrefecturesTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"prefectures")).data_list=new PrefecturesDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"prefectures")}return _createClass(t,[{key:"title",get:function(){return"Préfecture"}},{key:"mount",value:function(){this.admin_region_fld=new DynamicSelect("_administration_region",{label_name:"_administration_region_name"}),this.admin_region_fld.placeholder="Région administrative",this.admin_region_fld.attach_selector(new CommonSelector({_manager:project.managers.administration_regions})),this.form.appendChild(this.admin_region_fld.html()),this.form_mgr.add_field("_administration_region",this.admin_region_fld),common_editor_fld(this.form,this.form_mgr)}}]),t}())}}]),i}(),RequiredDocumentsTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"required_documents")).data_list=new RequiredDocumentsDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(i,Editor);var e=_createSuper(i);function i(){return _classCallCheck(this,i),e.call(this,"required_documents")}return _createClass(i,[{key:"title",get:function(){return"Document requis"}},{key:"mount",value:function(){var t=this;this.request_type_fld=new DynamicSelect("_request_type",{label_key:"_name",label_name:"_request_type_name",value_key:"_id"}),this.request_type_fld.placeholder="Type de demande",this.request_type_fld.add_rule(new NotNull("Veuillez sélectionner un type demande")),this.request_type_fld.attach_selector(new CommonSelector({_manager:project.managers.requests_types})),this.form.appendChild(this.request_type_fld.html()),this.form_mgr.add_field("_request_type",this.request_type_fld),DynamicSelect.groups.register("required_documents_editor",this.request_type_fld),this.request_type_fld.events.add_listener("change",function(e){t.enable_step()}),this.establishment_type_fld=new DynamicSelect("_establishment_type",{label_key:"_name",label_name:"_establishment_type_name",value_key:"_id"}),this.establishment_type_fld.add_rule(new NotNull("Veuillez sélectionner un type d'établissement")),this.establishment_type_fld.placeholder="type d'établissement",this.establishment_type_fld.attach_selector(new CommonSelector({_manager:project.managers.establishments_types})),this.form.appendChild(this.establishment_type_fld.html()),this.form_mgr.add_field("_establishment_type",this.establishment_type_fld),DynamicSelect.groups.register("required_documents_editor",this.establishment_type_fld),this.establishment_type_fld.events.add_listener("change",function(e){t.enable_step()}),this.request_step_fld=new DynamicSelect("_request_step",{label_key:"_name",label_name:"_request_step_name",value_key:"_id"}),this.request_step_fld.add_rule(new NotNull("Veuillez sélectionner l'étape")),this.request_step_fld.placeholder="Étape",this.request_step_fld.attach_selector(new CommonSelector({_manager:project.managers.requests_steps})),this.form.appendChild(this.request_step_fld.html()),this.form_mgr.add_field("_request_step",this.request_step_fld),this.request_step_fld.disable(),DynamicSelect.groups.register("required_documents_editor",this.request_step_fld),this.name_fld=new ShortText("_name"),this.name_fld.placeholder="Nom",this.form.appendChild(this.name_fld.html()),this.name_fld.add_rule(new TextRule({min:1,max:160})),this.form_mgr.add_field("_name",this.name_fld),this.description_fld=new LongText("_description"),this.description_fld.placeholder="Description",this.form.appendChild(this.description_fld.html()),this.description_fld.add_rule(new TextRule({min:1,max:2e3})),this.form_mgr.add_field("_description",this.description_fld)}},{key:"disable_step",value:function(){this.request_step_fld.disable(),this.request_step_fld.selector.remove_filter("_request_type"),this.request_step_fld.selector.remove_filter("_establishment_type"),this.request_step_fld.reset()}},{key:"enable_step",value:function(){!this.cur_mode!==Editor.modes.EDIT&&(this.request_type_fld.is_valid&&this.establishment_type_fld.is_valid?(this.request_step_fld.selector.add_filter("_request_type",this.request_type_fld.value),this.request_step_fld.selector.add_filter("_establishment_type",this.establishment_type_fld.value),this.request_step_fld.selector.refresh(),this.request_step_fld.enable()):this.disable_step())}},{key:"show",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Editor.modes.ADD,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return e===Editor.modes.EDIT?(this.request_type_fld.disable(),this.establishment_type_fld.disable()):e===Editor.modes.ADD&&(this.request_type_fld.enable(),this.establishment_type_fld.enable()),this.request_step_fld.disable(),_get(_getPrototypeOf(i.prototype),"show",this).call(this,e,t)}}]),i}())}}]),i}(),HealthDistrictsTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"health_districts")).data_list=new HealthDistrictsDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"health_districts")}return _createClass(t,[{key:"title",get:function(){return"District sanitaire"}},{key:"mount",value:function(){this.health_region_fld=new DynamicSelect("_health_region",{label_key:"_name",label_name:"_health_region_name",value_key:"_id"}),this.health_region_fld.placeholder="Région sanitaire",this.health_region_fld.attach_selector(new CommonSelector({_manager:project.managers.health_regions})),this.form.appendChild(this.health_region_fld.html()),this.form_mgr.add_field("_health_region",this.health_region_fld),common_editor_fld(this.form,this.form_mgr)}}]),t}())}}]),i}(),UsersTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"users")).build(),e}return _createClass(i,[{key:"editor_bld",value:function(){}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.innerHTML="Users"}}]),i}(),PasswordTP=function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"password_change")).build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.container.innerHTML="Password"}}]),i}(),AdministratorsTP=function(){_inherits(i,DataTableTP);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"administrators")).data_list=new AdministratorsDT,e.build(),e}return _createClass(i,[{key:"editor_bld",value:function(){this.editor=new(function(){_inherits(t,Editor);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.call(this,"administrators")}return _createClass(t,[{key:"title",get:function(){return"Administrateur"}},{key:"mount",value:function(){var e=new ShortText("_last_name"),e=(e.placeholder="Nom",this.form.appendChild(e.html()),e.add_rule(new NameRule),e.add_rule(new LengthRule({max:160,min:3})),this.form_mgr.add_field("_last_name",e),new ShortText("_first_name")),e=(e.placeholder="Prénom(s)",this.form.appendChild(e.html()),e.add_rule(new NameRule),e.add_rule(new LengthRule({max:160,min:3})),this.form_mgr.add_field("_first_name",e),new ShortText("_identifier")),e=(e.placeholder="Identifiant",this.form.appendChild(e.html()),e.add_rule(new IdentifierRule),this.form_mgr.add_field("_identifier",e),this.password_fld=new ShortText("_password"),this.password_fld.placeholder="Mot de passe",this.form.appendChild(this.password_fld.html()),this.password_fld.add_rule(new PasswordRule),this.form_mgr.add_field("_password",this.password_fld),new ShortText("_telephone")),e=(e.placeholder="Téléphone",this.form.appendChild(e.html()),e.add_rule(new TelephoneRule),this.form_mgr.add_field("_telephone",e),new ShortText("_email"));e.placeholder="Email",this.form.appendChild(e.html()),e.add_rule(new EmailRule),this.form_mgr.add_field("_email",e)}}]),t}())}}]),i}(),DashboardTP=function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"dashboard")).build(),e}return _createClass(i,[{key:"build",value:function(){_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.container.innerHTML="Dashboard"}}]),i}(),AccountTP=function(){_inherits(i,TabPane);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"account")).initialized=!1,e.build(),e}return i}(),EstablishmentViewer=function(){_inherits(i,Popup);var t=_createSuper(i);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,i),(e=t.call(this,"establishment-viewer",e)).ctx_events=null,e.ctx=null,e}return _createClass(i,[{key:"show",value:function(e){return this.ctx=e,this.layout.show("info"),this.refresh(),_get(_getPrototypeOf(i.prototype),"show",this).call(this),this.ctx_events&&(delete this.ctx_events,this.ctx_events=new Events),this.ctx_events}},{key:"refresh",value:function(){this.name.innerHTML=this.ctx.data._name,this.denomination.innerHTML=this.ctx.data._denomination,this.estab_type.innerHTML=this.ctx.data._establishment_type_name,this.ctx.data._wholesaler_type?(this.wholesaler_type.classList.add("active"),this.wholesaler_type.innerHTML=this.ctx.data._wholesaler_type_name):(this.wholesaler_type.classList.remove("active"),this.wholesaler_type.innerHTML=""),this.legal_form.innerHTML=this.ctx.data._legal_form_name;var e=_parse_exploitation(this.ctx.data),t=e.str,e=e.state;this.exploitation_expiration.innerHTML=t,this.exploitation_expiration.dataset.state=e}},{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.badge.innerHTML="Etablissement",this.inner.innerHTML='\n            <div class="wrapper">\n                <div class="summary">\n                    <div class="naming">\n                        <div class="field name">__</div>\n                        <div class="field denomination">__</div>\n                    </div>\n                    <div class="tags">\n                        <div class="field tag establishment-type">__</div>\n                        <div class="field tag wholesaler-type"></div>\n                        <div class="field tag legal-form">__</div>\n                    </div>\n                    <div class="field exploitation-expiration" data-state="">__</div>\n                </div>\n                <div class="layout-block"></div>\n            </div>\n        ',this.name=this.inner.querySelector(".field.name"),this.denomination=this.inner.querySelector(".field.denomination"),this.estab_type=this.inner.querySelector(".field.establishment-type"),this.wholesaler_type=this.inner.querySelector(".field.wholesaler-type"),this.legal_form=this.inner.querySelector(".field.legal-form"),this.exploitation_expiration=this.inner.querySelector(".field.exploitation-expiration"),this.layout=new TabsLayout(this.inner.querySelector(".layout-block")),this.layout.init(),this.layout.add_item(new Tab("info","Information"),new(function(){_inherits(i,CardsLayoutItem);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,{})).id="info",e.build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.inner.innerHTML="Information"}}]),i}())),this.layout.add_item(new Tab("requests","Demandes"),new(function(){_inherits(i,CardsLayoutItem);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,{})).id="requests",e.build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.data_list=new RequestsDL,this.inner.appendChild(this.data_list.html())}},{key:"build",value:function(){_get(_getPrototypeOf(i.prototype),"build",this).call(this),this.data_list.init()}}]),i}())),this.layout.add_item(new Tab("applicants","Postulants"),new(function(){_inherits(i,CardsLayoutItem);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,{})).id="applicants",e.build(),e}return _createClass(i,[{key:"base_bld",value:function(){_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this),this.data_list=new ApplicantsDT,this.inner.appendChild(this.data_list.html()),this.data_list.init()}}]),i}())),this.layout.show("info")}}]),i}(),_spr_base_bld2=FileViewer.prototype.base_bld,_spr_build4=FileViewer.prototype.build,spr_hide=FileViewer.prototype.hide,Dashboard=(Object.defineProperty(FileViewer,"ctrls",{get:function(){return{validation_ctrl:!1}}}),FileViewer.prototype.hide=function(){spr_hide.apply(this),this.cur_state.ctrls=FileViewer.ctrls,this.show_ctrls()},FileViewer.prototype.show_ctrls=function(){this.cur_state.ctrls.validation_ctrl?(this.toolbar.show_item("validate"),this.toolbar.show_item("reject")):(this.toolbar.hide_item("validate"),this.toolbar.hide_item("reject"))},FileViewer.prototype.validation_ctrl_bld=function(){var i=this;this.validate_btn=new(function(){_inherits(i,ToolbarItem);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"validate")).events.define("validate"),e.hide(),e}return _createClass(i,[{key:"base_bld",value:function(){var e=this,t=(_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this,document.createElement("a")),new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("validate","icon"),this.inner.innerHTML='\n                                <span class="fi fi-rr-file"></span> \n                                <span class="fi fi-rr-check"></span>\n                            '}}]),t}()));this.inner.appendChild(t.html()),t.add_event_listener("click",function(){return e.events.trigger("validate")})}}]),i}()),this.toolbar.add_item("validate",this.validate_btn),this.validate_btn.events.add_listener("validate",function(){if("validated"===i.information._validation_state)return new Notification("Document déjà validé!").notify();var t=new ValidationFormPopup({title:"Validation du document",required_treatment_date:!1,commentable:!1,observation_constraint:{max:2e3}});t.events.add_listener("confirmed",function(e){e=e.values;project.managers.requests.required_documents.validate(_objectSpread({_request:i.information.request_item.data._id,_request_step:i.information._request_step,_required_document:i.information._id},e)).then(function(e){i.task_events.trigger("validation_state_change",e),t.remove(),new Notification("Document validé avec succès").notify()}).catch(function(e){new Notification("Une erreur est survénue lors de l'opération").notify(),t.release()})}).add_listener("cancelled",function(){return t.remove()}),t.show()}),this.reject_btn=new(function(){_inherits(i,ToolbarItem);var t=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=t.call(this,"reject")).events.define("reject"),e.hide(),e}return _createClass(i,[{key:"base_bld",value:function(){var e=this,t=(_get(_getPrototypeOf(i.prototype),"base_bld",this).call(this,document.createElement("a")),new(function(){_inherits(t,Button);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"base_bld",value:function(){_get(_getPrototypeOf(t.prototype),"base_bld",this).call(this),this.container.classList.add("reject","icon"),this.inner.innerHTML='\n                            <span class="fi fi-rr-file"></span>\n                            <span class="fi fi-rr-cross-small"></span>\n                        '}}]),t}()));this.inner.appendChild(t.html()),t.add_event_listener("click",function(){return e.events.trigger("reject")})}}]),i}()),this.toolbar.add_item("reject",this.reject_btn),this.reject_btn.events.add_listener("reject",function(){if("invalidated"===i.information._validation_state)return new Notification("Document déjà invalidé!").notify();var t=new ValidationFormPopup({title:"Invalidation du document",required_treatment_date:!1});t.events.add_listener("confirmed",function(e){e=e.values;project.managers.requests.required_documents.invalidate(_objectSpread({_request:i.information.request_item.data._id,_request_step:i.information._request_step,_required_document:i.information._id},e)).then(function(e){i.task_events.trigger("validation_state_change",e),t.remove(),new Notification("Document rejeté avec succès").notify()}).catch(function(e){t.release(),new Notification("Une erreur est survénue lors de l'opération").notify()})}).add_listener("cancelled",function(){return t.remove()}),t.show()}),this.events.add_listener("new_task",function(){i.task_events.define("validation_state_change")})},FileViewer.prototype.base_bld=function(){_spr_base_bld2.apply(this),this.validation_ctrl_bld()},FileViewer.prototype.build=function(){var e=this;_spr_build4.apply(this),this.events.add_listener("file_loaded",function(){return e.show_ctrls()})},function(){_inherits(t,Dpml);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this),this.mainMenu=new MainMenu,this.viewport=new Viewport,this.loading_frame=LoadingFrame.from_DOM(document.querySelector(".body > .loading-frame")),project.events.add_listener("main_menu_shown",function(){document.querySelector("body > .body").classList.remove("no-main-menu")}).add_listener("main_menu_hidden",function(){document.querySelector("body > .body").classList.add("no-main-menu")})}},{key:"file_viewer",get:function(){return this._file_viewer||(this._file_viewer=new FileViewer,document.body.appendChild(this._file_viewer.html())),this._file_viewer}}]),t}()),Bo=function(){_inherits(t,Dashboard);var e=_createSuper(t);function t(){return _classCallCheck(this,t),e.apply(this,arguments)}return _createClass(t,[{key:"init",value:function(){_get(_getPrototypeOf(t.prototype),"init",this).call(this),this.viewport.rgstr_tab_pane("notifications",new NotificationsTP,!0),this.viewport.rgstr_tab_pane("requests",new RequestsTP),this.viewport.rgstr_tab_pane("requests",new RequestsTP),this.viewport.rgstr_tab_pane("establishments",new EstablishmentsTP),this.viewport.rgstr_tab_pane("administration_regions",new CommonTP("administration_regions",{manager:project.managers.administration_regions,editor:{title:"Région administrative"}})),this.viewport.rgstr_tab_pane("prefectures",new PrefecturesTP),this.viewport.rgstr_tab_pane("towns",new TownsTP),this.viewport.rgstr_tab_pane("towns_ships",new TownsShipsTP),this.viewport.rgstr_tab_pane("health_regions",new CommonTP("health_regions",{manager:project.managers.health_regions,editor:{title:"Région Sanitaire"}})),this.viewport.rgstr_tab_pane("health_districts",new HealthDistrictsTP),this.viewport.rgstr_tab_pane("establishments_types",new CommonTP("establishments_types",{manager:project.managers.establishments_types,editor:{title:"Types d'établissement"}})),this.viewport.rgstr_tab_pane("requests_types",new RequestsTypesTP),this.viewport.rgstr_tab_pane("requests_steps",new RequestsStepsTP),this.viewport.rgstr_tab_pane("required_documents",new RequiredDocumentsTP),this.viewport.rgstr_tab_pane("inspections_types",new CommonTP("inspections_types",{manager:project.managers.inspections_types,editor:{title:"Type d'inspection"}})),this.viewport.rgstr_tab_pane("legal_forms",new CommonTP("legal_forms",{manager:project.managers.legal_forms,editor:{title:"Forme juridique"}})),this.viewport.rgstr_tab_pane("functions",new CommonTP("functions",{manager:project.managers.functions,editor:{title:"Fonction"}})),this.viewport.rgstr_tab_pane("diplomas",new CommonTP("diplomas",{manager:project.managers.diplomas,editor:{title:"Diplôme"}})),this.viewport.rgstr_tab_pane("administrators",new AdministratorsTP),this.viewport.rgstr_tab_pane("profile",new AccountTP),this.viewport.rgstr_tab_pane("password_change",new PasswordTP),project.events.add_listener("logout",function(){project.managers.auth.logout().then(function(e){window.location="/"}).catch(function(e){new Notification("Une erreur est survénue lors de la demande de déconnexion").notify()})})}},{key:"estab_viewer",get:function(){return this._estab_viewer||(this._estab_viewer=new EstablishmentViewer),this._estab_viewer}}]),t}(),bo=new Bo;(app.instance=bo).run();